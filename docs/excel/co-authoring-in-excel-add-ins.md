---
title: Excel アドインの共同編集機能
description: オンラインで、Excel、OneDrive、OneDrive for BusinessにSharePointします。
ms.date: 07/23/2020
localization_priority: Normal
ms.openlocfilehash: d6500248c13f0cef85736b4ffbad0dc655afecd7
ms.sourcegitcommit: 883f71d395b19ccfc6874a0d5942a7016eb49e2c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/09/2021
ms.locfileid: "53349687"
---
# <a name="coauthoring-in-excel-add-ins"></a><span data-ttu-id="d39a3-103">Excel アドインの共同編集機能</span><span class="sxs-lookup"><span data-stu-id="d39a3-103">Coauthoring in Excel add-ins</span></span>  

<span data-ttu-id="d39a3-p101">[共同編集機能](https://support.office.com/article/Collaborate-on-Excel-workbooks-at-the-same-time-with-co-authoring-7152aa8b-b791-414c-a3bb-3024e46fb104)により、複数のユーザーが連携して同じ Excel ブックを同時に編集できるようになります。 ブックのすべての共同編集者は、他の共同編集者がブックを保存するとすぐに、その共同編集者による変更の内容を確認できます。 Excel ブックを共同編集するには、そのブックが OneDrive、OneDrive for Business、SharePoint Online のいずれかに保存されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p101">With [coauthoring](https://support.office.com/article/Collaborate-on-Excel-workbooks-at-the-same-time-with-co-authoring-7152aa8b-b791-414c-a3bb-3024e46fb104), multiple people can work together and edit the same Excel workbook simultaneously. All coauthors of a workbook can see another coauthor's changes as soon as that coauthor saves the workbook. To coauthor an Excel workbook, the workbook must be stored in OneDrive, OneDrive for Business, or SharePoint Online.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d39a3-107">このExcel for Microsoft 365、左上隅に AutoSave が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-107">In Excel for Microsoft 365, you will notice AutoSave in the upper-left corner.</span></span> <span data-ttu-id="d39a3-108">[自動保存] をオンにすると、共同編集者はリアルタイムで変更内容を確認できます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-108">When AutoSave is turned on, coauthors see your changes in real time.</span></span> <span data-ttu-id="d39a3-109">Excel アドインの設計時には、この動作の影響を考慮に入れておいてください。</span><span class="sxs-lookup"><span data-stu-id="d39a3-109">Consider the impact of this behavior on the design of your Excel add-in.</span></span> <span data-ttu-id="d39a3-110">ユーザーは、Excel ウィンドウの左上隅にあるスイッチで [自動保存] をオフに切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-110">Users can turn off AutoSave via the switch in the upper left of the Excel window.</span></span>

## <a name="coauthoring-overview"></a><span data-ttu-id="d39a3-111">共同編集機能の概要</span><span class="sxs-lookup"><span data-stu-id="d39a3-111">Coauthoring overview</span></span>

<span data-ttu-id="d39a3-112">ブックの内容に変更を加えると、その変更は Excel によってすべての共同編集者間で同期されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-112">When you change a workbook's content, Excel automatically synchronizes those changes across all coauthors.</span></span> <span data-ttu-id="d39a3-113">共同編集者はブックの内容を変更できますが、Excel アドイン内で実行するコードもブックの内容を変更できます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-113">Coauthors can change the content of a workbook, but so can code running within an Excel add-in.</span></span> <span data-ttu-id="d39a3-114">たとえば、次の JavaScript コードがアドインで実行Office、範囲の値は Contoso に設定されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-114">For example, when the following JavaScript code runs in an Office Add-in, the value of a range is set to Contoso.</span></span>

```js
range.values = [['Contoso']];
```

<span data-ttu-id="d39a3-115">すべての共同編集者間で 'Contoso' が同期されると、同じブックで作業するユーザーまたは実行中のアドインは、新しい範囲の値を認識するようになります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-115">After 'Contoso' synchronizes across all coauthors, any user or add-in running in the same workbook will see the new value of the range.</span></span>

<span data-ttu-id="d39a3-p104">共同編集機能では、共有ブック内の内容のみが同期されます。 ブックから Excel アドイン内の JavaScript 変数にコピーした値は同期されません。 たとえば、アドインが JavaScript 変数にセルの値 (たとえば 'Contoso') を保存しているときに、そのセルの値を共同編集者が 'Example' に変更すると、同期後に、そのセルの値はすべての共同編集者に対して 'Example' と表示されます。 ただし、JavaScript 変数の値は 'Contoso' に設定されたままです。 さらに、複数の共同編集者が同じアドインを使用しているときに、それぞれの共同編集者が独自に変数をコピーしている場合、その変数のコピーは同期されません。 ブックの内容を使用する変数を使用するときには、その変数を使用する前に、ブック内で更新された値について必ずチェックしてください。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p104">Coauthoring only synchronizes the content within the shared workbook. Values copied from the workbook to JavaScript variables in an Excel add-in are not synchronized. For example, if your add-in stores the value of a cell (such as 'Contoso') in a JavaScript variable, and then a coauthor changes the value of the cell to 'Example', after synchronization all coauthors see 'Example' in the cell. However, the value of the JavaScript variable is still set to 'Contoso'. Furthermore, when multiple coauthors use the same add-in, each coauthor has their own copy of the variable, which is not synchronized. When you use variables that use workbook content, be sure you check for updated values in the workbook before you use the variable.</span></span>

## <a name="use-events-to-manage-the-in-memory-state-of-your-add-in"></a><span data-ttu-id="d39a3-122">イベントを使用したアドインのメモリ内の状態の管理</span><span class="sxs-lookup"><span data-stu-id="d39a3-122">Use events to manage the in-memory state of your add-in</span></span>

<span data-ttu-id="d39a3-p105">Excel アドインはブックの内容を読み込んで (非表示のワークシートおよび設定オブジェクトからの読み込み)、その内容を変数などのデータ構造に保存できます。 そのようなデータ構造に元の値がコピーされた後でも、共同編集者は元のブックの内容を更新できます。 つまり、データ構造にコピーした値は、ブックの内容と同期されなくなっているということです。 独自のアドインを構築するときには、ブックの内容とデータ構造に保存された値に関して、このような分離があることを必ず考慮に入れてください。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p105">Excel add-ins can read workbook content (from hidden worksheets and a setting object), and then store it in data structures such as variables. After the original values are copied into any of these data structures, coauthors can update the original workbook content. This means that the copied values in the data structures are now out of sync with the workbook content. When you build your add-ins, be sure to account for this separation of workbook content and values stored in data structures.</span></span>

<span data-ttu-id="d39a3-127">たとえば、カスタム視覚エフェクトを表示するコンテンツ アドインを作成するとします。</span><span class="sxs-lookup"><span data-stu-id="d39a3-127">For example, you might build a content add-in that displays custom visualizations.</span></span> <span data-ttu-id="d39a3-128">カスタム視覚エフェクトの状態は非表示のワークシートに保存することにします。</span><span class="sxs-lookup"><span data-stu-id="d39a3-128">The state of your custom visualizations might be saved in a hidden worksheet.</span></span> <span data-ttu-id="d39a3-129">共同編集者が同じブックを使用する場合、次のシナリオが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-129">When coauthors use the same workbook, the following scenario can occur.</span></span>

- <span data-ttu-id="d39a3-p107">ユーザー A がドキュメント開くと、カスタム視覚エフェクトがブックに表示されます。 カスタム視覚エフェクトは、非表示のワークシートからデータを読み込みます (たとえば、視覚エフェクトの色が青色に設定されているとします)。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p107">User A opens the document and the custom visualizations are shown in the workbook. The custom visualizations read data from a hidden worksheet (for example, the color of the visualizations is set to blue).</span></span>
- <span data-ttu-id="d39a3-p108">ユーザー B が同じドキュメントを開いて、カスタム視覚エフェクトの変更を始めます。 ユーザー B は、カスタム視覚エフェクトの色を橙色に設定します。 橙色の設定が非表示のワークシートに保存されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p108">User B opens the same document, and starts modifying the custom visualizations. User B sets the color of the custom visualizations to orange. Orange is saved to the hidden worksheet.</span></span>
- <span data-ttu-id="d39a3-135">ユーザー A の非表示のワークシートが新しい値の橙色で更新されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-135">User A's hidden worksheet is updated with the new value of orange.</span></span>
- <span data-ttu-id="d39a3-136">ユーザー A のカスタム視覚エフェクトは青色のままです。</span><span class="sxs-lookup"><span data-stu-id="d39a3-136">User A's custom visualizations are still blue.</span></span>

<span data-ttu-id="d39a3-p109">ユーザー A のカスタム視覚エフェクトが、共同編集者によって非表示のワークシートに加えられた変更に呼応するようにするには、[BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs) イベントを使用します。 これにより、共同編集者がブックの内容に加えた変更が、アドインの状態に反映されるようになります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p109">If you want User A's custom visualizations to respond to changes made by coauthors on the hidden worksheet, use the [BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs) event. This ensures that changes to workbook content made by coauthors is reflected in the state of your add-in.</span></span>

## <a name="caveats-to-using-events-with-coauthoring"></a><span data-ttu-id="d39a3-139">共同編集機能にイベントを使用する際の注意事項</span><span class="sxs-lookup"><span data-stu-id="d39a3-139">Caveats to using events with coauthoring</span></span>

<span data-ttu-id="d39a3-p110">前述したように、シナリオによっては、すべての共同編集者に向けてイベントをトリガーすることで、ユーザー エクスペリエンスが向上します。 ただし、この動作がユーザー エクスペリエンスの低下を招くシナリオも存在することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="d39a3-p110">As described earlier, in some scenarios, triggering events for all coauthors provides an improved user experience. However, be aware that in some scenarios this behavior can produce poor user experiences.</span></span>

<span data-ttu-id="d39a3-142">たとえば、データの入力規則のシナリオでは、一般に、イベントに呼応して UI を表示します。</span><span class="sxs-lookup"><span data-stu-id="d39a3-142">For example, in data validation scenarios, it is common to display UI in response to events.</span></span> <span data-ttu-id="d39a3-143">前のセクションで説明した [BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs) イベントは、ローカル ユーザーまたは共同編集者 (リモート) のどちらかがバインディングの範囲内でブックの内容を変更したときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-143">The [BindingDataChanged](/javascript/api/office/office.bindingdatachangedeventargs) event described in the previous section runs when either a local user or coauthor (remote) changes the workbook content within the binding.</span></span> <span data-ttu-id="d39a3-144">イベントのイベント ハンドラーに UI が表示される場合、ブックで作業していた変更とは無関係の UI が表示され、ユーザー エクスペリエンス `BindingDataChanged` が低下します。</span><span class="sxs-lookup"><span data-stu-id="d39a3-144">If the event handler of the `BindingDataChanged` event displays UI, users will see UI that is unrelated to changes they were working on in the workbook, leading to a poor user experience.</span></span> <span data-ttu-id="d39a3-145">アドインでイベントを使用する場合は、UI の表示を避けるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="d39a3-145">Avoid displaying UI when using events in your add-in.</span></span>

## <a name="avoiding-table-row-coauthoring-conflicts"></a><span data-ttu-id="d39a3-146">テーブル行の共同編集の競合を回避する</span><span class="sxs-lookup"><span data-stu-id="d39a3-146">Avoiding table row coauthoring conflicts</span></span>

<span data-ttu-id="d39a3-147">API の呼び出しによって共同編集の競合が発生 [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#add-index--values-) する可能性がある既知の問題です。</span><span class="sxs-lookup"><span data-stu-id="d39a3-147">It is a known issue that calls to the [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#add-index--values-) API can cause coauthoring conflicts.</span></span> <span data-ttu-id="d39a3-148">他のユーザーがアドインのブックを編集している間にアドインが実行される可能性がある場合は、その API を使用することをお勧めしません (特に、テーブルまたはテーブルの下の任意の範囲を編集している場合)。</span><span class="sxs-lookup"><span data-stu-id="d39a3-148">We do not recommend using that API if you anticipate your add-in will be run while other users are editing the add-in's workbook (specifically, if they are editing the table or any range under the table).</span></span> <span data-ttu-id="d39a3-149">次のガイダンスは、メソッドの問題を回避するのに役立ちます (また、ユーザーに更新を求めるExcel黄色のバーをトリガー `TableRowCollection.add` しないようにします)。</span><span class="sxs-lookup"><span data-stu-id="d39a3-149">The following guidance should help you avoid issues with the `TableRowCollection.add` method (and avoid triggering the yellow bar Excel shows that asks users to refresh).</span></span>

1. <span data-ttu-id="d39a3-150">の [`Range.values`](/javascript/api/excel/excel.range#values) 代わりに使用します [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#add-index--values-) 。</span><span class="sxs-lookup"><span data-stu-id="d39a3-150">Use [`Range.values`](/javascript/api/excel/excel.range#values) instead of [`TableRowCollection.add`](/javascript/api/excel/excel.tablerowcollection#add-index--values-).</span></span> <span data-ttu-id="d39a3-151">テーブルの `Range` 直下に値を設定すると、テーブルが自動的に展開されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-151">Setting the `Range` values directly below the table automatically expands the table.</span></span> <span data-ttu-id="d39a3-152">それ以外の場合、API を使用してテーブル行を追加すると、共同認証ユーザー `Table` のマージ競合が発生します。</span><span class="sxs-lookup"><span data-stu-id="d39a3-152">Otherwise, adding table rows through the `Table` APIs results in merge conflicts for coauth users.</span></span>
1. <span data-ttu-id="d39a3-153">データ検証が列 [全体に](https://support.microsoft.com/office/apply-data-validation-to-cells-29fecbcc-d1b9-42c1-9d76-eff3ce5f7249) 適用されていない限り、テーブルの下のセルにデータ検証ルールが適用される必要はありません。</span><span class="sxs-lookup"><span data-stu-id="d39a3-153">There should be no [data validation rules](https://support.microsoft.com/office/apply-data-validation-to-cells-29fecbcc-d1b9-42c1-9d76-eff3ce5f7249) applied to cells below the table, unless the data validation is applied to the entire column.</span></span>
1. <span data-ttu-id="d39a3-154">テーブルの下にデータがある場合、アドインは範囲の値を設定する前に処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-154">If there is data under the table, the add-in needs to handle that before setting the range value.</span></span> <span data-ttu-id="d39a3-155">空 [`Range.insert`](/javascript/api/excel/excel.range##insert-shift-) の行を挿入するために使用すると、データが移動され、展開テーブルの領域が作成されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-155">Using [`Range.insert`](/javascript/api/excel/excel.range##insert-shift-) to insert an empty row will move the data and make space for the expanding table.</span></span> <span data-ttu-id="d39a3-156">それ以外の場合は、表の下のセルを上書きするリスクがあります。</span><span class="sxs-lookup"><span data-stu-id="d39a3-156">Otherwise, you risk overwriting cells below the table.</span></span>
1. <span data-ttu-id="d39a3-157">テーブルに空の行を追加することはできません `Range.values` 。</span><span class="sxs-lookup"><span data-stu-id="d39a3-157">You cannot add an empty row to a table with `Range.values`.</span></span> <span data-ttu-id="d39a3-158">テーブルの直下のセルにデータが存在する場合にのみ、テーブルは自動的に展開されます。</span><span class="sxs-lookup"><span data-stu-id="d39a3-158">The table only automatically expands if data is present in the cells directly below the table.</span></span> <span data-ttu-id="d39a3-159">空のテーブル行を追加するには、回避策として一時的なデータまたは非表示の列を使用します。</span><span class="sxs-lookup"><span data-stu-id="d39a3-159">Use either temporary data or hidden columns as a workaround to add an empty table row.</span></span>

## <a name="see-also"></a><span data-ttu-id="d39a3-160">関連項目</span><span class="sxs-lookup"><span data-stu-id="d39a3-160">See also</span></span>

- [<span data-ttu-id="d39a3-161">Excel (VBA) の共同編集機能について</span><span class="sxs-lookup"><span data-stu-id="d39a3-161">About coauthoring in Excel (VBA)</span></span>](/office/vba/excel/concepts/about-coauthoring-in-excel)
- [<span data-ttu-id="d39a3-162">自動保存がアドインとマクロ (VBA) に及ぼす影響</span><span class="sxs-lookup"><span data-stu-id="d39a3-162">How AutoSave impacts add-ins and macros (VBA)</span></span>](/office/vba/library-reference/concepts/how-autosave-impacts-addins-and-macros)
