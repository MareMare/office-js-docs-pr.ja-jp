

1. <span data-ttu-id="09f2f-101">[Azure ポータル - アプリの登録](https://go.microsoft.com/fwlink/?linkid=2083908)ページに移動してアプリを登録します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-101">Navigate to the [Azure portal - App registrations](https://go.microsoft.com/fwlink/?linkid=2083908) page to register your app.</span></span>

1. <span data-ttu-id="09f2f-102">Microsoft 365 テナントに対して ***管理者*** の資格情報を使用してサインインします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-102">Sign in with the ***admin*** credentials to your Microsoft 365 tenancy.</span></span> <span data-ttu-id="09f2f-103">たとえば、MyName@contoso.onmicrosoft.com です。</span><span class="sxs-lookup"><span data-stu-id="09f2f-103">For example, MyName@contoso.onmicrosoft.com.</span></span>

1. <span data-ttu-id="09f2f-104">**[新規登録]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-104">Select **New registration**.</span></span> <span data-ttu-id="09f2f-105">**[アプリケーションを登録]** ページで、次のように値を設定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-105">On the **Register an application** page, set the values as follows.</span></span>

    * <span data-ttu-id="09f2f-106">**名前**を **$ADD-IN-NAME$** に設定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-106">Set **Name** to **$ADD-IN-NAME$**.</span></span>
    * <span data-ttu-id="09f2f-107">**[サポートされているアカウントの種類]** を **[任意の組織のディレクトリ内のアカウントと個人用の Microsoft アカウント (例: Skype、 Xbox、Outlook.com)]** に設定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-107">Set **Supported account types** to **Accounts in any organizational directory and personal Microsoft accounts (e.g. Skype, Xbox, Outlook.com)**.</span></span>
    * <span data-ttu-id="09f2f-108">**[リダイレクト URI]** を空のままにします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-108">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="09f2f-109">**[登録]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-109">Choose **Register**.</span></span>

1. <span data-ttu-id="09f2f-110">**$ADD-IN-NAME$** ページで、**アプリケーション (クライアント) ID**と**ディレクトリ (テナント) ID**の値をコピーして保存します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-110">On the **$ADD-IN-NAME$** page, copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**.</span></span> <span data-ttu-id="09f2f-111">以降の手順では、それらの両方を使用します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-111">You'll use both of them in later procedures.</span></span>

    > [!NOTE]
    > <span data-ttu-id="09f2f-112">この ID は、Office クライアントアプリケーション (PowerPoint、Word、Excel など) などの他のアプリケーションがアプリケーションへの承認されたアクセスをシークするときの、"対象ユーザー" の値です。</span><span class="sxs-lookup"><span data-stu-id="09f2f-112">This ID is the "audience" value when other applications, such as the Office client application (e.g., PowerPoint, Word, Excel), seek authorized access to the application.</span></span> <span data-ttu-id="09f2f-113">また、そのアプリケーションが Microsoft Graph への承認されたアクセスを求めるときには、このアプリケーションの「クライアント ID」になります。</span><span class="sxs-lookup"><span data-stu-id="09f2f-113">It is also the "client ID" of the application when it, in turn, seeks authorized access to Microsoft Graph.</span></span>

1. <span data-ttu-id="09f2f-114">**[管理]** で **[証明書とシークレット]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-114">Select **Certificates & secrets** under **Manage**.</span></span> <span data-ttu-id="09f2f-115">**[新しいクライアント シークレット]** ボタンを選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-115">Select the **New client secret** button.</span></span> <span data-ttu-id="09f2f-116">**[説明]** に値を入力してから、**[有効期限]** に適切なオプションを選択し、**[追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-116">Enter a value for **Description** then select an appropriate option for **Expires** and choose **Add**.</span></span> <span data-ttu-id="09f2f-117">*クライアント シークレットの値をすぐにコピーして、後の手順で必要になるため、先に進む前にアプリケーションIDと一緒に保存*してください。</span><span class="sxs-lookup"><span data-stu-id="09f2f-117">*Copy the client secret value immediately and save it with the application ID* before proceeding as you'll need it in a later procedure.</span></span>

1. <span data-ttu-id="09f2f-118">**[管理]** の下の **[API の公開]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-118">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="09f2f-119">**[設定]** リンクを選択して、「api://$App ID GUID$」の形式でアプリケーション ID URIを生成します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-119">Select the **Set** link to generate the Application ID URI in the form "api://$App ID GUID$".</span></span> <span data-ttu-id="09f2f-120">ダブル スラッシュと GUID の間に **$FQDN-WITHOUT-PROTOCOL$** (末尾にスラッシュ "/" を付けて) を挿入します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-120">Insert the **$FQDN-WITHOUT-PROTOCOL$** (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="09f2f-121">全体の ID は `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$` の形式になります。例: `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`。</span><span class="sxs-lookup"><span data-stu-id="09f2f-121">The entire ID should have the form `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$`; for example `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

    > [!NOTE]
    > <span data-ttu-id="09f2f-122">この時点で「アプリケーション ID の URI は、HTTPS、API、URN MS APPX で始まる有効な URI である必要があります。スラッシュで終わってはいけません。」という</span><span class="sxs-lookup"><span data-stu-id="09f2f-122">You may get an inaccurate error at this point saying "The application ID URI must be a valid URI starting with HTTPS, API, URN, MS-APPX.</span></span> <span data-ttu-id="09f2f-123">不正確なエラーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="09f2f-123">It must not end in a slash."</span></span> <span data-ttu-id="09f2f-124">ID が規定の条件を満たしている場合は、エラーを無視して変更を保存してください。</span><span class="sxs-lookup"><span data-stu-id="09f2f-124">If the ID meets the stated conditions, ignore the error and save your change.</span></span>

    > [!NOTE]
    > <span data-ttu-id="09f2f-125">ドメインを所有しているにもかかわらず、そのドメインが既に所有されているというエラーが表示される場合は、「[クイック スタート: カスタム ドメイン名を Azure Active Directory に追加する](/azure/active-directory/add-custom-domain)」の手順に従って登録し、この手順を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-125">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="09f2f-126">このエラーは、Microsoft 365 テナントの管理者の資格情報を使用してサインインしていない場合にも発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="09f2f-126">(This error can also occur if you are not signed in with credentials of an admin in the Microsoft 365 tenancy.</span></span> <span data-ttu-id="09f2f-127">手順 2 を参照してください。</span><span class="sxs-lookup"><span data-stu-id="09f2f-127">See step 2.</span></span> <span data-ttu-id="09f2f-128">サインアウトして、管理者の資格情報を使用して再度サインインし、手順 3 からプロセスを繰り返します。)</span><span class="sxs-lookup"><span data-stu-id="09f2f-128">Sign out and sign in again with admin credentials and repeat the process from step 3.)</span></span>

1. <span data-ttu-id="09f2f-129">**[Scope の追加]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-129">Select the **Add a scope** button.</span></span> <span data-ttu-id="09f2f-130">開いたパネルで、**[スコープ名]** として `access_as_user` を入力します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-130">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

1. <span data-ttu-id="09f2f-131">**[同意できるのはだれですか?]** を **[管理者とユーザー]** に設定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-131">Set **Who can consent?** to **Admins and users**.</span></span>

1. <span data-ttu-id="09f2f-132">ユーザーが `access_as_user` 現在のユーザーと同じ権限で Office クライアントアプリケーションでアドインの Web api を使用できるようにするには、[管理者] と [ユーザーの同意] を構成するためのフィールドに必要な値を入力します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-132">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope which enables the Office client application to use your add-in's web APIs with the same rights as the current user.</span></span> <span data-ttu-id="09f2f-133">提案:</span><span class="sxs-lookup"><span data-stu-id="09f2f-133">Suggestions:</span></span>

    - <span data-ttu-id="09f2f-134">**管理者の同意のタイトル:** Office はユーザーとして機能できます。</span><span class="sxs-lookup"><span data-stu-id="09f2f-134">**Admin consent title:** Office can act as the user.</span></span>
    - <span data-ttu-id="09f2f-135">**管理者の同意の説明:** 現在のユーザーと同じ権限で Office がアドインの Web API を呼び出すことを可能にします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-135">**Admin consent description:** Enable Office to call the add-in's web APIs with the same rights as the current user.</span></span>
    - <span data-ttu-id="09f2f-136">**ユーザーの同意のタイトル:** Office は自分として機能できます。</span><span class="sxs-lookup"><span data-stu-id="09f2f-136">**User consent title:** Office can act as you.</span></span>
    - <span data-ttu-id="09f2f-137">**管理者の同意の説明:** 自分と同じ権限で Office がアドインの Web API を呼び出すことを可能にします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-137">**Admin consent description:** Enable Office to call the add-in's web APIs with the same rights that you have.</span></span>

1. <span data-ttu-id="09f2f-138">**[状態]** が **[有効]** に設定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="09f2f-138">Ensure that **State** is set to **Enabled**.</span></span>

1. <span data-ttu-id="09f2f-139">**[スコープの追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-139">Select **Add scope**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="09f2f-140">テキスト フィールドのすぐ下に表示される **[スコープ名]** のドメイン部分は、たとえば `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user` のように手順で設定された **[アプリケーション ID URI]** と自動的に一致し、最後に `/access_as_user` が追加されます。</span><span class="sxs-lookup"><span data-stu-id="09f2f-140">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID URI** set in the previous step, with `/access_as_user` appended to the end; for example, `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`.</span></span>

1. <span data-ttu-id="09f2f-141">**[承認済みのクライアント アプリケーション]** セクションで、アドインの Web アプリケーションに対して承認するアプリケーションを特定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-141">In the **Authorized client applications** section, you identify the applications that you want to authorize to your add-in's web application.</span></span> <span data-ttu-id="09f2f-142">次のそれぞれの ID を事前承認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="09f2f-142">Each of the following IDs needs to be pre-authorized.</span></span>
  
    * <span data-ttu-id="09f2f-143">`d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office)</span><span class="sxs-lookup"><span data-stu-id="09f2f-143">`d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office)</span></span>
    * <span data-ttu-id="09f2f-144">`ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` (Microsoft Office)</span><span class="sxs-lookup"><span data-stu-id="09f2f-144">`ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` (Microsoft Office)</span></span>
    * <span data-ttu-id="09f2f-145">`57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office on the web)</span><span class="sxs-lookup"><span data-stu-id="09f2f-145">`57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office on the web)</span></span>
    * <span data-ttu-id="09f2f-146">`08e18876-6177-487e-b8b5-cf950c1e598c` (Office on the web)</span><span class="sxs-lookup"><span data-stu-id="09f2f-146">`08e18876-6177-487e-b8b5-cf950c1e598c` (Office on the web)</span></span>
    * <span data-ttu-id="09f2f-147">`bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook on the web)</span><span class="sxs-lookup"><span data-stu-id="09f2f-147">`bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook on the web)</span></span>

    <span data-ttu-id="09f2f-148">ID ごとに、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-148">For each ID, take these steps:</span></span>

      <span data-ttu-id="09f2f-149">a.</span><span class="sxs-lookup"><span data-stu-id="09f2f-149">a.</span></span> <span data-ttu-id="09f2f-150">**[クライアント アプリケーションの追加]** ボタンを選択し、表示されたパネルで **[クライアント ID]** をそれぞれの GUID に設定して `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$/access_as_user` のチェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-150">Select **Add a client application** button then, in the panel that opens, set the **Client ID** to the respective GUID and check the box for `api://$FQDN-WITHOUT-PROTOCOL$/$App ID GUID$/access_as_user`.</span></span>

      <span data-ttu-id="09f2f-151">b.</span><span class="sxs-lookup"><span data-stu-id="09f2f-151">b.</span></span> <span data-ttu-id="09f2f-152">**[アプリケーションの追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-152">Select **Add application**.</span></span>

1. <span data-ttu-id="09f2f-153">**[管理]** の下の **[認証]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-153">Select **Authentication** under **Manage**.</span></span> <span data-ttu-id="09f2f-154">**[リダイレクト URI]** セクションの **[種類]** ドロップダウンで **[Web]** を選択し、**[リダイレクト URI]** の値を `https://$FQDN-WITHOUT-PROTOCOL$` に設定します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-154">In the **Redirect URIs** section, select **Web** in the **Type** dropdown then set the **Redirect URI** value to `https://$FQDN-WITHOUT-PROTOCOL$`.</span></span>

1. <span data-ttu-id="09f2f-155">フォームの最上部で **[保存]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-155">Select **Save** at the top of the form.</span></span>

1. <span data-ttu-id="09f2f-156">**[管理]** の下の **[API アクセス許可]** を選択し、**[アクセス許可の追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-156">Select **API permissions** under **Manage** and select **Add a permission**.</span></span> <span data-ttu-id="09f2f-157">開いたパネルで、**[Microsoft Graph]** を選択してから **[委任されたアクセス許可]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-157">On the panel that opens, choose **Microsoft Graph** and then choose **Delegated permissions**.</span></span>

1. <span data-ttu-id="09f2f-158">アドインに必要な権限を検索するには、**[アクセス許可を選択]** の検索ボックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-158">Use the **Select permissions** search box to search for the permissions your add-in needs.</span></span> <span data-ttu-id="09f2f-159">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="09f2f-159">The following are examples.</span></span>

    * <span data-ttu-id="09f2f-160">Files.Read.All</span><span class="sxs-lookup"><span data-stu-id="09f2f-160">Files.Read.All</span></span>
    * <span data-ttu-id="09f2f-161">offline_access</span><span class="sxs-lookup"><span data-stu-id="09f2f-161">offline_access</span></span>
    * <span data-ttu-id="09f2f-162">openid</span><span class="sxs-lookup"><span data-stu-id="09f2f-162">openid</span></span>
    * <span data-ttu-id="09f2f-163">profile</span><span class="sxs-lookup"><span data-stu-id="09f2f-163">profile</span></span>

    > [!NOTE]
    > <span data-ttu-id="09f2f-164">`User.Read` アクセス許可は既定でリストされています。</span><span class="sxs-lookup"><span data-stu-id="09f2f-164">The `User.Read` permission may already be listed by default.</span></span> <span data-ttu-id="09f2f-165">必要でないアクセス許可は依頼しない方がよいため、アドインが実際に必要でない場合は、このアクセス許可のボックスのチェックをオフにしておくことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-165">It is a good practice not to ask for permissions that are not needed, so we recommend that you uncheck the box for this permission if your add-in does not actually need it.</span></span>

1. <span data-ttu-id="09f2f-166">表示された各権限のチェック ボックスをオンにします (各権限を選択しても、権限は一覧に表示されたままにはなりません)。</span><span class="sxs-lookup"><span data-stu-id="09f2f-166">Select the check box for each permission as it appears (note that the permissions will not remain visible in the list as you select each one).</span></span> <span data-ttu-id="09f2f-167">アドインに必要な権限を選択したら、パネルの下部にある **[アクセス許可を追加する]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="09f2f-167">After selecting the permissions that your add-in needs, select the **Add permissions** button at the bottom of the panel.</span></span>
