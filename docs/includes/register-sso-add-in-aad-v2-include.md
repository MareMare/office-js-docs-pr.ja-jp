## <a name="create-an-app-registration"></a>アプリの登録を作成する

アプリケーション (アドイン) を登録すると、アドインとMicrosoft ID プラットフォームの間に信頼関係が確立されます。 信頼は単方向です。アドインはMicrosoft ID プラットフォームを信頼し、逆の方法は信頼しません。

1. ***admin** _ 資格情報を [使用してMicrosoft 365](https://portal.azure.com/)テナントにAzure portalにサインインします。 たとえば、_*MyName@contoso.onmicrosoft.com**。
1. [**管理**] で、[**アプリの登録** > **新しい登録**] を選択します。 **[アプリケーションを登録]** ページで、次のように値を設定します。

    * `<add-in-name>` に **[名前]** を設定します。
    * **組織のディレクトリ (任意のAzure AD ディレクトリ - マルチテナント) および個人用 Microsoft アカウント (Skype、Xbox など) で、****サポートされている** アカウントの種類を [アカウント] に設定します。
    * **[リダイレクト URI]** を空のままにします。
    * **[登録]** を選択します。

1. **アプリケーション (クライアント) ID** と **ディレクトリ (テナント)** ID の値をコピーして保存します。 以降の手順では、それらの両方を使用します。

    > [!NOTE]
    > この ID は、Office クライアント アプリケーション (PowerPoint、Word、Excelなど) などの他のアプリケーションがアプリケーションへの承認されたアクセスを求める場合の "対象ユーザー" 値です。 また、そのアプリケーションが Microsoft Graph への承認されたアクセスを求めるときには、このアプリケーションの「クライアント ID」になります。

## <a name="add-a-client-secret"></a>クライアント シークレットを追加する

_アプリケーション パスワード_ と呼ばれることもあります。クライアント シークレットは、証明書の代わりにアプリが ID 自体に使用できる文字列値です。

1. Azure portalの **アプリの登録** で、アプリケーションを選択します。
1. [**証明書& secretsClient secretsNew** >  >  **クライアント シークレット**] を選択します。
1. クライアント シークレットの説明を追加します。
1. シークレットの有効期限を選択するか、カスタム有効期間を指定します。
    * クライアント シークレットの有効期間は 2 年間 (24 か月) 以下に制限されます。 24 か月を超えるカスタム有効期間を指定することはできません。
    * 有効期限の値は 12 か月未満に設定することをお勧めします。
1. [**追加**] を選択します。
1. クライアント アプリケーション コードで使用する _シークレットの値を記録_ します。 このページを離れると、このシークレット値は _再び表示されません_ 。

## <a name="expose-a-web-api"></a>Web API を公開する

1. 作成したアプリの登録が表示されていることを確認します。
1. [ **管理**] で [ **API の公開**] を選択し、[ **設定** ] リンクを選択します。 これにより、フォームに生成された **アプリケーション ID URI** を含む [アプリ ID URI の設定] ボックスが開きます `api://<application-id>`。 の前に完全修飾ドメイン名を挿入します `<application-id>`。 ID 全体にはフォーム `api://<fully-qualified-domain-name>/<application-id>`が必要です。たとえば、 `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.

    > [!NOTE]
    > ドメインを所有しているにもかかわらず、そのドメインが既に所有されているというエラーが表示される場合は、「[クイック スタート: カスタム ドメイン名を Azure Active Directory に追加する](/azure/active-directory/add-custom-domain)」の手順に従って登録し、この手順を繰り返します。 (このエラーは、Microsoft 365 テナントの管理者の資格情報を使用してサインインしていない場合にも発生する可能性があります。 手順 2 を参照してください。 サインアウトして、管理者の資格情報を使用して再度サインインし、手順 3 からプロセスを繰り返します。)

## <a name="add-a-scope"></a>スコープを追加する

1. **[Scope の追加]** ボタンをクリックします。 開いたパネルで、**[スコープ名]** として `access_as_user` を入力します。

1. **[同意できるのはだれですか?]** を **[管理者とユーザー]** に設定します。

1. 管理者とユーザーの同意プロンプトを構成するためのフィールドに、現在のユーザーと同じ権限を持つアドインの Web API をOfficeクライアント アプリケーションで使用できるようにするスコープに適`access_as_user`した値を入力します。 提案:

    * **管理者の同意表示名:** Officeユーザーとして機能できます。
    * **管理者の同意の説明:** 現在のユーザーと同じ権限で Office がアドインの Web API を呼び出すことを可能にします。
    * **ユーザーの同意表示名:** Officeはユーザーとして機能できます。
    * **ユーザーの同意の説明**: 自分と同じ権限で Office がアドインの Web API を呼び出すことを可能にします。

1. **[状態]** が **[有効]** に設定されていることを確認してください。

1. **[スコープの追加]** を選択します。

    > [!NOTE]
    > テキスト フィールドのすぐ下に表示される **[スコープ名]** のドメイン部分は、たとえば `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user` のように手順で設定された **[アプリケーション ID URI]** と自動的に一致し、最後に `/access_as_user` が追加されます。

1. [**承認済みクライアント アプリケーション**] セクションで、次の ID を入力して、すべてのMicrosoft Officeアプリケーション エンドポイントを事前に承認します。

   - `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e`(すべてのMicrosoft Officeアプリケーション エンドポイント)

    > [!NOTE]
    > ID は`ea5a67f6-b6f3-4338-b240-c655ddc3cc8e`、次のすべてのプラットフォームでOfficeを事前に承認します。 または、何らかの理由で一部のプラットフォームでOfficeへの承認を拒否する場合は、次の ID の適切なサブセットを入力することもできます。 承認を保留するプラットフォームの ID は残しておきます。 これらのプラットフォーム上のアドインのユーザーは、Web API を呼び出すことはできませんが、アドイン内の他の機能は引き続き機能します。
    >
    > - `d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office)
    > - `93d53678-613d-4013-afc1-62e9e444a0a5` (Office on the web)
    > - `bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook on the web)

1. **[クライアント アプリケーションの追加]** を選択します。 開いたパネルで、 **クライアント ID を** それぞれの GUID に設定し `api://<fully-qualified-domain-name>/<application-id>/access_as_user`、[.

1. **[アプリケーションの追加]** を選択します。

## <a name="add-microsoft-graph-permissions"></a>Microsoft Graph アクセス許可を追加する

1. [ **管理**] で [ **認証**] を選択し、[ **プラットフォームの追加]** を選択します。

1. [ **プラットフォームの構成** ] ウィンドウで [ **Web**] を選択し、[ **リダイレクト URI** ] の値を `https://<fully-qualified-domain-name>`[リダイレクト URI] に設定します。

1. [ **構成] を選択します**。

1. [ **管理**] で [ **API アクセス許可**] を選択し、[ **アクセス許可の追加]** を選択します。 開いたパネルで[**Microsoft Graph**]、[**委任されたアクセス許可**] の順に選択します。

1. アドインに必要な権限を検索するには、**[アクセス許可を選択]** の検索ボックスを使用します。 次に例を示します。

    * Files.Read.All
    * offline_access
    * openid
    * profile

    > [!NOTE]
    > `User.Read` アクセス許可は既定でリストされています。 必要なアクセス許可のみを要求することをお勧めします。そのため、アドインで実際に必要ない場合は、このアクセス許可のチェック ボックスをオフにすることをお勧めします。

1. 表示された各権限のチェック ボックスをオンにします (各権限を選択しても、権限は一覧に表示されたままにはなりません)。 アドインに必要なアクセス許可を選択したら、[ **アクセス許可の追加** ] ボタンを選択します。
