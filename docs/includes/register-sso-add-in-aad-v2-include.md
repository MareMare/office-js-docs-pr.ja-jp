## <a name="create-an-app-registration"></a>アプリの登録を作成する

アプリケーション (アドイン) を登録すると、アドインとアドイン間の信頼関係が確立Microsoft ID プラットフォーム。 信頼は一方向です。アドインは他の方法ではなく、Microsoft ID プラットフォームを信頼します。

1. テナントに [対する *](https://portal.azure.com/)**admin** _ 資格情報を使用して Azure portal にサインインMicrosoft 365します。 たとえば、_*MyName@contoso.onmicrosoft.com**。
1. [管理 **] で**、[ **アプリの登録] を選択します** > **。新しい登録**。 **[アプリケーションを登録]** ページで、次のように値を設定します。

    * `<add-in-name>` に **[名前]** を設定します。
    * [**サポートされているアカウントの** 種類] を任意の組織ディレクトリの [アカウント **] (Azure AD ディレクトリ - マルチテナント) と個人用 Microsoft アカウント (Skype、Xbox など) に** 設定します。
    * **[リダイレクト URI]** を空のままにします。
    * **[登録]** を選択します。

1. アプリケーション (クライアント) ID と **ディレクトリ (テナント) ID** の値をコピーして **保存します**。 以降の手順では、それらの両方を使用します。

    > [!NOTE]
    > この ID は、Office クライアント アプリケーション (PowerPoint、Word、Excel など) などの他のアプリケーションがアプリケーションへの承認されたアクセスを求める場合の "対象ユーザー" の値です。 また、そのアプリケーションが Microsoft Graph への承認されたアクセスを求めるときには、このアプリケーションの「クライアント ID」になります。

## <a name="add-a-client-secret"></a>クライアント シークレットの追加

アプリケーション パスワードと _呼ばれる場合_ があります。クライアント シークレットは、アプリが ID 自体に証明書の代用として使用できる文字列値です。

1. Azure portal の [アプリの登録 **] で、アプリケーション** を選択します。
1. [**証明書とシークレット&クライアント シークレット** >  > **の新****しいクライアント シークレット] を選択します**。
1. クライアント シークレットの説明を追加します。
1. シークレットの有効期限を選択するか、カスタム有効期間を指定します。
    * クライアント シークレットの有効期間は、2 年 (24 か月) 以下に制限されます。 24 か月を超えるカスタム有効期間を指定できない。
    * 有効期限の値を 12 か月未満に設定してください。
1. **[追加]** を選択します。
1. _クライアント アプリケーション コードで使用する_ シークレットの値を記録します。 このシークレット値は _、このページを離_ れた後に再び表示されません。

## <a name="expose-a-web-api"></a>Web API を公開する

1. 作成したアプリ登録が表示されている必要があります。
1. [ **管理] で**、[ **API の公開] を選択** し、[設定] リンク **を選択** します。 これにより、フォーム **に生成されたアプリケーション ID URI** を含む [アプリ ID URI の設定] ボックスが開きます `api://<application-id>`。 完全修飾ドメイン名を前に挿入します `<application-id>`。 ID 全体にフォーム (たとえば `api://<fully-qualified-domain-name>/<application-id>`) が必要です `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`。

    > [!NOTE]
    > ドメインを所有しているにもかかわらず、そのドメインが既に所有されているというエラーが表示される場合は、「[クイック スタート: カスタム ドメイン名を Azure Active Directory に追加する](/azure/active-directory/add-custom-domain)」の手順に従って登録し、この手順を繰り返します。 (このエラーは、テナント内の管理者の資格情報でサインインしていない場合Microsoft 365があります。 手順 2 を参照してください。 サインアウトして、管理者の資格情報を使用して再度サインインし、手順 3 からプロセスを繰り返します。)

## <a name="add-a-scope"></a>スコープを追加する

1. **[Scope の追加]** ボタンをクリックします。 開いたパネルで、**[スコープ名]** として `access_as_user` を入力します。

1. **[同意できるのはだれですか?]** を **[管理者とユーザー]** に設定します。

1. `access_as_user`管理者とユーザーの同意のプロンプトを構成するためのフィールドに、Office クライアント アプリケーションが現在のユーザーと同じ権限でアドインの Web API を使用できる範囲に適した値を入力します。 提案:

    * **管理者の同意表示名: Office** ユーザーとして機能する場合があります。
    * **管理者の同意の説明:** 現在のユーザーと同じ権限で Office がアドインの Web API を呼び出すことを可能にします。
    * **ユーザーの同意表示名: Office** ユーザーとして機能できます。
    * **ユーザーの同意の説明**: 自分と同じ権限で Office がアドインの Web API を呼び出すことを可能にします。

1. **[状態]** が **[有効]** に設定されていることを確認してください。

1. **[スコープの追加]** を選択します。

    > [!NOTE]
    > テキスト フィールドのすぐ下に表示される **[スコープ名]** のドメイン部分は、たとえば `api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user` のように手順で設定された **[アプリケーション ID URI]** と自動的に一致し、最後に `/access_as_user` が追加されます。

1. **[承認済みのクライアント アプリケーション]** セクションで、アドインの Web アプリケーションに対して承認するアプリケーションを特定します。 次のそれぞれの ID を事前承認する必要があります。
  
    * `d3590ed6-52b3-4102-aeff-aad2292ab01c` (Microsoft Office)
    * `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` (Microsoft Office)
    * `93d53678-613d-4013-afc1-62e9e444a0a5` (Office on the web)
    * `57fb890c-0dab-4253-a5e0-7188c88b2bb4` (Office on the web)
    * `08e18876-6177-487e-b8b5-cf950c1e598c` (Office on the web)
    * `bc59ab01-8403-45c6-8796-ac3ef710b3e3` (Outlook on the web)

    > [!NOTE]
    > ID `ea5a67f6-b6f3-4338-b240-c655ddc3cc8e` には、リストされている他のすべての ID が含まれています。Office アドイン SSO フローでサービスで使用するために、すべての Office ホスト エンドポイントを事前承認するために単独で使用できます。

    ID ごとに、次の手順を実行します。

      a.  **[クライアント アプリケーションの追加]** を選択します。 開くパネルで、クライアント ID を **それぞれの GUID** に設定し、 のチェック ボックスをオンにします `api://<fully-qualified-domain-name>/<application-id>/access_as_user`。

      b. **[アプリケーションの追加]** を選択します。

## <a name="add-microsoft-graph-permissions"></a>Microsoft のアクセス許可Graph追加する

1. [管理 **] で**、[ **認証] を** 選択し、[プラットフォーム **の追加] を選択します**。

1. [プラットフォーム **の構成] ウィンドウで** 、[ **Web**] を選択し、[ **リダイレクト URI** ] の値をに設定します `https://<fully-qualified-domain-name>`。

1. [構成 **] を選択します**。

1. [ **管理] で**[ **API アクセス許可] を選択** し、[アクセス許可 **の追加] を選択します**。 開いたパネルで、[Microsoft Graph] **を選択** し、[委任されたアクセス許可 **] を選択します**。

1. アドインに必要な権限を検索するには、**[アクセス許可を選択]** の検索ボックスを使用します。 次に例を示します。

    * Files.Read.All
    * offline_access
    * openid
    * profile

    > [!NOTE]
    > `User.Read` アクセス許可は既定でリストされています。 必要なアクセス許可のみを要求することをお勧めします。そのため、アドインが実際に必要としていない場合は、このアクセス許可のボックスをオフにすることをお勧めします。

1. 表示された各権限のチェック ボックスをオンにします (各権限を選択しても、権限は一覧に表示されたままにはなりません)。 アドインに必要なアクセス許可を選択した後、[アクセス許可の追加 **] ボタンを選択** します。
