---
title: シングル サインオン (SSO) のエラー メッセージのトラブルシューティング
description: ''
ms.date: 12/08/2017
ms.openlocfilehash: d0235f767dd6c41b10d7d594425da603d6a523da
ms.sourcegitcommit: 60fd8a3ac4a6d66cb9e075ce7e0cde3c888a5fe9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/28/2018
ms.locfileid: "27457937"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="a1ec6-102">シングル サインオン (SSO) のエラー メッセージのトラブルシューティング (プレビュー)</span><span class="sxs-lookup"><span data-stu-id="a1ec6-102">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="a1ec6-103">この記事では、Office アドインのシングル サインオン (SSO) に関する問題のトラブルシューティング方法と、SSO が有効なアドインによって特別な条件やエラーを確実に処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-103">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="a1ec6-104">現在、シングル サインオン API は Word、Excel、Outlook、PowerPoint のプレビューでサポートされています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-104">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="a1ec6-105">シングル サインオン API の現在のサポート状態に関する詳細については、[IdentityAPI の要件セット]https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-105">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets]https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="a1ec6-106">SSO を使用するには、アドインのスタートアップ HTML ページの https://appsforoffice.microsoft.com/lib/beta/hosted/office.js から Office JavaScript ライブラリのベータ版を読み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-106">To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in.</span></span>
> <span data-ttu-id="a1ec6-107">Outlook アドインで作業している場合は、Office 365 テナントの先進認証が有効になっていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-107">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="a1ec6-108">この方法の詳細については、「[Exchange Online: テナントの先進認証を有効にする方法](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-108">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="a1ec6-109">デバッグ ツール</span><span class="sxs-lookup"><span data-stu-id="a1ec6-109">Debugging tools</span></span>

<span data-ttu-id="a1ec6-p102">開発時は、アドインの Web サービスからの HTTP 要求および応答を傍受して表示することができるツールを使用することを強くお勧めします。最も一般的なものは、次の 2 つです。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-p102">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span>

- <span data-ttu-id="a1ec6-112">[Fiddler](https://www.telerik.com/fiddler): 無料 ([ドキュメント](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="a1ec6-112">[Fiddler](https://www.telerik.com/fiddler): Free ([Documentation](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="a1ec6-113">[Charles](https://www.charlesproxy.com/): 30 日間無料 </span><span class="sxs-lookup"><span data-stu-id="a1ec6-113">[Charles](https://www.charlesproxy.com/): Free for 30 days.</span></span> <span data-ttu-id="a1ec6-114">([ドキュメント](https://www.charlesproxy.com/documentation/))。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-114">([Documentation](https://www.charlesproxy.com/documentation/))</span></span>

<span data-ttu-id="a1ec6-115">サービス API を開発する際には、次のツールを試してみることもできます。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-115">When developing your service API, you may also want to try:</span></span>

- <span data-ttu-id="a1ec6-116">[Postman](https://www.getpostman.com/postman):無料 ([ドキュメント](https://www.getpostman.com/docs/))</span><span class="sxs-lookup"><span data-stu-id="a1ec6-116">[Postman](https://www.getpostman.com/postman): Free ([Documentation](https://www.getpostman.com/docs/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstokenasync"></a><span data-ttu-id="a1ec6-117">getAccessTokenAsync からのエラーの原因と処理</span><span class="sxs-lookup"><span data-stu-id="a1ec6-117">Causes and handling of errors from getAccessTokenAsync</span></span>

<span data-ttu-id="a1ec6-118">このセクションで説明するエラー処理の例については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-118">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="a1ec6-119">Office-Add-in-ASPNET-SSO の Home.js</span><span class="sxs-lookup"><span data-stu-id="a1ec6-119">Home.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/Home.js)
- [<span data-ttu-id="a1ec6-120">Office-Add-in-NodeJS-SSO の program.js</span><span class="sxs-lookup"><span data-stu-id="a1ec6-120">program.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/public/program.js)

> [!NOTE]
> <span data-ttu-id="a1ec6-121">このセクションの提案以外にも、Outlook アドインには任意の 13*nnn* のエラーに対応するその他の方法があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-121">Besides the suggestions made in this section, an Outlook add-in has an additional way to respond to any 13*nnn* error.</span></span> <span data-ttu-id="a1ec6-122">詳細については、「[シナリオ: Outlook アドインでサービスにシングル サインオンを実装する](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in)」と [AttachmentsDemo サンプル アドイン](https://github.com/OfficeDev/outlook-add-in-attachments-demo)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-122">For details, see [Scenario: Implement single sign-on to your service in an Outlook add-in](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in) and [AttachmentsDemo Sample Add-in](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span></span>

### <a name="13000"></a><span data-ttu-id="a1ec6-123">13000</span><span class="sxs-lookup"><span data-stu-id="a1ec6-123">13000</span></span>

<span data-ttu-id="a1ec6-124">[getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API は、このアドインまたは Office バージョンではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-124">The [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API is not supported by the add-in or the Office version.</span></span>

- <span data-ttu-id="a1ec6-p105">このバージョンの Office は、SSO をサポートしていません。所要のバージョンは Office 2016 バージョン 1710、ビルド 8629.nnnn 以降 (「クイック実行」と呼ばれることもある Office 365 のサブスクリプション バージョン) です。このバージョンを入手するには、Office Insider への参加が必要になることがあります。詳細については、「[Office Insider](https://products.office.com/office-insider?tab=tab-1)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-p105">The version of Office does not support SSO. The required version is Office 2016, Version 1710, build 8629.nnnn or later (the Office 365 subscription version, sometimes called “Click to Run”). You might need to be an Office Insider to get this version. For more information, see [Be an Office Insider](https://products.office.com/office-insider?tab=tab-1).</span></span> 
- <span data-ttu-id="a1ec6-129">アドインのマニフェストに適切な [WebApplicationInfo](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/webapplicationinfo) セクションがありません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-129">The add-in manifest is missing the proper [WebApplicationInfo](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/webapplicationinfo) section.</span></span>

<span data-ttu-id="a1ec6-130">アドインがこのエラーに対応するには、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-130">Your add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="a1ec6-131">詳細については、「[要件とベスト プラクティス](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-131">For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span></span>

### <a name="13001"></a><span data-ttu-id="a1ec6-132">13001</span><span class="sxs-lookup"><span data-stu-id="a1ec6-132">13001</span></span>

<span data-ttu-id="a1ec6-133">ユーザーは Office にサインインしていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-133">The user is not signed into Office.</span></span> <span data-ttu-id="a1ec6-134">コードでは、`getAccessTokenAsync` メソッドを再度呼び出して、[options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) パラメーターでオプション `forceAddAccount: true` を渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-134">Your code should recall the `getAccessTokenAsync` method and pass the option `forceAddAccount: true` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="a1ec6-135">ただし、この操作は複数回実行しないでください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-135">But don't do this more than once.</span></span> <span data-ttu-id="a1ec6-136">ユーザーはサインインしないと判断する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-136">The user may have decided not to sign-in.</span></span>

<span data-ttu-id="a1ec6-137">Office Online では、このエラーが発生することはありません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-137">This error is never seen in Office Online.</span></span> <span data-ttu-id="a1ec6-138">ユーザーの Cookie が失効している場合、Office Online はエラー 13006 を返します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-138">If the user's cookie expires, Office Online returns error 13006.</span></span>

### <a name="13002"></a><span data-ttu-id="a1ec6-139">13002</span><span class="sxs-lookup"><span data-stu-id="a1ec6-139">13002</span></span>

<span data-ttu-id="a1ec6-140">ユーザーが、同意ダイアログの **[キャンセル]** を選択するなどして、サインインまたは同意を中止しました。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-140">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span>

- <span data-ttu-id="a1ec6-141">アドインがユーザーのサインイン (または同意) の必要がない機能を提供している場合、コードはこのエラーをキャッチし、アドインが継続して実行するようにしなければなりません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-141">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="a1ec6-142">アドインで、同意を得たサインイン ユーザーが必要な場合、コードはユーザーに操作を繰り返すよう 1 度だけ要求する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-142">If the add-in requires a signed-in user who has granted consent, your code should ask the user to repeat the operation, but not more than once.</span></span>

### <a name="13003"></a><span data-ttu-id="a1ec6-143">13003</span><span class="sxs-lookup"><span data-stu-id="a1ec6-143">13003</span></span>

<span data-ttu-id="a1ec6-144">ユーザーの種類がサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-144">User Type not supported.</span></span> <span data-ttu-id="a1ec6-145">ユーザーは、有効な Microsoft アカウントまたは Office 365 ("職場または学校") アカウントで Office にサインインしていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-145">The user isn't signed into Office with a valid Microsoft Account or Office 365 ("Work or School") account.</span></span> <span data-ttu-id="a1ec6-146">このエラーは、Office がオンプレミス ドメイン アカウントで実行されている場合に発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-146">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="a1ec6-147">Office にサインインするか、代わりのユーザー認証システムにフォールバックするようにユーザーに求めるコードを作成します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-147">Your code should either ask the user to sign in to Office or fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="a1ec6-148">詳細については、「[要件とベスト プラクティス](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-148">For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>

### <a name="13004"></a><span data-ttu-id="a1ec6-149">13004</span><span class="sxs-lookup"><span data-stu-id="a1ec6-149">13004</span></span>

<span data-ttu-id="a1ec6-150">無効なリソースです。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-150">Invalid Resource.</span></span> <span data-ttu-id="a1ec6-151">アドイン マニフェストは、正しく構成されていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-151">The add-in manifest hasn’t been configured correctly.</span></span> <span data-ttu-id="a1ec6-152">マニフェストを更新してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-152">Update the manifest.</span></span> <span data-ttu-id="a1ec6-153">詳細については、「[マニフェストの問題を検証し、トラブルシューティングする](../testing/troubleshoot-manifest.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-153">For more information, see [Validate and troubleshoot issues with your manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="a1ec6-154">最も一般的な問題は、**Resource** 要素 (**WebApplicationInfo** 要素内) にアドインのドメインと一致しないドメインがあることです。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-154">The most common problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="a1ec6-155">Resource 値のプロトコル部分は "https" ではなく "api" である必要があります。ドメイン名の他のすべての部分は (ポートがある場合はそれも含めて)、アドインと同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-155">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="a1ec6-156">13005</span><span class="sxs-lookup"><span data-stu-id="a1ec6-156">13005</span></span>

<span data-ttu-id="a1ec6-157">無効な許可です。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-157">Invalid Grant.</span></span> <span data-ttu-id="a1ec6-158">このエラーは、通常、Office がアドインの Web サービスに対して事前に承認されていないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-158">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="a1ec6-159">詳細については、「[サービス アプリケーションを作成する](sso-in-office-add-ins.md#create-the-service-application)」、および「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint)」(ASP.NET) または「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint)」(Node JS) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-159">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS).</span></span> <span data-ttu-id="a1ec6-160">このエラーは、ユーザーが自分の `profile` に対するアクセス許可をサービス アプリケーションに与えていない場合にも発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-160">This also may happen if the user has not granted your service application permissions to their `profile`.</span></span>

### <a name="13006"></a><span data-ttu-id="a1ec6-161">13006</span><span class="sxs-lookup"><span data-stu-id="a1ec6-161">13006</span></span>

<span data-ttu-id="a1ec6-p112">クライアント エラー。コードでは、ユーザーにサインアウトしてから Office を再起動するように指示するか、Office Online セッションを再開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-p112">Client Error. Your code should suggest that the user sign out and restart Office, or restart the Office Online session.</span></span>

### <a name="13007"></a><span data-ttu-id="a1ec6-164">13007</span><span class="sxs-lookup"><span data-stu-id="a1ec6-164">13007</span></span>

<span data-ttu-id="a1ec6-165">Office ホストは、アドインの Web サービスへのアクセス トークンを取得できませんでした。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-165">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="a1ec6-166">開発中にこのエラーが発生する場合は、アドインの登録とアドインのマニフェストで `openid` および `profile` のアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-166">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `openid` and `profile` permissions.</span></span> <span data-ttu-id="a1ec6-167">詳細については、「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint)」(ASP.NET) または「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint)」(Node JS)、および「[アドインを構成する](create-sso-office-add-ins-aspnet.md#configure-the-add-in)」(ASP.NET) または「[アドインを構成する](create-sso-office-add-ins-nodejs.md#configure-the-add-in)」(Node JS) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-167">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>
- <span data-ttu-id="a1ec6-168">運用環境では、このエラーの原因として考えられることがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-168">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="a1ec6-169">その一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-169">Some of them are:</span></span>
    - <span data-ttu-id="a1ec6-170">ユーザーが、以前は同意していた内容を取り消しました。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-170">The user has revoked consent, after previously granting it.</span></span> <span data-ttu-id="a1ec6-171">コードでオプション `forceConsent: true` を指定して `getAccessTokenAsync` メソッドをもう一度呼び出す必要があるのに、複数回の呼び出を行いました。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-171">Your code should recall the `getAccessTokenAsync` method with the option `forceConsent: true`, but no more than once.</span></span>
    - <span data-ttu-id="a1ec6-172">ユーザーは Microsoft アカウント (MSA) ID を使用しています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-172">The user is has an Microsoft Account (MSA) identity.</span></span> <span data-ttu-id="a1ec6-173">職場または学校アカウントで他の 13nnn エラーのいずれかが発生する状況の場合、MSA を使用すると 13007 が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-173">Some situations that would cause one of the other 13nnn errors with a Work or School account, will cause a 13007 when a MSA is used.</span></span> 

  <span data-ttu-id="a1ec6-174">以上のいずれの場合でも、`forceConsent` オプションを既に一度試行している場合は、操作を後でやり直すようにユーザーに提案するコードを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-174">For all of these cases, if you have already tried the `forceConsent` option once, then your code could suggest that the user retry the operation later.</span></span>

### <a name="13008"></a><span data-ttu-id="a1ec6-175">13008</span><span class="sxs-lookup"><span data-stu-id="a1ec6-175">13008</span></span>

<span data-ttu-id="a1ec6-176">ユーザーは、前回の `getAccessTokenAsync` の呼び出しが完了する前に `getAccessTokenAsync` を呼び出す操作をトリガーしました。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-176">The user triggered an operation that calls `getAccessTokenAsync` before a previous call of `getAccessTokenAsync` completed.</span></span> <span data-ttu-id="a1ec6-177">コードでは、ユーザーに前の操作が完了した後に操作を繰り返すよう、要求する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-177">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13009"></a><span data-ttu-id="a1ec6-178">13009</span><span class="sxs-lookup"><span data-stu-id="a1ec6-178">13009</span></span>

<span data-ttu-id="a1ec6-179">アドインは、オプション `forceConsent: true` を指定して `getAccessTokenAsync` メソッドを呼び出しましたが、アドインのマニフェストが強制的な同意をサポートしていない種類のカタログに展開されています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-179">The add-in called the `getAccessTokenAsync` method with the option `forceConsent: true`, but the add-in's manifest is deployed to a type of catalog that does not support forcing consent.</span></span> <span data-ttu-id="a1ec6-180">コードでは、`getAccessTokenAsync` メソッドを再度呼び出して、[options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) パラメーターでオプション `forceConsent: false` を渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-180">Your code should recall the `getAccessTokenAsync` method and pass the option `forceConsent: false` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="a1ec6-181">ただし、`forceConsent: true` を指定した `getAccessTokenAsync` の呼び出し自体が、`forceConsent: false` を指定した `getAccessTokenAsync` の失敗した呼び出しに対する自動的な応答の可能性があるため、コードでは、`forceConsent: false` を指定した `getAccessTokenAsync` が既に呼び出されているかどうかを追跡記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-181">However, the call of  `getAccessTokenAsync`  with `forceConsent: true` might itself have been an automatic response to a failed call of `getAccessTokenAsync` with `forceConsent: false`, so your code should keep track of whether `getAccessTokenAsync` with `forceConsent: false` has already been called.</span></span> <span data-ttu-id="a1ec6-182">この場合、Office からサインアウトしてサインインし直すか、代わりのユーザー認証システムにフォールバックするようにユーザーに指示するコードを作成します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-182">If it has, your code should either tell the user to sign out of Office and sign-in again or it should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="a1ec6-183">詳細については、「[要件とベスト プラクティス](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-183">For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span></span>

> [!NOTE]
> <span data-ttu-id="a1ec6-184">Microsoft は、必ずしもすべての種類のアドイン カタログに、この制約を課す予定はありません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-184">Microsoft will not necessarily impose this restriction on any types of add-in catalogs.</span></span> <span data-ttu-id="a1ec6-185">制約が課されていない場合は、このエラーが発生することはありません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-185">If it doesn't, then this error will never be seen.</span></span>

### <a name="13010"></a><span data-ttu-id="a1ec6-186">13010</span><span class="sxs-lookup"><span data-stu-id="a1ec6-186">13010</span></span>

<span data-ttu-id="a1ec6-187">ユーザーが Office Online でアドインを実行していて、Edge または Internet Explorer を使用しています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-187">The user is running the add-in on Office Online and is using Edge or Internet Explorer.</span></span> <span data-ttu-id="a1ec6-188">ユーザーの Office 365 ドメインと、login.microsoftonline.com ドメインは、ブラウザー設定で異なるセキュリティ ゾーンに含まれています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-188">The user’s Office 365 domain, and the login.microsoftonline.com domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="a1ec6-189">このエラーが返された場合、ユーザーには、これについて説明するエラーとゾーンの構成を変更する方法に関するページへのリンクが表示されています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-189">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="a1ec6-190">アドインがユーザーのサインインを必要としない機能を提供している場合、コードでは、このエラーをキャッチして、アドインの実行を続行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-190">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="a1ec6-191">13012</span><span class="sxs-lookup"><span data-stu-id="a1ec6-191">13012</span></span>

<span data-ttu-id="a1ec6-192">アドインは、`getAccessTokenAsync` API をサポートしていないプラットフォーム上で実行されています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-192">The add-in is running on a platform that does not support the `getAccessTokenAsync` API.</span></span> <span data-ttu-id="a1ec6-193">たとえば、iPad 上ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-193">For example, it is not supported on iPad.</span></span> <span data-ttu-id="a1ec6-194">「[Identity API の要件セット](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets)」も参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-194">See also [Identity API Requirement Sets](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>

### <a name="50001"></a><span data-ttu-id="a1ec6-195">50001</span><span class="sxs-lookup"><span data-stu-id="a1ec6-195">50001</span></span>

<span data-ttu-id="a1ec6-196">このエラー (`getAccessTokenAsync` に固有ではありません) は、ブラウザーが office.js ファイルの古いコピーをキャッシュしていることを示す可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-196">This error (which is not specific to `getAccessTokenAsync`) may indicate that the browser has cached an old copy of the office.js files.</span></span> <span data-ttu-id="a1ec6-197">開発中の場合は、ブラウザーのキャッシュをクリアしてください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-197">When you are developing, clear the browser's cache.</span></span> <span data-ttu-id="a1ec6-198">また、Office のバージョンが古いため、SSO をサポートしていない可能性も考えられます。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-198">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="a1ec6-199">「[前提条件](create-sso-office-add-ins-aspnet.md#prerequisites)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-199">See [Prerequisites](create-sso-office-add-ins-aspnet.md#prerequisites).</span></span>

<span data-ttu-id="a1ec6-200">運用環境のアドインの場合、アドインがこのエラーに対応するには、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-200">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="a1ec6-201">詳細については、「[要件とベスト プラクティス](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-201">For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>


## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="a1ec6-202">Azure Active Directory からのサーバー側のエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-202">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="a1ec6-203">このセクションで説明するエラー処理の例については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-203">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="a1ec6-204">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="a1ec6-204">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="a1ec6-205">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="a1ec6-205">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)


### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="a1ec6-206">条件付きアクセスおよび多要素認証のエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-206">Conditional access / Multifactor authentication errors</span></span>
 
<span data-ttu-id="a1ec6-207">AAD および Office 365 の特定の ID 構成では、Microsoft Graph でアクセス可能な一部のリソースで、ユーザーの Office 365 のテナントでは必要ない場合でも、多要素認証 (MFA) が必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-207">In certain configurations of identity in AAD and Office 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Office 365 tenancy does not.</span></span> <span data-ttu-id="a1ec6-208">AAD は、MFA で保護されたリソースへのトークンの要求を、代理フロー経由で受け取ると、アドインの Web サービスに `claims` プロパティを含む JSON メッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-208">When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property.</span></span> <span data-ttu-id="a1ec6-209">claims プロパティには、さらに必要となる認証要素の情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-209">The claims property has information about what further authentication factors are needed.</span></span>

<span data-ttu-id="a1ec6-210">サーバー側のコードはこのメッセージをテストし、クライアント側のコードに claims 値を中継する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-210">Your server-side code should test for this message and relay the claims value to your client-side code.</span></span> <span data-ttu-id="a1ec6-211">Office が SSO アドインの認証を処理するため、この情報がクライアントで必要になります。クライアントへのメッセージは、エラー (`500 Server Error` や `401 Unauthorized` など) または成功応答の本文 (`200 OK` など) のいずれかになります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-211">You need this information in the client because Office handles authentication for SSO add-ins. The message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="a1ec6-212">どちらの場合でも、アドインの Web API に対する、コードによるクライアント側の AJAX 呼び出しのコールバック (失敗または成功) が、この応答をテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-212">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> <span data-ttu-id="a1ec6-213">claims 値が中継されている場合、コードは `getAccessTokenAsync` を再呼び出しして [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) パラメーターのオプション `authChallenge: CLAIMS-STRING-HERE` を渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-213">If the claims value has been relayed, your code should recall `getAccessTokenAsync` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="a1ec6-214">AAD がこの文字列を認識すると、ユーザーに追加の要素を入力するよう促してから、代理フローで受け入れられる新しいアクセス トークンを返します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-214">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="a1ec6-215">同意なしエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-215">Consent missing errors</span></span>

<span data-ttu-id="a1ec6-216">AAD に、ユーザー (またはテナント管理者) がアドインに (Microsoft Graph リソースに対して) 同意した記録がない場合、AAD はエラー メッセージを Web サービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-216">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="a1ec6-217">コードは、`forceConsent: true` オプションで `getAccessTokenAsync` を再呼び出しするよう、(`403 Forbidden` 応答の本文などで) クライアントに指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-217">Your code must tell the client (in the body of a `403 Forbidden` response, for example) to recall `getAccessTokenAsync` with the `forceConsent: true` option.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="a1ec6-218">無効または不足した範囲 (アクセス許可) のエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-218">Invalid or missing scope (permission) errors</span></span>

- <span data-ttu-id="a1ec6-p127">サーバー側のコードでは、`403 Forbidden` 応答をクライアントに送って、ユーザーにわかりやすいメッセージを提示する必要があります。可能な場合は、そのエラーをコンソールに出力するか、ログに記録します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-p127">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user. If possible, log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="a1ec6-221">アドイン マニフェストの [Scopes](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/scopes) セクションで、必要なすべてのアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-221">Be sure your add-in manifest [Scopes](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/scopes)  section specifies all needed permissions.</span></span> <span data-ttu-id="a1ec6-222">また、アドインの Web サービスの登録で同じアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-222">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="a1ec6-223">スペルミスもチェックしてください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-223">Check for spelling mistakes too.</span></span> <span data-ttu-id="a1ec6-224">詳細については、「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint)」(ASP.NET) または「[Azure AD V2.0 エンドポイントにアドインを登録する](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint)」(Node JS)、および「[アドインを構成する](create-sso-office-add-ins-aspnet.md#configure-the-add-in)」(ASP.NET) または「[アドインを構成する](create-sso-office-add-ins-nodejs.md#configure-the-add-in)」(Node JS) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-224">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>

### <a name="expired-or-invalid-token-errors-when-calling-microsoft-graph"></a><span data-ttu-id="a1ec6-225">Microsoft Graph 呼び出し時の期限切れまたは無効なトークンのエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-225">Expired or invalid token errors when calling Microsoft Graph</span></span>

<span data-ttu-id="a1ec6-226">MSAL を含む一部の認証および承認ライブラリは、必要に応じてキャッシュされた更新トークンを使用することにより、期限切れトークンのエラーが発生しないようにします。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-226">Some authentication and authorization libraries, including MSAL, prevent expired token errors by using a cached refresh token whenever necessary.</span></span> <span data-ttu-id="a1ec6-227">独自のトークン キャッシュ システムをコーディングすることもできます。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-227">You can also code your own token caching system.</span></span> <span data-ttu-id="a1ec6-228">コーディングを行うサンプルについては、[Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)、特にファイル [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-228">For a sample that does this, see [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especially the file [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span></span>

<span data-ttu-id="a1ec6-229">しかし、期限切れトークンや無効なトークンのエラーが発生した場合、コードは `getAccessTokenAsync` を再呼び出しして、アドインの Web API のエンドポイントへの呼び出しを繰り返すよう、(`401 Unauthorized` 応答の本文などで) クライアントに指示しなければなりません。つまり、Microsoft Graph に対する新しいトークンを取得する代理フローを繰り返します。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-229">But if you get an expired token or invalid token error, your code must tell the client (in the body of a `401 Unauthorized` response, for example) to recall `getAccessTokenAsync` and repeat the call to the endpoint of your add-in's web API, which will repeat the on-behalf-of flow to obtain a new token for Microsoft Graph.</span></span>

### <a name="invalid-token-error-when-calling-microsoft-graph"></a><span data-ttu-id="a1ec6-230">Microsoft Graph 呼び出し時の無効なトークンのエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-230">Invalid token error when calling Microsoft Graph</span></span>

<span data-ttu-id="a1ec6-p130">このエラーは、期限切れトークンのエラーと同様に処理します。前のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-p130">Handle this error the same as an expired token error. See previous section.</span></span>

### <a name="invalid-audience-error"></a><span data-ttu-id="a1ec6-233">無効な対象ユーザーのエラー</span><span class="sxs-lookup"><span data-stu-id="a1ec6-233">Invalid audience error</span></span>

<span data-ttu-id="a1ec6-234">サーバー側のコードは、`403 Forbidden` 応答をクライアントに送って、ユーザーにわかりやすいメッセージを提示しなければなりません。場合によっては、エラーについて、コンソールでログを作成するか、ログに記録する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-234">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>

<span data-ttu-id="a1ec6-235">トークン検証のためのマルチテナント サポートの追加の詳細については、[Azure マルチテナント サンプル](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="a1ec6-235">For more on adding multitenant support for token validation, see the [Azure Multitenant Sample](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span></span>
