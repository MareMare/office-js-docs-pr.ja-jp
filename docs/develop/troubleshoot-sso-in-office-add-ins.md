---
title: シングル サインオン (SSO) のエラー メッセージのトラブルシューティング
description: Office アドインのシングルサインオン (SSO) に関する問題のトラブルシューティング方法と、特別な条件やエラーを処理する方法について説明します。
ms.date: 07/07/2020
localization_priority: Normal
ms.openlocfilehash: 0f4069ee2167a180bb4ba1fbd8db57d5d355e24b
ms.sourcegitcommit: 472b81642e9eb5fb2a55cd98a7b0826d37eb7f73
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/17/2020
ms.locfileid: "45159571"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="11dfc-103">シングル サインオン (SSO) のエラー メッセージのトラブルシューティング (プレビュー)</span><span class="sxs-lookup"><span data-stu-id="11dfc-103">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="11dfc-104">この記事では、Office アドインのシングル サインオン (SSO) に関する問題のトラブルシューティング方法と、SSO が有効なアドインによって特別な条件やエラーを確実に処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-104">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="11dfc-105">現在、シングル サインオン API は Word、Excel、Outlook、PowerPoint のプレビューでサポートされています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-105">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="11dfc-106">シングル サインオン API の現在のサポート状態に関する詳細は、「[IdentityAPI の要件セット](../reference/requirement-sets/identity-api-requirement-sets.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-106">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> [!INCLUDE [Information about using preview APIs](../includes/using-excel-preview-apis.md)]
> <span data-ttu-id="11dfc-107">Outlook アドインで作業している場合は、Microsoft 365 テナントの先進認証が有効になっていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-107">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy.</span></span> <span data-ttu-id="11dfc-108">この方法の詳細については、「[Exchange Online: テナントの先進認証を有効にする方法](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-108">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="11dfc-109">デバッグ ツール</span><span class="sxs-lookup"><span data-stu-id="11dfc-109">Debugging tools</span></span>

<span data-ttu-id="11dfc-p103">開発時は、アドインの Web サービスからの HTTP 要求および応答を傍受して表示することができるツールを使用することを強くお勧めします。最も一般的なものは、次の 2 つです。</span><span class="sxs-lookup"><span data-stu-id="11dfc-p103">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span>

- <span data-ttu-id="11dfc-112">[Fiddler](https://www.telerik.com/fiddler): 無料 ([ドキュメント](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="11dfc-112">[Fiddler](https://www.telerik.com/fiddler): Free ([Documentation](https://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="11dfc-113">[Charles](https://www.charlesproxy.com): 30 日間無料 </span><span class="sxs-lookup"><span data-stu-id="11dfc-113">[Charles](https://www.charlesproxy.com): Free for 30 days.</span></span> <span data-ttu-id="11dfc-114">([ドキュメント](https://www.charlesproxy.com/documentation/))。</span><span class="sxs-lookup"><span data-stu-id="11dfc-114">([Documentation](https://www.charlesproxy.com/documentation/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstoken"></a><span data-ttu-id="11dfc-115">getAccessToken からのエラーの原因と処理</span><span class="sxs-lookup"><span data-stu-id="11dfc-115">Causes and handling of errors from getAccessToken</span></span>

<span data-ttu-id="11dfc-116">このセクションで説明するエラー処理の例については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-116">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="11dfc-117">Office-Add-in-ASPNET-SSO の HomeES6.js</span><span class="sxs-lookup"><span data-stu-id="11dfc-117">HomeES6.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js)
- [<span data-ttu-id="11dfc-118">Office-Add-in-NodeJS-SSO の ssoAuthES6.js</span><span class="sxs-lookup"><span data-stu-id="11dfc-118">ssoAuthES6.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js)

### <a name="13000"></a><span data-ttu-id="11dfc-119">13000</span><span class="sxs-lookup"><span data-stu-id="11dfc-119">13000</span></span>

<span data-ttu-id="11dfc-120">[getAccessToken](../develop/sso-in-office-add-ins.md#sso-api-reference) API は、このアドインまたは Office バージョンではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-120">The [getAccessToken](../develop/sso-in-office-add-ins.md#sso-api-reference) API is not supported by the add-in or the Office version.</span></span>

- <span data-ttu-id="11dfc-121">この Office のバージョンは、SSO をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-121">The version of Office does not support SSO.</span></span> <span data-ttu-id="11dfc-122">必要なバージョンは、毎月のチャネルの Microsoft 365 サブスクリプションです。</span><span class="sxs-lookup"><span data-stu-id="11dfc-122">The required version is Microsoft 365 subscription, in any monthly channel.</span></span>
- <span data-ttu-id="11dfc-123">アドインのマニフェストに適切な [WebApplicationInfo](../reference/manifest/webapplicationinfo.md) セクションがありません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-123">The add-in manifest is missing the proper [WebApplicationInfo](../reference/manifest/webapplicationinfo.md) section.</span></span>

<span data-ttu-id="11dfc-124">アドインがこのエラーに対応するには、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-124">Your add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="11dfc-125">詳細については、「[要件とベスト プラクティス](../develop/sso-in-office-add-ins.md#requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-125">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

### <a name="13001"></a><span data-ttu-id="11dfc-126">13001</span><span class="sxs-lookup"><span data-stu-id="11dfc-126">13001</span></span>

<span data-ttu-id="11dfc-127">ユーザーは Office にサインインしていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-127">The user is not signed into Office.</span></span> <span data-ttu-id="11dfc-128">ほとんどのシナリオでは、`AuthOptions` パラメーターでオプション `allowSignInPrompt: true` を渡して、このエラーが表示されないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="11dfc-128">In most scenarios, you should prevent this error from ever being seen by passing the option `allowSignInPrompt: true` in the `AuthOptions` parameter.</span></span>

<span data-ttu-id="11dfc-129">ただし、例外がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-129">But there may be exceptions.</span></span> <span data-ttu-id="11dfc-130">たとえば、ユーザーが*すでに* Office にログインしている*場合にのみ*、ユーザーがログインしていることが必要な機能とともにアドインが開くようにするとします。</span><span class="sxs-lookup"><span data-stu-id="11dfc-130">For example, you want the add-in to open with features that require a logged in user; but *only if* the user is *already* logged into Office.</span></span> <span data-ttu-id="11dfc-131">ユーザーがログインしていない場合は、ユーザーがサインインしていることが必要のない別の機能のセットとともにアドインが開くようにするとします。</span><span class="sxs-lookup"><span data-stu-id="11dfc-131">If the user is not, you want the add-in to open with an alternate set of features that do not require that the user is signed in.</span></span> <span data-ttu-id="11dfc-132">この場合、アドインが起動する際に実行されるロジックでは、`allowSignInPrompt: true` を含めずに `getAccessToken` が呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-132">In this case, logic which runs when the add-in launches calls `getAccessToken` without `allowSignInPrompt: true`.</span></span> <span data-ttu-id="11dfc-133">別の機能のセットを表示するようにアドインに指示するためのフラグとして、13001エラーを使用します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-133">Use the 13001 error as the flag to tell the add-in to present the alternate set of features.</span></span>

<span data-ttu-id="11dfc-134">別の方法として、13001 に対応するために、ユーザー認証の代替システムにフォールバックすることもできます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-134">Another option is to respond to 13001 by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="11dfc-135">これにより、ユーザーを Office ではなく AAD にサインインさせられます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-135">This will sign the user into AAD, but not sign the user into Office.</span></span>

<span data-ttu-id="11dfc-136">このエラーは **Office on the web** では一度も確認されていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-136">This error is never seen in **Office on the web**.</span></span> <span data-ttu-id="11dfc-137">ユーザーの Cookie が失効すると、**Office on the web** はエラー 13006 を返します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-137">If the user's cookie expires, **Office on the web** returns error 13006.</span></span>

### <a name="13002"></a><span data-ttu-id="11dfc-138">13002</span><span class="sxs-lookup"><span data-stu-id="11dfc-138">13002</span></span>

<span data-ttu-id="11dfc-139">ユーザーが、同意ダイアログの **[キャンセル]** を選択するなどして、サインインまたは同意を中止しました。</span><span class="sxs-lookup"><span data-stu-id="11dfc-139">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span>

- <span data-ttu-id="11dfc-140">アドインがユーザーのサインイン (または同意) の必要がない機能を提供している場合、コードはこのエラーをキャッチし、アドインが継続して実行するようにしなければなりません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-140">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="11dfc-141">同意済みのサインインしているユーザーがアドインで必要な場合は、コードは [サインイン] ボタンを表示させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-141">If the add-in requires a signed-in user who has granted consent, your code should have a sign-in button appear.</span></span>

### <a name="13003"></a><span data-ttu-id="11dfc-142">13003</span><span class="sxs-lookup"><span data-stu-id="11dfc-142">13003</span></span>

<span data-ttu-id="11dfc-143">ユーザーの種類がサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-143">User Type not supported.</span></span> <span data-ttu-id="11dfc-144">ユーザーは、有効な Microsoft アカウントまたは Microsoft 365 の教育機関または職場のアカウントを使用して Office にサインインしていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-144">The user isn't signed into Office with a valid Microsoft account or Microsoft 365 Education or work account.</span></span> <span data-ttu-id="11dfc-145">このエラーは、Office がオンプレミス ドメイン アカウントで実行されている場合に発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-145">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="11dfc-146">コードでは、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-146">Your code should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="11dfc-147">詳細については、「[要件とベスト プラクティス](../develop/sso-in-office-add-ins.md#requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-147">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

### <a name="13004"></a><span data-ttu-id="11dfc-148">13004</span><span class="sxs-lookup"><span data-stu-id="11dfc-148">13004</span></span>

<span data-ttu-id="11dfc-149">無効なリソースです。</span><span class="sxs-lookup"><span data-stu-id="11dfc-149">Invalid Resource.</span></span> <span data-ttu-id="11dfc-150">(このエラーは開発環境でのみ表示されます)。アドインマニフェストが正しく構成されていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-150">(This error should only be seen in development.) The add-in manifest hasn't been configured correctly.</span></span> <span data-ttu-id="11dfc-151">マニフェストを更新してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-151">Update the manifest.</span></span> <span data-ttu-id="11dfc-152">詳細については、「[Office アドインのマニフェストを検証する](../testing/troubleshoot-manifest.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-152">For more information, see [Validate an Office Add-in's manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="11dfc-153">最も一般的な問題は、**Resource** 要素 (**WebApplicationInfo** 要素内) にアドインのドメインと一致しないドメインがあることです。</span><span class="sxs-lookup"><span data-stu-id="11dfc-153">The most common problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="11dfc-154">Resource 値のプロトコル部分は "https" ではなく "api" である必要があります。ドメイン名の他のすべての部分は (ポートがある場合はそれも含めて)、アドインと同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-154">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="11dfc-155">13005</span><span class="sxs-lookup"><span data-stu-id="11dfc-155">13005</span></span>

<span data-ttu-id="11dfc-156">無効な許可です。</span><span class="sxs-lookup"><span data-stu-id="11dfc-156">Invalid Grant.</span></span> <span data-ttu-id="11dfc-157">このエラーは、通常、Office がアドインの Web サービスに対して事前に承認されていないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-157">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="11dfc-158">詳細については、「[サービス アプリケーションを作成する](sso-in-office-add-ins.md#create-the-service-application)」および「[Azure AD v2.0 エンドポイントにアドインを登録する](register-sso-add-in-aad-v2.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-158">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span> <span data-ttu-id="11dfc-159">このエラーは、ユーザーが自分の `profile` に対するアクセス許可をサービス アプリケーションに与えていない場合、または同意を取り消した場合にも発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-159">This also may happen if the user has not granted your service application permissions to their `profile`, or has revoked consent.</span></span> <span data-ttu-id="11dfc-160">コードでは、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-160">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="11dfc-161">開発中の場合、別の原因として、アドインを使用する Internet Explorer およびユーザーが自己署名証明書を使用していることが考えられます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-161">Another possible cause, during development, is that your add-in using Internet Explorer, and you are using a self-signed certificate.</span></span> <span data-ttu-id="11dfc-162">(アドインによって使用されているブラウザーを特定するには、「[Office アドインによって使用されるブラウザー](../concepts/browsers-used-by-office-web-add-ins.md)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="11dfc-162">(To determine which browser is being used by the add-in, see [Browsers used by Office Add-ins](../concepts/browsers-used-by-office-web-add-ins.md).)</span></span>

### <a name="13006"></a><span data-ttu-id="11dfc-163">13006</span><span class="sxs-lookup"><span data-stu-id="11dfc-163">13006</span></span>

<span data-ttu-id="11dfc-164">クライアント エラーです。</span><span class="sxs-lookup"><span data-stu-id="11dfc-164">Client Error.</span></span> <span data-ttu-id="11dfc-165">このエラーは **Office on the web** でのみ確認されています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-165">This error is only seen in **Office on the web**.</span></span> <span data-ttu-id="11dfc-166">コードでは、サイン アウトし、次に Office のブラウザー セッションを再起動することをユーザーに促す必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-166">Your code should suggest that the user sign out and then restart the Office browser session.</span></span>

### <a name="13007"></a><span data-ttu-id="11dfc-167">13007</span><span class="sxs-lookup"><span data-stu-id="11dfc-167">13007</span></span>

<span data-ttu-id="11dfc-168">Office ホストは、アドインの Web サービスへのアクセス トークンを取得できませんでした。</span><span class="sxs-lookup"><span data-stu-id="11dfc-168">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="11dfc-169">開発中にこのエラーが発生する場合は、アドインの登録とアドイン マニフェストで `profile` のアクセス許可および (MSAL.NET を使用している場合は) `openid` のアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-169">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `profile` permission (and the `openid` permission, if you are using MSAL.NET).</span></span> <span data-ttu-id="11dfc-170">詳細については、「[Azure AD v2.0 エンドポイントにアドインを登録する](register-sso-add-in-aad-v2.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-170">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>
- <span data-ttu-id="11dfc-171">運用環境では、このエラーの原因として考えられることがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-171">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="11dfc-172">その一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-172">Some of them are:</span></span>
    - <span data-ttu-id="11dfc-173">ユーザーが Microsoft アカウント id を持っている。</span><span class="sxs-lookup"><span data-stu-id="11dfc-173">The user has a Microsoft account identity.</span></span>
    - <span data-ttu-id="11dfc-174">Microsoft 365 の教育機関または職場のアカウントで、他の13xxx エラーのうちの1つが MSA を使用した場合、13007が発生する状況もあります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-174">Some situations that would cause one of the other 13xxx errors with a Microsoft 365 Education or work account will cause a 13007 when a MSA is used.</span></span>

  <span data-ttu-id="11dfc-175">これらのすべてのケースでは、コードでは、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-175">For all of these cases, your code should fall back to an alternate system of user authentication.</span></span>

### <a name="13008"></a><span data-ttu-id="11dfc-176">13008</span><span class="sxs-lookup"><span data-stu-id="11dfc-176">13008</span></span>

<span data-ttu-id="11dfc-177">ユーザーは、前回の `getAccessToken` の呼び出しが完了する前に `getAccessToken` を呼び出す操作をトリガーしました。</span><span class="sxs-lookup"><span data-stu-id="11dfc-177">The user triggered an operation that calls `getAccessToken` before a previous call of `getAccessToken` completed.</span></span> <span data-ttu-id="11dfc-178">このエラーは **Office on the web** でのみ確認されています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-178">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="11dfc-179">コードでは、ユーザーに前の操作が完了した後に操作を繰り返すよう要求する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-179">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13010"></a><span data-ttu-id="11dfc-180">13010</span><span class="sxs-lookup"><span data-stu-id="11dfc-180">13010</span></span>

<span data-ttu-id="11dfc-181">ユーザーが Microsoft Edge または Internet Explorer で Office のアドインを実行しています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-181">The user is running the add-in in Office on Microsoft Edge or Internet Explorer.</span></span> <span data-ttu-id="11dfc-182">ユーザーの Microsoft 365 ドメインおよびドメインは、 `login.microsoftonline.com` ブラウザー設定で異なるセキュリティゾーンに含まれています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-182">The user's Microsoft 365 domain, and the `login.microsoftonline.com` domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="11dfc-183">このエラーは **Office on the web** でのみ確認されています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-183">This error is only seen on **Office on the web**.</span></span> <span data-ttu-id="11dfc-184">このエラーが返された場合、ユーザーには、これについて説明するエラーとゾーンの構成を変更する方法に関するページへのリンクが表示されています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-184">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="11dfc-185">アドインがユーザーのサインインを必要としない機能を提供している場合、コードでは、このエラーをキャッチして、アドインの実行を続行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-185">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="11dfc-186">13012</span><span class="sxs-lookup"><span data-stu-id="11dfc-186">13012</span></span>

<span data-ttu-id="11dfc-187">いくつかの原因が考えられます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-187">There are several possible causes:</span></span>

- <span data-ttu-id="11dfc-188">アドインは、`getAccessToken` API をサポートしていないプラットフォーム上で実行されています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-188">The add-in is running on a platform that does not support the `getAccessToken` API.</span></span> <span data-ttu-id="11dfc-189">たとえば、iPad 上ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-189">For example, it is not supported on iPad.</span></span> <span data-ttu-id="11dfc-190">「[Identity API の要件セット](../reference/requirement-sets/identity-api-requirement-sets.md)」も参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-190">See also [Identity API Requirement Sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
- <span data-ttu-id="11dfc-191">`getAccessToken` への呼び出しで `forMSGraphAccess` オプションが渡され、ユーザーが AppSource からアドインを取得しました。</span><span class="sxs-lookup"><span data-stu-id="11dfc-191">The `forMSGraphAccess` option was passed in the call to `getAccessToken` and the user obtained the add-in from AppSource.</span></span> <span data-ttu-id="11dfc-192">このシナリオでは、アドインが必要とする Microsoft Graph スコープ (権限) について、テナント管理者はアドインに同意していません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-192">In this scenario, the tenant admin has not granted consent to the add-in for the Microsoft Graph scopes (permissions) that it needs.</span></span> <span data-ttu-id="11dfc-193">Office では、ユーザーに求めることができるのは AAD `profile` スコープへの同意のみであるため、`allowConsentPrompt` を使用して `getAccessToken` を取り消しても問題は解決できません。</span><span class="sxs-lookup"><span data-stu-id="11dfc-193">Recalling `getAccessToken` with the `allowConsentPrompt` will not solve the problem because Office is allowed to prompt the user for consent to only the AAD `profile` scope.</span></span>

<span data-ttu-id="11dfc-194">コードでは、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-194">Your code should fall back to an alternate system of user authentication.</span></span>

<span data-ttu-id="11dfc-195">開発中は、アドインは Outlook でサイドロードされ、`getAccessToken` への呼び出しで `forMSGraphAccess` オプションが渡されます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-195">In development, the add-in is sideloaded in Outlook and the `forMSGraphAccess` option was passed in the call to `getAccessToken`.</span></span>

### <a name="13013"></a><span data-ttu-id="11dfc-196">13013</span><span class="sxs-lookup"><span data-stu-id="11dfc-196">13013</span></span>

<span data-ttu-id="11dfc-197">は `getAccessToken` 短時間で何度も呼び出されていたため、Office は最新の通話を調整しました。</span><span class="sxs-lookup"><span data-stu-id="11dfc-197">The `getAccessToken` was called too many times in a short amount of time, so Office throttled the most recent call.</span></span> <span data-ttu-id="11dfc-198">これは通常、このメソッドへの呼び出しの無限ループが原因で発生します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-198">This is usually caused by an infinite loop of calls to the method.</span></span> <span data-ttu-id="11dfc-199">メソッドを取り消すことが推奨されるシナリオがあります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-199">There are scenarios when recalling the method is advisable.</span></span> <span data-ttu-id="11dfc-200">ただし、コードでカウンターまたはフラグ変数を使用して、メソッドが繰り返し呼び戻されないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-200">However, your code should use a counter or flag variable to ensure that the method is not recalled repeatedly.</span></span> <span data-ttu-id="11dfc-201">同じ "再試行" コードパスが再度実行されている場合は、コードは、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-201">If the same "retry" code path is running again, the code should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="11dfc-202">コード例については、 `retryGetAccessToken` [HomeES6.js](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js)または[ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js)で変数がどのように使用されているかを参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-202">For a code example, see how the `retryGetAccessToken` variable is used in [HomeES6.js](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/HomeES6.js) or [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Complete/public/javascripts/ssoAuthES6.js).</span></span>

### <a name="50001"></a><span data-ttu-id="11dfc-203">50001</span><span class="sxs-lookup"><span data-stu-id="11dfc-203">50001</span></span>

<span data-ttu-id="11dfc-204">このエラー (`getAccessToken` に固有ではありません) は、ブラウザーが office.js ファイルの古いコピーをキャッシュしていることを示す可能性があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-204">This error (which is not specific to `getAccessToken`) may indicate that the browser has cached an old copy of the office.js files.</span></span> <span data-ttu-id="11dfc-205">開発中の場合は、ブラウザーのキャッシュをクリアしてください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-205">When you are developing, clear the browser's cache.</span></span> <span data-ttu-id="11dfc-206">また、Office のバージョンが古いため、SSO をサポートしていない可能性も考えられます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-206">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="11dfc-207">Windows での最小バージョンは、16.0.12215.20006 です。</span><span class="sxs-lookup"><span data-stu-id="11dfc-207">On Windows, the minimum version is 16.0.12215.20006.</span></span> <span data-ttu-id="11dfc-208">Mac では、16.32.19102902 です。</span><span class="sxs-lookup"><span data-stu-id="11dfc-208">On Mac, it is 16.32.19102902.</span></span>

<span data-ttu-id="11dfc-209">運用環境のアドインの場合、アドインがこのエラーに対応するには、ユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-209">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="11dfc-210">詳細については、「[要件とベスト プラクティス](../develop/sso-in-office-add-ins.md#requirements-and-best-practices)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-210">For more information, see [Requirements and Best Practices](../develop/sso-in-office-add-ins.md#requirements-and-best-practices).</span></span>

## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="11dfc-211">Azure Active Directory からのサーバー側のエラー</span><span class="sxs-lookup"><span data-stu-id="11dfc-211">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="11dfc-212">このセクションで説明するエラー処理の例については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-212">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="11dfc-213">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="11dfc-213">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="11dfc-214">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="11dfc-214">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)

### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="11dfc-215">条件付きアクセスおよび多要素認証のエラー</span><span class="sxs-lookup"><span data-stu-id="11dfc-215">Conditional access / Multifactor authentication errors</span></span>

<span data-ttu-id="11dfc-216">AAD および Microsoft 365 の id の特定の構成では、ユーザーの Microsoft 365 テナントがない場合でも、多要素認証 (MFA) を必要とするように Microsoft Graph でアクセスできる一部のリソースがあります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-216">In certain configurations of identity in AAD and Microsoft 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Microsoft 365 tenancy does not.</span></span> <span data-ttu-id="11dfc-217">AAD は、MFA で保護されたリソースへのトークンの要求を、代理フロー経由で受け取ると、アドインの Web サービスに `claims` プロパティを含む JSON メッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-217">When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property.</span></span> <span data-ttu-id="11dfc-218">claims プロパティには、さらに必要となる認証要素の情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="11dfc-218">The claims property has information about what further authentication factors are needed.</span></span>

<span data-ttu-id="11dfc-219">コードは、この `claims` プロパティについてテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-219">Your code should test for this `claims` property.</span></span> <span data-ttu-id="11dfc-220">アドインのアーキテクチャによっては、クライアント側でテストすることができます。または、サーバー側でテストし、クライアントにリレーすることができます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-220">Depending on your add-in's architecture, you may test for it on the client-side, or you may test for it on the server-side and relay it to the client.</span></span> <span data-ttu-id="11dfc-221">SSO アドインの認証は Office によって処理されるため、この情報がクライアントで必要になります。この情報をサーバー側からリレーする場合、クライアントへのメッセージは、エラー (`500 Server Error` や `401 Unauthorized` など) または成功応答の本文 (`200 OK` など) のいずれかになります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-221">You need this information in the client because Office handles authentication for SSO add-ins. If you relay it from the server-side, the message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="11dfc-222">どちらの場合でも、アドインの Web API に対する、コードによるクライアント側の AJAX 呼び出しのコールバック (失敗または成功) が、この応答をテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-222">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> 

<span data-ttu-id="11dfc-223">アーキテクチャに関係なく、クレームの値が AAD から送信されている場合は、コードを呼び出して `getAccessToken` パラメーターにオプションを渡す必要があり `authChallenge: CLAIMS-STRING-HERE` `options` ます。</span><span class="sxs-lookup"><span data-stu-id="11dfc-223">Regardless of your architecture, if the claims value has been sent from AAD, your code should recall `getAccessToken` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the `options` parameter.</span></span> <span data-ttu-id="11dfc-224">AAD がこの文字列を認識すると、ユーザーに追加の要素を入力するよう促してから、代理フローで受け入れられる新しいアクセス トークンを返します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-224">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="11dfc-225">同意なしエラー</span><span class="sxs-lookup"><span data-stu-id="11dfc-225">Consent missing errors</span></span>

<span data-ttu-id="11dfc-226">AAD に、ユーザー (またはテナント管理者) がアドインに (Microsoft Graph リソースに対して) 同意した記録がない場合、AAD はエラー メッセージを Web サービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="11dfc-226">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="11dfc-227">コードは、 (`403 Forbidden` 応答の本文などで) クライアントに指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-227">Your code must tell the client (in the body of a `403 Forbidden` response, for example).</span></span>

<span data-ttu-id="11dfc-228">管理者のみが同意できる Microsoft Graph のスコープがアドインで必要な場合は、コードはエラーをスローする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-228">If the add-in needs Microsoft Graph scopes that can only be consented to by an admin, your code should throw an error.</span></span> <span data-ttu-id="11dfc-229">唯一必要なスコープに対して同意できるのがユーザーである場合は、コードはユーザー認証の代替システムにフォールバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-229">If the only scopes that are needed can be consented to by the user, then your code should fall back to an alternate system of user authentication.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="11dfc-230">無効または見つからないスコープ (アクセス許可) のエラー</span><span class="sxs-lookup"><span data-stu-id="11dfc-230">Invalid or missing scope (permission) errors</span></span>

<span data-ttu-id="11dfc-231">この種類のエラーが表示されるのは、開発中のみである必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-231">This kind of error should only be seen in development.</span></span>

- <span data-ttu-id="11dfc-232">サーバー側のコードでは、`403 Forbidden` 応答をクライアントに送り、そのエラーのログをコンソールで作成するか、ログに記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-232">Your server-side code should send a `403 Forbidden` response to the client which should log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="11dfc-233">アドイン マニフェストの[範囲](../reference/manifest/scopes.md)セクションで、必要なすべてのアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-233">Be sure your add-in manifest [Scopes](../reference/manifest/scopes.md) section specifies all needed permissions.</span></span> <span data-ttu-id="11dfc-234">また、アドインの Web サービスの登録で同じアクセス許可が指定されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-234">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="11dfc-235">スペルミスもチェックしてください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-235">Check for spelling mistakes too.</span></span> <span data-ttu-id="11dfc-236">詳細については、「[Azure AD v2.0 エンドポイントにアドインを登録する](register-sso-add-in-aad-v2.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="11dfc-236">For more information, see [Register the add-in with Azure AD v2.0 endpoint](register-sso-add-in-aad-v2.md).</span></span>

### <a name="invalid-audience-error-in-the-access-token-not-the-bootstrap-token"></a><span data-ttu-id="11dfc-237">(ブートストラップ トークンではなく) アクセス トークンでの無効な対象ユーザーのエラー</span><span class="sxs-lookup"><span data-stu-id="11dfc-237">Invalid audience error in the access token (not the bootstrap token)</span></span>

<span data-ttu-id="11dfc-238">サーバー側のコードは、`403 Forbidden` 応答をクライアントに送って、ユーザーにわかりやすいメッセージを提示しなければなりません。場合によっては、エラーについて、コンソールでログを作成するか、ログに記録する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="11dfc-238">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>
