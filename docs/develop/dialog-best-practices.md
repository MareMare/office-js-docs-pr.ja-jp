---
title: Office ダイアログ API のベスト プラクティスとルール
description: 単一ページアプリケーション (SPA) のベストプラクティスなど、Office ダイアログ API のルールとベストプラクティスを提供します。
ms.date: 09/24/2020
localization_priority: Normal
ms.openlocfilehash: 5c80b18f7eb6448de23c692683b7c991b9d95ef5
ms.sourcegitcommit: b47318a24a50443b0579e05e178b3bb5433c372f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/25/2020
ms.locfileid: "48279501"
---
# <a name="best-practices-and-rules-for-the-office-dialog-api"></a><span data-ttu-id="9dad6-103">Office ダイアログ API のベスト プラクティスとルール</span><span class="sxs-lookup"><span data-stu-id="9dad6-103">Best practices and rules for the Office dialog API</span></span>

<span data-ttu-id="9dad6-104">この記事では、Office ダイアログ API のルール、ガイドライン、およびベストプラクティスについて説明します。これには、ダイアログの UI を設計し、単一ページアプリケーション (SPA) で API を使用するためのベストプラクティスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9dad6-104">This article provides rules, gotchas, and best practices for the Office dialog API, including best practices for designing the UI of a dialog and using the API with in a single-page application (SPA)</span></span>

> [!NOTE]
> <span data-ttu-id="9dad6-105">この記事では、「office [アドインで office ダイアログ api を使用](dialog-api-in-office-add-ins.md)する」で説明されている OFFICE ダイアログ api の使用についての基本事項を presupposes しています。</span><span class="sxs-lookup"><span data-stu-id="9dad6-105">This article presupposes that you are familiar with the basics of using the Office dialog API as described in [Use the Office dialog API in your Office Add-ins](dialog-api-in-office-add-ins.md).</span></span>
> 
> <span data-ttu-id="9dad6-106">「 [Office ダイアログボックスでエラーとイベントを処理する](dialog-handle-errors-events.md)」も参照してください。</span><span class="sxs-lookup"><span data-stu-id="9dad6-106">See also [Handling errors and events with the Office dialog box](dialog-handle-errors-events.md).</span></span>

## <a name="rules-and-gotchas"></a><span data-ttu-id="9dad6-107">ルールと注意事項</span><span class="sxs-lookup"><span data-stu-id="9dad6-107">Rules and gotchas</span></span>

- <span data-ttu-id="9dad6-108">このダイアログボックスは、HTTP ではなく HTTPS の Url にのみ移動できます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-108">The dialog box can only navigate to HTTPS URLs, not HTTP.</span></span>
- <span data-ttu-id="9dad6-109">[Displaydialogasync](/javascript/api/office/office.ui)メソッドに渡される URL は、アドイン自体とまったく同じドメイン内にある必要があります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-109">The URL passed to the [displayDialogAsync](/javascript/api/office/office.ui) method must be in the exact same domain as the add-in itself.</span></span> <span data-ttu-id="9dad6-110">サブドメインにすることはできません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-110">It cannot be a subdomain.</span></span> <span data-ttu-id="9dad6-111">ただし、それに渡されるページは、別のドメイン内のページにリダイレクトすることができます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-111">But the page that is passed to it can redirect to a page in another domain.</span></span>
- <span data-ttu-id="9dad6-112">ホストウィンドウは、作業ウィンドウまたはアドインコマンドの UI に含まれない [関数ファイル](../reference/manifest/functionfile.md) の場合がありますが、一度に開くことのできるダイアログボックスは1つだけです。</span><span class="sxs-lookup"><span data-stu-id="9dad6-112">A host window, which can be a task pane or the UI-less [function file](../reference/manifest/functionfile.md) of an add-in command, can have only one dialog box open at a time.</span></span>
- <span data-ttu-id="9dad6-113">ダイアログボックスでは、次の2つの Office Api のみを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-113">Only two Office APIs can be called in the dialog box:</span></span>
  - <span data-ttu-id="9dad6-114">[Messageparent](/javascript/api/office/office.ui#messageparent-message-)関数。</span><span class="sxs-lookup"><span data-stu-id="9dad6-114">The [messageParent](/javascript/api/office/office.ui#messageparent-message-) function.</span></span>
  - <span data-ttu-id="9dad6-115">`Office.context.requirements.isSetSupported` (詳細については、「 [Office アプリケーションと API の要件を指定する](specify-office-hosts-and-api-requirements.md)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="9dad6-115">`Office.context.requirements.isSetSupported` (For more information, see [Specify Office applications and API requirements](specify-office-hosts-and-api-requirements.md).)</span></span>
- <span data-ttu-id="9dad6-116">[Messageparent](/javascript/api/office/office.ui#messageparent-message-)関数は、アドイン自体とまったく同じドメイン内のページからのみ呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-116">The [messageParent](/javascript/api/office/office.ui#messageparent-message-) function can only be called from a page in the exact same domain as the add-in itself.</span></span>

## <a name="best-practices"></a><span data-ttu-id="9dad6-117">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="9dad6-117">Best practices</span></span>

### <a name="avoid-overusing-dialog-boxes"></a><span data-ttu-id="9dad6-118">過剰な使用ダイアログボックスを回避する</span><span class="sxs-lookup"><span data-stu-id="9dad6-118">Avoid overusing dialog boxes</span></span>

<span data-ttu-id="9dad6-119">UI 要素を重ねて表示することはお勧めできないため、シナリオで必要な場合を除き、作業ウィンドウでダイアログ ボックスを開かないようにします。</span><span class="sxs-lookup"><span data-stu-id="9dad6-119">Because overlapping UI elements are discouraged, avoid opening a dialog box from a task pane unless your scenario requires it.</span></span> <span data-ttu-id="9dad6-120">作業ウィンドウの表示領域の使用方法を検討するときには、作業ウィンドウはタブ表示できることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9dad6-120">When you consider how to use the surface area of a task pane, note that task panes can be tabbed.</span></span> <span data-ttu-id="9dad6-121">例については、[Excel アドイン JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) のサンプルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9dad6-121">For an example, see the [Excel Add-in JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) sample.</span></span>

### <a name="designing-a-dialog-box-ui"></a><span data-ttu-id="9dad6-122">ダイアログボックスの UI を設計する</span><span class="sxs-lookup"><span data-stu-id="9dad6-122">Designing a dialog box UI</span></span>

<span data-ttu-id="9dad6-123">ダイアログボックスデザインのベストプラクティスについては、「 [Office アドインのダイアログボックス](../design/dialog-boxes.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9dad6-123">For best practices in dialog box design, see [Dialog boxes in Office Add-ins](../design/dialog-boxes.md).</span></span>

### <a name="handling-pop-up-blockers-with-office-on-the-web"></a><span data-ttu-id="9dad6-124">Office on the web を使用したポップアップ ブロックの処理</span><span class="sxs-lookup"><span data-stu-id="9dad6-124">Handling pop-up blockers with Office on the web</span></span>

<span data-ttu-id="9dad6-125">Web 上で Office を使用しているときにダイアログボックスを表示しようとすると、ブラウザーのポップアップブロックによってダイアログボックスがブロックされることがあります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-125">Attempting to display a dialog box while using Office on the web may cause the browser's pop-up blocker to block the dialog box.</span></span> <span data-ttu-id="9dad6-126">Web 上の Office には、ブラウザーのポップアップブロックに対してアドインのダイアログボックスを例外として使用できる機能があります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-126">Office on the web has a feature that enables your add-in's dialog boxes to be an exception to the browser's pop-up blocker.</span></span> <span data-ttu-id="9dad6-127">コードによってメソッドが呼び出されると `displayDialogAsync` 、web 上の Office は次のようなプロンプトを開きます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-127">When your code calls the `displayDialogAsync` method, then Office on the web will open a prompt similar to the following.</span></span>

![ブラウザーでポップアップブロックを発生させないようにするために、アドインが生成できるプロンプト。](../images/dialog-prompt-before-open.png)

<span data-ttu-id="9dad6-129">ユーザーが [ **許可**] を選択すると、[Office] ダイアログボックスが開きます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-129">If the user chooses **Allow**, the Office dialog box opens.</span></span> <span data-ttu-id="9dad6-130">ユーザーが [ **無視**] を選択すると、プロンプトは閉じられ、[Office] ダイアログボックスは開きません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-130">If the user chooses **Ignore**, the prompt closes and the Office dialog box does not open.</span></span> <span data-ttu-id="9dad6-131">代わりに、この `displayDialogAsync` メソッドはエラー12009を返します。</span><span class="sxs-lookup"><span data-stu-id="9dad6-131">Instead, the `displayDialogAsync` method returns error 12009.</span></span> <span data-ttu-id="9dad6-132">コードでは、このエラーをキャッチして、ダイアログを必要としない別の方法を提供するか、アドインでダイアログを許可する必要があることをユーザーに通知するメッセージを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-132">Your code should catch this error and either provide an alternate experience that does not require a dialog, or display a message to the user advising that the add-in requires them to allow the dialog.</span></span> <span data-ttu-id="9dad6-133">(12009 の詳細については、「 [displayDialogAsync からのエラー](dialog-handle-errors-events.md#errors-from-displaydialogasync)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="9dad6-133">(For more about 12009, see [Errors from displayDialogAsync](dialog-handle-errors-events.md#errors-from-displaydialogasync).)</span></span>

<span data-ttu-id="9dad6-134">何らかの理由でこの機能をオフにする場合は、コードでオプトアウトする必要があります。この要求は、メソッドに渡される "引数の [選択](/javascript/api/office/office.dialogoptions) " オブジェクトを使用して行われ `displayDialogAsync` ます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-134">If, for any reason, you want to turn off this feature, then your code must opt out. It makes this request with the [DialogOptions](/javascript/api/office/office.dialogoptions) object that is passed to the `displayDialogAsync` method.</span></span> <span data-ttu-id="9dad6-135">具体的には、オブジェクトにを含める必要があり `promptBeforeOpen: false` ます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-135">Specifically, the object should include `promptBeforeOpen: false`.</span></span> <span data-ttu-id="9dad6-136">このオプションが false に設定されている場合、web 上の Office では、アドインでダイアログを開くことを許可するかどうかを確認するメッセージは表示されず、[Office] ダイアログボックスは開きません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-136">When this option is set to false, Office on the web will not prompt the user to allow the add-in open a dialog, and the Office dialog will not open.</span></span>

### <a name="do-not-use-the-_host_info-value"></a><span data-ttu-id="9dad6-137">[ \_ ホスト情報] の値を使用しないでください。 \_</span><span class="sxs-lookup"><span data-stu-id="9dad6-137">Do not use the \_host\_info value</span></span>

<span data-ttu-id="9dad6-138">Office は、`_host_info` に渡される URL に `displayDialogAsync` というクエリ パラメーターを自動的に追加します (カスタム クエリ パラメーターが存在する場合は、その後に追加されます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-138">Office automatically adds a query parameter called `_host_info` to the URL that is passed to `displayDialogAsync`.</span></span> <span data-ttu-id="9dad6-139">これはカスタムクエリパラメーターの後に追加されます (存在する場合)。</span><span class="sxs-lookup"><span data-stu-id="9dad6-139">It is appended after your custom query parameters, if any.</span></span> <span data-ttu-id="9dad6-140">これは、ダイアログボックスが移動する以降の Url には追加されません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-140">It is not appended to any subsequent URLs that the dialog box navigates to.</span></span> <span data-ttu-id="9dad6-141">Microsoft では、この値の内容を変更したり、完全に削除したりすることがあります。この場合、コードでこの値を読み取ることはできません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-141">Microsoft may change the content of this value, or remove it entirely, so your code should not read it.</span></span> <span data-ttu-id="9dad6-142">同じ値がダイアログボックスのセッションストレージ (つまり、 [ウィンドウの sessionstorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) プロパティ) に追加されます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-142">The same value is added to the dialog box's session storage (that is, the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property).</span></span> <span data-ttu-id="9dad6-143">この場合も、*コードではこの値に対する読み取りも書き込みも行わないでください*。</span><span class="sxs-lookup"><span data-stu-id="9dad6-143">Again, *your code should neither read nor write to this value*.</span></span>

### <a name="best-practices-for-using-the-office-dialog-api-in-an-spa"></a><span data-ttu-id="9dad6-144">SPA で Office ダイアログ API を使用するためのベストプラクティス</span><span class="sxs-lookup"><span data-stu-id="9dad6-144">Best practices for using the Office dialog API in an SPA</span></span>

<span data-ttu-id="9dad6-145">アドインでクライアント側のルーティングを使用する場合は、通常、単一ページのアプリケーション (SPAs) として、別の HTML ページの URL の代わりに、ルートの URL を [Displaydialogasync](/javascript/api/office/office.ui) メソッドに渡すオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-145">If your add-in uses client-side routing, as single-page applications (SPAs) typically do, you have the option to pass the URL of a route to the [displayDialogAsync](/javascript/api/office/office.ui) method instead of the URL of a separate HTML page.</span></span> <span data-ttu-id="9dad6-146">*以下の理由から、そのようにすることをお勧めします。*</span><span class="sxs-lookup"><span data-stu-id="9dad6-146">*We recommend against doing so for the reasons given below.*</span></span>

> [!NOTE]
> <span data-ttu-id="9dad6-147">この記事は、エクスプレスベースの web アプリケーションなど、 *サーバー側* のルーティングには関連していません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-147">This article is not relevant to *server-side* routing, such as in an Express-based web application.</span></span>

#### <a name="problems-with-spas-and-the-office-dialog-api"></a><span data-ttu-id="9dad6-148">SPAs と Office ダイアログ API の問題</span><span class="sxs-lookup"><span data-stu-id="9dad6-148">Problems with SPAs and the Office dialog API</span></span>

<span data-ttu-id="9dad6-149">[Office] ダイアログボックスは、JavaScript エンジンの独自のインスタンスを備えた新しいウィンドウに表示されるので、完全な実行コンテキストです。</span><span class="sxs-lookup"><span data-stu-id="9dad6-149">The Office dialog box is in a new window with its own instance of the JavaScript engine, and hence it's own complete execution context.</span></span> <span data-ttu-id="9dad6-150">ルートを渡すと、基本ページとすべての初期化コードとブートストラップコードがこの新しいコンテキストで再び実行され、すべての変数がダイアログボックスの初期値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-150">If you pass a route, your base page and all its initialization and bootstrapping code run again in this new context, and any variables are set to their initial values in the dialog box.</span></span> <span data-ttu-id="9dad6-151">そのため、この手法では、アプリケーションの2番目のインスタンスをボックスウィンドウにダウンロードして起動します。これにより、SPA の目的が部分的には損なわれます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-151">So this technique downloads and launches a second instance of your application in the  box window, which partially defeats the purpose of an SPA.</span></span> <span data-ttu-id="9dad6-152">また、ダイアログボックスウィンドウで変数を変更するコードでは、同じ変数の作業ウィンドウバージョンは変更されません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-152">In addition, code that changes variables in the dialog box window does not change the task pane version of the same variables.</span></span> <span data-ttu-id="9dad6-153">同様に、ダイアログボックスウィンドウには独自のセッションストレージ ( [sessionstorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) プロパティ) があります。これには、作業ウィンドウのコードからアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-153">Similarly, the dialog box window has its own session storage (the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property), which is not accessible from code in the task pane.</span></span> <span data-ttu-id="9dad6-154">ダイアログボックスと呼び出し先のホストページが、 `displayDialogAsync` サーバーに対して2つの異なるクライアントのように表示されています。</span><span class="sxs-lookup"><span data-stu-id="9dad6-154">The dialog box and the host page on which `displayDialogAsync` was called look like two different clients to your server.</span></span> <span data-ttu-id="9dad6-155">(ホストページについての通知については、「 [ホストページからダイアログボックスを開く](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="9dad6-155">(For a reminder of what a host page is, see [Open a dialog box from a host page](dialog-api-in-office-add-ins.md#open-a-dialog-box-from-a-host-page).)</span></span>

<span data-ttu-id="9dad6-156">そのため、メソッドにルートを渡すと、実際には `displayDialogAsync` spa を持っていません。 *同じ spa のインスタンスが2つ*あります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-156">So, if you passed a route to the `displayDialogAsync` method, you wouldn't really have an SPA; you'd have *two instances of the same SPA*.</span></span> <span data-ttu-id="9dad6-157">さらに、作業ウィンドウインスタンス内のコードの多くは、そのインスタンスでは使用されず、ダイアログボックスインスタンス内のコードの多くは、そのインスタンスでは使用されません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-157">Moreover, much of the code in the task pane instance would never be used in that instance and much of the code in the dialog box instance would never be used in that instance.</span></span> <span data-ttu-id="9dad6-158">同じバンドルに 2 つの SPA があるようなものです。</span><span class="sxs-lookup"><span data-stu-id="9dad6-158">It would be like having two SPAs in the same bundle.</span></span>

#### <a name="microsoft-recommendations"></a><span data-ttu-id="9dad6-159">Microsoft の推奨事項</span><span class="sxs-lookup"><span data-stu-id="9dad6-159">Microsoft recommendations</span></span>

<span data-ttu-id="9dad6-160">メソッドにクライアント側のルートを渡す代わりに `displayDialogAsync` 、次のいずれかの手順を実行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9dad6-160">Instead of passing a client-side route to the `displayDialogAsync` method, we recommend that you do one of the following:</span></span>

* <span data-ttu-id="9dad6-161">ダイアログボックスで実行するコードが非常に複雑な場合は、2つの異なる SPAs 明示的に作成します。つまり、同じドメインの異なるフォルダーに2つの SPAs 持たせることができます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-161">If the code that you want to run in the dialog box is sufficiently complex, create two different SPAs explicitly; that is, have two SPAs in different folders of the same domain.</span></span> <span data-ttu-id="9dad6-162">ダイアログボックス内で1つの SPA が実行され、もう1つは、が呼び出されたダイアログボックスのホストページに `displayDialogAsync` あります。</span><span class="sxs-lookup"><span data-stu-id="9dad6-162">One SPA runs in the dialog box and the other in the dialog box's host page where `displayDialogAsync` was called.</span></span> 
* <span data-ttu-id="9dad6-163">ほとんどのシナリオでは、ダイアログボックスには単純なロジックのみが必要です。</span><span class="sxs-lookup"><span data-stu-id="9dad6-163">In most scenarios, only simple logic is needed in the dialog box.</span></span> <span data-ttu-id="9dad6-164">このような場合、1つの HTML ページ (埋め込まれた、または参照された JavaScript を含む) を SPA のドメインにホストすることによって、プロジェクトが大幅に簡素化されます。</span><span class="sxs-lookup"><span data-stu-id="9dad6-164">In such cases, your project will be greatly simplified by hosting a single HTML page, with embedded or referenced JavaScript, in the domain of your SPA.</span></span> <span data-ttu-id="9dad6-165">ページの URL を `displayDialogAsync` メソッドに渡します。</span><span class="sxs-lookup"><span data-stu-id="9dad6-165">Pass the URL of the page to the `displayDialogAsync` method.</span></span> <span data-ttu-id="9dad6-166">これは、単一ページアプリのリテラルの概念から deviating していることを意味します。Office ダイアログ API を使用している場合、実際には SPA の1つのインスタンスを持っていません。</span><span class="sxs-lookup"><span data-stu-id="9dad6-166">While this means that you are deviating from the literal idea of a single-page app; you don't really have a single instance of an SPA when you are using the Office dialog API.</span></span>
