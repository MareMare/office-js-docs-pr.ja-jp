---
title: Office ダイアログ API を使用して認証および承認する
description: ''
ms.date: 01/25/2020
localization_priority: Priority
ms.openlocfilehash: 7311eb4f86c52afe01b18e8ea61133b2e8267a24
ms.sourcegitcommit: 4c9e02dac6f8030efc7415e699370753ec9415c8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/01/2020
ms.locfileid: "41649985"
---
# <a name="authenticate-and-authorize-with-the-office-dialog-api"></a><span data-ttu-id="21fe0-102">Office ダイアログ API を使用して認証および承認する</span><span class="sxs-lookup"><span data-stu-id="21fe0-102">Authenticate and authorize with the Office dialog API</span></span>

<span data-ttu-id="21fe0-103">Secure Token Services (STS) とも呼ばれる多くの ID 機関では、ログイン ページが iframe で開かれないようになっています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-103">Many identity authorities, also called Secure Token Services (STS), prevent their login page from opening in an iframe.</span></span> <span data-ttu-id="21fe0-104">これらには、Google、Facebook、および Microsoft アカウントや Office 365 (職場または学校のアカウント) などの Microsoft ID プラットフォーム (以前の Azure AD V 2.0) に保護されているサービスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-104">These include Google, Facebook, and services protected by Microsoft Identity Platform (formerly Azure AD V 2.0) such as Microsoft Account and Office 365 (Work or School accounts).</span></span> <span data-ttu-id="21fe0-105">アドインが **Office on the web** で実行される場合は、作業ウィンドウは iframe になるため、Office アドインに問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-105">This creates a problem for Office Add-ins because when the add-in is running in **Office on the web**, the task pane is an iframe.</span></span> <span data-ttu-id="21fe0-106">完全に異なるブラウザー インスタンスを開くことがアドインで可能な場合は、アドインのユーザーがログインできるのはこれらのサービスのうち 1 つのみです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-106">Users of an add-in can only login to one of these services if the add-in can open an entirely separate browser instance.</span></span> <span data-ttu-id="21fe0-107">Office で[Office ダイアログ API](dialog-api-in-office-add-ins.md)、特に [displayDialogAsync](/javascript/api/office/office.ui) メソッドが提供されているのはこの理由からです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-107">This is why Office provides its [Office dialog API](dialog-api-in-office-add-ins.md), specifically the [displayDialogAsync](/javascript/api/office/office.ui) method.</span></span>

> [!NOTE]
> <span data-ttu-id="21fe0-108">この記事は、[Office アドインでの Office ダイアログ API の使用](dialog-api-in-office-add-ins.md)に精通していることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-108">This article assumes that you are familiar with [Use the Office dialog API in your Office Add-ins](dialog-api-in-office-add-ins.md).</span></span>

<span data-ttu-id="21fe0-109">この API を使用して表示されるダイアログ ボックスには、次の特徴があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-109">The dialog box that is opened with this API has the following characteristics:</span></span>

- <span data-ttu-id="21fe0-110">[モードレス](https://en.wikipedia.org/wiki/Dialog_box)です。</span><span class="sxs-lookup"><span data-stu-id="21fe0-110">It is [nonmodal](https://en.wikipedia.org/wiki/Dialog_box).</span></span>
- <span data-ttu-id="21fe0-111">これは作業ウィンドウとは完全に異なるブラウザー インスタンスで、次のことを意味します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-111">It is a completely separate browser instance from the task pane, meaning:</span></span>
  - <span data-ttu-id="21fe0-112">独自の JavaScript ランタイム環境ならびにウィンドウ オブジェクトおよびグローバル変数を持ちます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-112">It has its own JavaScript runtime environment and window object and global variables.</span></span>
  - <span data-ttu-id="21fe0-113">作業ウィンドウと共有される実行環境はありません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-113">There is no shared execution environment with the task pane.</span></span>
  - <span data-ttu-id="21fe0-114">同じセッション ストレージは作業ウィンドウとは共有されません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-114">It does not share the same session storage as the task pane.</span></span>
- <span data-ttu-id="21fe0-115">ダイアログ ボックスで開かれる最初のページは、作業ウィンドウと同じドメイン (該当する場合は、プロトコル、サブドメイン、およびポートを含む) でホストされる必要があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-115">The first page opened in the dialog box must be hosted in the same domain as the task pane, including protocol, subdomains, and port, if any.</span></span>
- <span data-ttu-id="21fe0-116">ダイアログ ボックスは [messageparent](/javascript/api/office/office.ui#messageparent-message-) メソッドを使用して作業ウィンドウに情報を返すことができますが、このメソッドは、作業ウィンドウと同じドメイン (プロトコル、サブドメイン、およびポートを含む) にホストされているページからのみ呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-116">The dialog box can send information back to the task pane by using the [messageParent](/javascript/api/office/office.ui#messageparent-message-) method, but this method can be called only from a page that is hosted in the same domain as the task pane, including protocol, subdomains, and port.</span></span>

<span data-ttu-id="21fe0-117">ダイアログ ボックスが iframe (既定) ではない場合、ID プロバイダーのログイン ページを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-117">When the dialog box is not an iframe (which is the default), it can open the login page of an identity provider.</span></span> <span data-ttu-id="21fe0-118">次に示すように、Office ダイアログ ボックスの特性は、MSAL や Passport などの認証ライブラリまたは承認ライブラリの使用方法に影響します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-118">As you'll see below, the characteristics of the Office dialog box have implications for how you use authentication or authorization libraries such as MSAL and Passport.</span></span>

> [!NOTE]
> <span data-ttu-id="21fe0-119">浮動 iframe で開くようにダイアログ ボックスを構成する方法があります。呼び出しの `displayInIframe: true` オプションを `displayDialogAsync` に渡すだけです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-119">There is a way to configure the dialog box to open in a floating iframe: you simply pass the `displayInIframe: true` option in the call to `displayDialogAsync`.</span></span> <span data-ttu-id="21fe0-120">ログインに Office ダイアログ API を使用している場合は、この方法を使用*しない*でください。</span><span class="sxs-lookup"><span data-stu-id="21fe0-120">Do *not* do this when you are using the Office dialog API for login.</span></span>

## <a name="authentication-flow-with-the-office-dialog-box"></a><span data-ttu-id="21fe0-121">Office ダイアログ ボックスの認証フロー</span><span class="sxs-lookup"><span data-stu-id="21fe0-121">Authentication flow with the Office dialog box</span></span>

<span data-ttu-id="21fe0-122">シンプルで標準的な認証フローを下に示します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-122">The following is a simple and typical authentication flow.</span></span> <span data-ttu-id="21fe0-123">図の下に詳細の説明があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-123">Details are after the diagram.</span></span>

![作業ウィンドウとダイアログ ボックス ブラウザーのプロセスの関係を示す画像。](../images/taskpane-dialog-processes.gif)

1. <span data-ttu-id="21fe0-125">ダイアログ ボックスで開かれる最初のページは、アドインのドメイン (つまり作業ウィンドウと同じドメイン) でホストされているページ (または他のリソース) です。</span><span class="sxs-lookup"><span data-stu-id="21fe0-125">The first page that opens in the dialog box is a page (or other resource) that is hosted in the add-in's domain; that is, the same domain as the task pane window.</span></span> <span data-ttu-id="21fe0-126">このページには、"*プロバイダー名* にサインインできるページにリダイレクトしていますので、お待ちください。" という簡単な UI を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-126">This page can have a simple UI that says "Please wait, we are redirecting you to the page where you can sign in to *NAME-OF-PROVIDER*."</span></span> <span data-ttu-id="21fe0-127">このページのコードは、ダイアログ ボックスに渡される情報 (「[情報をダイアログ ボックスに渡す](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box)」で説明されています) またはアドインの構成ファイル (web.config ファイルなど) にハードコーディングされている情報を使用して ID プロバイダーのサインイン ページの URL を構築します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-127">The code in this page constructs the URL of the identity provider's sign-in page with information that is either passed to the dialog box as described in [Pass information to the dialog box](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box) or is hardcoded into a configuration file of the add-in, such as a web.config file.</span></span>
2. <span data-ttu-id="21fe0-128">次に、ダイアログ ボックス ウィンドウはサインイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="21fe0-128">The dialog box window then redirects to the sign-in page.</span></span> <span data-ttu-id="21fe0-129">URL には、ユーザーがサインインしたらダイアログ ボックス ウィンドウを特定のページにリダイレクトするように ID プロバイダーに指示するクエリ パラメーターが含まれています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-129">The URL includes a query parameter that tells the identity provider to redirect the dialog box window to a specific page after the user signs in.</span></span> <span data-ttu-id="21fe0-130">この記事では、このページを **redirectPage.html** と呼びます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-130">In this article, we'll call this page **redirectPage.html**.</span></span> <span data-ttu-id="21fe0-131">*このページはホスト ウィンドウと同じドメインにある必要があります*。これは、`messageParent` の呼び出しを使用してサインインの試みの結果を作業ウィンドウに渡せるようにするためです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-131">*This must be a page in the same domain as the host window*, so that the results of the sign-in attempt can be passed to the task pane with a call of `messageParent`.</span></span>
3. <span data-ttu-id="21fe0-132">ID プロバイダーのサービスは、ダイアログ ボックス ウィンドウから受信する GET 要求を処理します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-132">The identity provider's service processes the incoming GET request from the dialog box window.</span></span> <span data-ttu-id="21fe0-133">ユーザーが既にサインインしている場合は、ウィンドウが直ちに **redirectPage.html** にリダイレクトされ、クエリ パラメーターとしてユーザー データが含まれます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-133">If the user is already signed in, it immediately redirects the window to **redirectPage.html** and includes user data as a query parameter.</span></span> <span data-ttu-id="21fe0-134">ユーザーがまだサインインしていない場合は、プロバイダーのサインイン ページがウィンドウに表示されます。ユーザーはサインインします。</span><span class="sxs-lookup"><span data-stu-id="21fe0-134">If the user is not already signed in, the provider's sign-in page appears in the window, and the user signs in.</span></span> <span data-ttu-id="21fe0-135">ほとんどのプロバイダーでは、ユーザーが正常にサインインできない場合、プロバイダーはダイアログ ボックス ウィンドウにエラー ページを表示して、**redirectPage.html** にはリダイレクトしません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-135">For most providers, if the user cannot sign in successfully, the provider shows an error page in the dialog box window and does not redirect to **redirectPage.html**.</span></span> <span data-ttu-id="21fe0-136">ユーザーは隅にある **X** を選択して、ウィンドウを閉じる必要があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-136">The user must close the window by selecting the **X** in the corner.</span></span> <span data-ttu-id="21fe0-137">ユーザーが正常にサインインした場合は、ダイアログ ボックス ウィンドウが **redirectPage.html** にリダイレクトされ、ユーザー データはクエリ パラメーターとして含まれます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-137">If the user successfully signs in, the dialog box window is redirected to **redirectPage.html** and user data is included as a query parameter.</span></span>
4. <span data-ttu-id="21fe0-138">**redirectPage.html** ページが開くと、成功または失敗を作業ウィンドウ ページに報告するために `messageParent` が呼び出され、ユーザー データまたはエラー データも必要に応じて報告されます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-138">When the **redirectPage.html** page opens, it calls `messageParent` to report the success or failure to the task pane page and optionally also report user data or error data.</span></span> <span data-ttu-id="21fe0-139">その他のメッセージには、アクセス トークンの受け渡しや、トークンがストレージにあるという作業ウィンドウへの伝達が含まれます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-139">Other possible messages include passing an access token or telling the task pane that the token is in storage.</span></span>
5. <span data-ttu-id="21fe0-140">`DialogMessageReceived` イベントが作業ウィンドウ ページで発生し、イベントのハンドラーによりダイアログ ボックス ウィンドウが閉じられ、メッセージはさらに処理される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-140">The `DialogMessageReceived` event fires in the task pane page and its handler closes the dialog box window and may further process of the message.</span></span>

#### <a name="support-multiple-identity-providers"></a><span data-ttu-id="21fe0-141">複数の ID プロバイダーのサポート</span><span class="sxs-lookup"><span data-stu-id="21fe0-141">Support multiple identity providers</span></span>

<span data-ttu-id="21fe0-p109">アドインによってユーザーが Microsoft アカウント、Google、Facebook などのプロバイダーを選択できる場合は、ユーザーがプロバイダーを選択するための UI を提供するローカルの最初のページ (前述のセクションを参照) が必要です。選択すると、サインイン URL とその URL へのリダイレクトの構築がトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-p109">If your add-in gives the user a choice of providers, such as Microsoft Account, Google, or Facebook, you need a local first page (see preceding section) that provides a UI for the user to select a provider. Selection triggers the construction of the sign-in URL and redirection to it.</span></span>

#### <a name="authorization-of-the-add-in-to-an-external-resource"></a><span data-ttu-id="21fe0-144">外部リソースへのアドインの承認</span><span class="sxs-lookup"><span data-stu-id="21fe0-144">Authorization of the add-in to an external resource</span></span>

<span data-ttu-id="21fe0-145">最新の Web において、ユーザーと Web アプリケーションはセキュリティ プリンシパルです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-145">In the modern web, users and web applications are security principals.</span></span> <span data-ttu-id="21fe0-146">アプリケーションには、Office 365、Google+、Facebook、LinkedIn などのオンライン リソースに対する独自の ID とアクセス許可があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-146">The application has its own identity and permissions to an online resource such as Office 365, Google Plus, Facebook, or LinkedIn.</span></span> <span data-ttu-id="21fe0-147">アプリケーションは、展開前にリソース プロバイダーに登録されます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-147">The application is registered with the resource provider before it is deployed.</span></span> <span data-ttu-id="21fe0-148">登録には以下が含まれています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-148">The registration includes:</span></span>

- <span data-ttu-id="21fe0-149">アプリケーションが必要とするアクセス許可の一覧。</span><span class="sxs-lookup"><span data-stu-id="21fe0-149">A list of the permissions that the application needs.</span></span>
- <span data-ttu-id="21fe0-150">アプリケーションがサービスにアクセスするときに、リソース サービスがアクセス トークンを返す宛先の URL。</span><span class="sxs-lookup"><span data-stu-id="21fe0-150">A URL to which the resource service should return an access token when the application accesses the service.</span></span>  

<span data-ttu-id="21fe0-p111">リソース サービスのユーザーのデータにアクセスするアプリケーションでユーザーが関数を呼び出すと、ユーザーはサービスにサインインするように求められ、アプリケーションが必要とするユーザーのリソースへのアクセス許可をアプリケーションに付与するように求められます。次に、サービスはサインイン ウィンドウを既に登録済みの URL にリダイレクトし、アクセス トークンを渡します。アプリケーションはアクセス トークンを使用して、ユーザーのリソースにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="21fe0-p111">When a user invokes a function in the application that accesses the user's data in the resource service, they are prompted to sign in to the service and then prompted to grant the application the permissions it needs to the user's resources. The service then redirects the sign-in window to the previously registered URL and passes the access token. The application uses the access token to access the user's resources.</span></span>

<span data-ttu-id="21fe0-154">このプロセスは Office ダイアログ API を使用して管理でき、これを行うにはユーザーのサインインについての説明でのフローと似たフローを使用します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-154">You can use the Office dialog API to manage this process by using a flow that is similar to the one described for users to sign in.</span></span> <span data-ttu-id="21fe0-155">次の点のみが違います。</span><span class="sxs-lookup"><span data-stu-id="21fe0-155">The only differences are:</span></span>

- <span data-ttu-id="21fe0-156">アプリケーションが必要とするアクセス許可を、ユーザーがアプリケーションに付与したことがない場合、ユーザーがサインインすると、これを実行するよう求めるメッセージがダイアログ ボックスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-156">If the user hasn't previously granted the application the permissions it needs, the user is prompted to do so in the dialog box after signing in.</span></span>
- <span data-ttu-id="21fe0-157">ダイアログ ボックス ウィンドウは、`messageParent` を使用して文字列に変換されたアクセス トークンを送信するか、またはホスト ウィンドウがアクセス トークンを取得できる場所にアクセス トークンを格納 (し、トークンが使用可能であることを `messageParent` を使用してホスト ウィンドウに伝達 )することで、アクセス トークンをホスト ウィンドウに送信します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-157">The dialog box window sends the access token to the host window either by using `messageParent` to send the stringified access token or by storing the access token where the host window can retrieve it (and using `messageParent` to tell the host window that the token is available).</span></span> <span data-ttu-id="21fe0-158">トークンには制限時間がありますが、制限時間内であれば追加のメッセージを表示することなく、ホスト ウィンドウはトークンを使用して、ユーザーのリソースに直接アクセスできます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-158">The token has a time limit, but while it lasts, the host window can use it to directly access the user's resources without any further prompting.</span></span>

<span data-ttu-id="21fe0-159">この目的のために Office ダイアログ API を使用するサンプル認証アドインが「[サンプル](#samples)」にいくつか記載されています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-159">Some authentication sample add-ins that use the Office dialog API for this purpose are listed in [Samples](#samples).</span></span>

## <a name="using-authentication-libraries-with-the-dialog-box"></a><span data-ttu-id="21fe0-160">ダイアログ ボックスでの認証ライブラリの使用</span><span class="sxs-lookup"><span data-stu-id="21fe0-160">Using authentication libraries with the dialog box</span></span>

<span data-ttu-id="21fe0-161">Office ダイアログ ボックスと作業ウィンドウが異なるブラウザー、JavaScript ランタイム、およびインスタンスで実行されるということは、認証と承認が同じウィンドウで行われる場合の使用方法とは異なる方法で、多くの認証ライブラリまたは承認ライブラリを使用する必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-161">The fact that the Office dialog box and the task pane run in different browser, and JavaScript runtime, instances means that you must use many authentication/authorization libraries in the way that is different from how they are used when authentication and authorization can take place in the same window.</span></span> <span data-ttu-id="21fe0-162">次のセクションでは、通常はこれらのライブラリを使用できない主な方法と、これらのライブラリを使用*できる*方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-162">The following sections describe the main ways that you usually cannot use these libraries and the way that you *can* use them.</span></span>

### <a name="you-usually-cannot-use-the-librarys-internal-cache-to-store-tokens"></a><span data-ttu-id="21fe0-163">多くの場合、トークンを格納するのにライブラリの内部キャッシュは使用できません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-163">You usually cannot use the library's internal cache to store tokens</span></span>

<span data-ttu-id="21fe0-164">通常、認証関連のライブラリでは、アクセス トークンを格納するためのメモリ内のキャッシュが提供されています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-164">Typically, auth-related libraries provide an in-memory cache to store the access token.</span></span> <span data-ttu-id="21fe0-165">その後に (Google、Microsoft Graph、Facebook などの) リソース プロバイダーに対する呼び出しが行われると、ライブラリは最初にライブラリのキャッシュ内のトークンの有効期限を確認します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-165">If subsequent calls to the resource provider (such as Google, Microsoft Graph, Facebook, etc.) are made, the library will first check to see if the token in its cache is expired.</span></span> <span data-ttu-id="21fe0-166">有効期限が切れていない場合、ライブラリは新しいトークンのために STS に新たにラウンドトリップを行うのではなく、キャッシュされたトークンを返します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-166">If it is unexpired, the library returns the cached token rather than making another round-trip to the STS for a new token.</span></span> <span data-ttu-id="21fe0-167">ただし、このパターンは Office アドインでは使用できません。ログインは Office ダイアログ ボックスのブラウザー インスタンスで発生するため、トークン キャッシュはそのインスタンスにあります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-167">But this pattern is not usable in Office add-ins. Since the login occurs in the Office dialog box's browser instance, the token cache is in that instance.</span></span>

<span data-ttu-id="21fe0-168">これと密接に関連するのは、ライブラリは通常、トークンを取得するための方法として対話型のメソッドと "サイレント" メソッドの両方を提供しているということです。</span><span class="sxs-lookup"><span data-stu-id="21fe0-168">Closely related to this is the fact that a library will typically provide both interactive and "silent" methods for getting a token.</span></span> <span data-ttu-id="21fe0-169">リソースに対しての認証とデータの呼び出しの両方を同じブラウザー インスタンス内で行うことができる場合、コードは、トークンを取得するためにコードがトークンをデータの呼び出しに追加する直前にサイレント メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-169">When you can do both the authentication and the data calls to the resource in the same browser instance, your code calls the silent method to obtain a token just before your code adds the token to the data call.</span></span> <span data-ttu-id="21fe0-170">サイレント メソッドは期限が切れていないトークンがあるかどうかキャッシュを確認し、あった場合はトークンを返します。</span><span class="sxs-lookup"><span data-stu-id="21fe0-170">The silent method checks for an unexpired token in the cache and returns it, if there is one.</span></span> <span data-ttu-id="21fe0-171">それ以外の場合は、サイレント メソッドは対話型のメソッドを呼び出し、対話型のメソッドは STS のログインにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="21fe0-171">Otherwise, the silent method calls the interactive method which redirects to the STS's login.</span></span> <span data-ttu-id="21fe0-172">ログインが完了すると、対話型のメソッドはトークンを返しますが、トークンはメモリにもキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-172">After login completes, the interactive method returns the token, but also caches it in memory.</span></span> <span data-ttu-id="21fe0-173">ただし、Office ダイアログ API を使用している場合は、リソースへのデータ呼び出し (これは、サイレント メソッドを呼び出します) は、作業ウィンドウのブラウザー インスタンスにあります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-173">But when the Office dialog API is being used, the data calls to the resource, which would call the silent method, are in the task pane's browser instance.</span></span> <span data-ttu-id="21fe0-174">ライブラリのトークン キャッシュはそのインスタンスに存在しません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-174">The library's token cache does not exist in that instance.</span></span>

<span data-ttu-id="21fe0-175">別の方法として、アドインのダイアログ ボックス ブラウザー インスタンスは、ライブラリの対話型のメソッドを直接呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-175">As an alternative, your add-in's dialog box browser instance can directly call the library's interactive method.</span></span> <span data-ttu-id="21fe0-176">このメソッドがトークンを返した場合、コードはトークンを作業ウィンドウのブラウザー インスタンスがそれを取得できる場所 (ローカル ストレージ \* やサーバー側のデータベースなど) に明示的に格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-176">When that method returns a token, your code must explicitly store the token someplace where the task pane's browser instance can retrieve it, such as Local Storage\* or a server-side database.</span></span> <span data-ttu-id="21fe0-177">別の方法としては、`messageParent` メソッドを使用してトークンを作業ウィンドウに渡す方法があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-177">Another option is to pass the token to the task pane with the `messageParent` method.</span></span> <span data-ttu-id="21fe0-178">この方法は、対話型のメソッドが、アクセス トークンをコードが読み取ることができる場所に格納している場合にのみ可能です。</span><span class="sxs-lookup"><span data-stu-id="21fe0-178">This alternative is only possible if the interactive method stores the access token in a place where your code can read it.</span></span> <span data-ttu-id="21fe0-179">ライブラリの対話型メソッドは、コードがアクセスできないオブジェクトのプライベート プロパティにトークンを格納するように作られている場合があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-179">Sometimes a library's interactive method is designed to store the token in a private property of an object that is inaccessible to your code.</span></span>

> [!NOTE]
> <span data-ttu-id="21fe0-180">\* トークン処理の戦略に影響を与えるバグがあります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-180">\* There is a bug that will effect your strategy for token handling.</span></span> <span data-ttu-id="21fe0-181">Safari または Microsoft Edge ブラウザーの **Office on the web** でアドインを実行している場合、ダイアログ ボックスとタスク ウィンドウは同じローカル ストレージを共有しないため、これらの間の通信に使用できません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-181">If the add-in is running in **Office on the web** in either the Safari or Edge browser, the dialog box and task pane do not share the same Local Storage, so it cannot be used to communicate between them.</span></span>

### <a name="you-usually-cannot-use-the-librarys-auth-context-object"></a><span data-ttu-id="21fe0-182">通常、ライブラリの "認証コンテキスト" オブジェクトは使用できません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-182">You usually cannot use the library's "auth context" object</span></span>

<span data-ttu-id="21fe0-183">多くの場合、認証関連のライブラリには、トークンの対話的な取得と、メソッドが返す "認証コンテキスト" オブジェクトの作成の両方を行うメソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-183">Often, an auth-related library has a method that both obtains a token interactively and also creates an "auth-context" object which the method returns.</span></span> <span data-ttu-id="21fe0-184">トークンはオブジェクトのプロパティです (プライベートで、コードから直接アクセスできない可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="21fe0-184">The token is a property of the object (possibly private and inaccessible directly from your code).</span></span> <span data-ttu-id="21fe0-185">そのオブジェクトには、リソースからデータを取得するメソッドが備わっています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-185">That object has the methods that get data from the resource.</span></span> <span data-ttu-id="21fe0-186">これらのメソッドには、(Google、Microsoft Graph、Facebook などの) リソースプロバイダーに対して行う HTTP 要求内のトークンが含まれます。</span><span class="sxs-lookup"><span data-stu-id="21fe0-186">These methods include the token in the HTTP Requests that they make to the resource provider (such as Google, Microsoft Graph, Facebook, etc.).</span></span>

<span data-ttu-id="21fe0-187">これらの認証コンテキストオブジェクトおよびこれらのオブジェクトを作成するメソッドは、Office アドインでは使用できません。ログインは Office ダイアログ ボックスのブラウザー インスタンスで発生するため、オブジェクトはそのインスタンスで作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="21fe0-187">These auth-context objects, and the methods that create them, are not usable in Office add-ins. Since the login occurs in the Office dialog box's browser instance, the object would have to be created there.</span></span> <span data-ttu-id="21fe0-188">ただし、リソースへのデータの呼び出しは作業ウィンドウのブラウザー インスタンスにあり、あるインスタンスから別のインスタンスにオブジェクトを移動する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-188">But the data calls to the resource are in the task pane browser instance and there is no way to get the object from one instance to another.</span></span> <span data-ttu-id="21fe0-189">たとえば、`messageParent` は文字列またはブール値のみを渡すことができるため、`messageParent` を使用してオブジェクトを渡すことはできません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-189">For example, you cannot pass the object with `messageParent` because `messageParent` can only pass strings or boolean values.</span></span> <span data-ttu-id="21fe0-190">メソッドを持つ JavaScript オブジェクトは、確実には文字化できません。</span><span class="sxs-lookup"><span data-stu-id="21fe0-190">A JavaScript object with methods cannot be reliably stringified.</span></span>

### <a name="how-you-can-use-libraries-with-the-office-dialog-api"></a><span data-ttu-id="21fe0-191">Office ダイアログ API でライブラリを使用する方法</span><span class="sxs-lookup"><span data-stu-id="21fe0-191">How you can use libraries with the Office dialog API</span></span>

<span data-ttu-id="21fe0-192">ほとんどのライブラリでは、モノリシックの "認証コンテキスト" オブジェクトに加えてまたはその代わりとして、モノリシックの度合いがより低いヘルパー オブジェクトをコードが作成するできるようにする、抽象化レベルの低い API が提供されています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-192">In addition to, or instead of, monolithic "auth context" objects, most libraries provide APIs at a lower level of abstraction that enable your code to create less monolithic helper objects.</span></span> <span data-ttu-id="21fe0-193">たとえば、[MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) バージョン </span><span class="sxs-lookup"><span data-stu-id="21fe0-193">For example, [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v.</span></span> <span data-ttu-id="21fe0-194">3.x.x には、ログイン URL を構築する API と、コードがアクセスできるプロパティ内のアクセス トークンを格納する AuthResult オブジェクトを構築するための別の API が含まれています。</span><span class="sxs-lookup"><span data-stu-id="21fe0-194">3.x.x has an API to construct a login URL, and another API that constructs an AuthResult object that contains an access token in a property that is accessible to your code.</span></span> <span data-ttu-id="21fe0-195">Office アドインの MSAL.NET の例については、「[Office アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET)」および「[Outlook アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="21fe0-195">For examples of MSAL.NET in an Office add-in see: [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) and [Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET).</span></span> <span data-ttu-id="21fe0-196">アドインで [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js) を使用する例については、「[Office アドイン Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="21fe0-196">For an example of using [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js) in an add-in, see [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React).</span></span>

<span data-ttu-id="21fe0-197">認証ライブラリおよび承認ライブラリの詳細については、「[Microsoft Graph: 推奨されるライブラリ](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples)」および「[その他の外部サービス: ライブラリ](auth-external-add-ins.md#libraries)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="21fe0-197">For more information about authentication and authorization libraries, see [Microsoft Graph: Recommended libraries](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples) and [Other external services: Libraries](auth-external-add-ins.md#libraries).</span></span>

## <a name="samples"></a><span data-ttu-id="21fe0-198">サンプル</span><span class="sxs-lookup"><span data-stu-id="21fe0-198">Samples</span></span>

- <span data-ttu-id="21fe0-199">[Office アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): ログインおよび Microsoft Graph データのアクセス トークンの取得を MSAL.NET ライブラリと承認コード フローを使用して行う、ASP.NET ベースのアドイン (Excel、Word、PowerPoint)。</span><span class="sxs-lookup"><span data-stu-id="21fe0-199">[Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): An ASP.NET based add-in (Excel, Word, or PowerPoint) that uses the MSAL.NET library and the Authorization Code Flow to log in and get an access token for Microsoft Graph data.</span></span>
- <span data-ttu-id="21fe0-200">[Outlook アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): 上記のアドインと同様ですが、Office アプリケーションは Outlook です。</span><span class="sxs-lookup"><span data-stu-id="21fe0-200">[Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): Just like the one above, but the Office application is Outlook.</span></span>
- <span data-ttu-id="21fe0-201">[Office アドイン Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React): ログインおよび Microsoft Graph データのアクセス トークンの取得を msal.js ライブラリと暗黙的フローを使用して行う、NodeJS ベースのアドイン (Excel、Word、PowerPoint)。</span><span class="sxs-lookup"><span data-stu-id="21fe0-201">[Office Add-in Microsoft Graph React](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-React): A NodeJS based add-in (Excel, Word, or PowerPoint) that uses the msal.js library and the Implicit Flow to log in and get an access token for Microsoft Graph data.</span></span>


<span data-ttu-id="21fe0-202">詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="21fe0-202">For more information, see:</span></span>
- [<span data-ttu-id="21fe0-203">Office アドインで外部サービスを承認する</span><span class="sxs-lookup"><span data-stu-id="21fe0-203">Authorize external services in your Office Add-in</span></span>](auth-external-add-ins.md)
- [<span data-ttu-id="21fe0-204">Office アドインで Office ダイアログ API を使用する</span><span class="sxs-lookup"><span data-stu-id="21fe0-204">Use the Office dialog API in your Office Add-ins</span></span>](dialog-api-in-office-add-ins.md)
