---
title: Office Dialog API を使用して認証および承認する
description: ''
ms.date: 08/07/2019
localization_priority: Priority
ms.openlocfilehash: 3d61c82f28fd5780176b356e1ab4d394e5fbf8bd
ms.sourcegitcommit: 1dc1bb0befe06d19b587961da892434bd0512fb5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2019
ms.locfileid: "36302959"
---
# <a name="authenticate-and-authorize-with-the-office-dialog-api"></a><span data-ttu-id="5efa4-102">Office Dialog API を使用して認証および承認する</span><span class="sxs-lookup"><span data-stu-id="5efa4-102">Authenticate and authorize with the Office Dialog API</span></span>

> [!NOTE]
> <span data-ttu-id="5efa4-103">この記事は、[Office アドインでのダイアログ API の使用](dialog-api-in-office-add-ins.md)に慣れていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-103">This article assumes that you are familiar with [Use the Dialog API in your Office Add-ins](dialog-api-in-office-add-ins.md).</span></span>

<span data-ttu-id="5efa4-104">Secure Token Services (STS) とも呼ばれる多くの ID 機関は、ログイン ページが iframe で開かないようにします。</span><span class="sxs-lookup"><span data-stu-id="5efa4-104">Many identity authorities, also called Secure Token Services (STS), prevent their login page from opening in an iframe.</span></span> <span data-ttu-id="5efa4-105">これらの機能には、Microsoft アカウントと Office 365 (職場または学校のアカウント) などの Microsoft ID プラットフォーム (以前の Azure AD V 2.0) に保護されている Google、Facebook、およびサービスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-105">These include Google, Facebook, and services protected by Microsoft Identity Platform (formerly Azure AD V 2.0) such as Microsoft Account and Office 365 (Work or School accounts).</span></span> <span data-ttu-id="5efa4-106">これにより、アドインが **Office on the web** で実行されており、作業ウィンドウが iframe の場合に、Office アドインに問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-106">This creates a problem for Office Add-ins because when the add-in is running in **Office on the web**, the task pane is an iframe.</span></span> <span data-ttu-id="5efa4-107">アドインで完全に独立したブラウザー インスタンスを開くことができる場合に、アドインのユーザーはこれらのいずれかのサービスにのみログインできます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-107">Users of an add-in can only login to one of these services if the add-in can open an entirely separate browser instance.</span></span> <span data-ttu-id="5efa4-108">Office には[ダイアログ API](dialog-api-in-office-add-ins.md)、特に [displayDialogAsync](/javascript/api/office/office.ui) メソッドが用意されているためです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-108">This is why Office provides its [Dialog API](dialog-api-in-office-add-ins.md), specifically the [displayDialogAsync](/javascript/api/office/office.ui) method.</span></span>

<span data-ttu-id="5efa4-109">この API が表示されるダイアログ ボックスには、次の特徴があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-109">The dialog box that is opened with this API has the following characteristics:</span></span>

- <span data-ttu-id="5efa4-110">[非モーダル](https://en.wikipedia.org/wiki/Dialog_box)です。</span><span class="sxs-lookup"><span data-stu-id="5efa4-110">It is [non-modal](https://en.wikipedia.org/wiki/Dialog_box).</span></span>
- <span data-ttu-id="5efa4-111">次のような、作業ウィンドウと完全に独立したブラウザー インスタンスです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-111">It is a completely separate browser instance from the task pane, meaning:</span></span>
  - <span data-ttu-id="5efa4-112">これには、独自の JavaScript ランタイム環境およびウィンドウ オブジェクトとグローバル変数があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-112">It has its own JavaScript runtime environment and window object and global variables.</span></span>
  - <span data-ttu-id="5efa4-113">作業ウィンドウと共有されている実行環境はありません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-113">There is no shared execution environment with the task pane.</span></span>
  - <span data-ttu-id="5efa4-114">作業ウィンドウと同じセッション ストレージは共有されません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-114">It does not share the same session storage as the task pane.</span></span>
- <span data-ttu-id="5efa4-115">ダイアログ ボックスで開いた最初のページは、プロトコル、サブドメイン、ポートなどがあれば、作業ウィンドウと同じドメインにホストされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-115">The first page opened in the dialog box must be hosted in the same domain as the task pane, including protocol, subdomains, and port, if any.</span></span>
- <span data-ttu-id="5efa4-116">このダイアログ ボックスでは、[messageparent](/javascript/api/office/office.ui#messageparent-message-) メソッドを使用して作業ウィンドウに情報を返すことができますが、このメソッドは、プロトコル、サブドメイン、ポートなどの作業ウィンドウと同じドメインにホストされているページからのみ呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-116">The dialog box can send information back to the task pane by using the [messageParent](/javascript/api/office/office.ui#messageparent-message-) method, but this method can be called only from a page that is hosted in the same domain as the task pane, including protocol, subdomains, and port.</span></span>

<span data-ttu-id="5efa4-117">ダイアログが iframe (既定) ではない場合、ID プロバイダーのログイン ページを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-117">When the dialog is not an iframe (which is the default), it can open the login page of an identity provider.</span></span> <span data-ttu-id="5efa4-118">次に示すように、ダイアログの特徴は、MSAL や Passport などの認証または承認ライブラリの使用方法に影響します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-118">As you'll see below, the characteristics of the Dialog have implications for how you use authentication or authorization libraries such as MSAL and Passport.</span></span>

> [!NOTE]
> <span data-ttu-id="5efa4-119">`displayDialogAsync` への呼び出しで単に `displayInIframe: true` オプションを渡すといった浮動 iframe で開くようダイアログを設定する方法があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-119">There is a way to configure the dialog to open in a floating iframe: you simply pass the `displayInIframe: true` option in the call to `displayDialogAsync`.</span></span> <span data-ttu-id="5efa4-120">ログインにダイアログ API を使用している場合は、この操作を*行わないでください*。</span><span class="sxs-lookup"><span data-stu-id="5efa4-120">Do *not* do this when you are using the Dialog API for login.</span></span>

## <a name="authentication-flow-with-the-dialog"></a><span data-ttu-id="5efa4-121">ダイアログを使用した認証フロー</span><span class="sxs-lookup"><span data-stu-id="5efa4-121">Authentication flow with the Dialog</span></span>

<span data-ttu-id="5efa4-122">次に、シンプルで標準的な認証フローを示します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-122">The following is a simple and typical authentication flow.</span></span> <span data-ttu-id="5efa4-123">詳細は図表の後にあります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-123">Details are after the diagram.</span></span>

![作業ウィンドウとダイアログ ブラウザーのプロセスの関係を示す画像。](../images/taskpane-dialog-processes.gif)

1. <span data-ttu-id="5efa4-125">ダイアログ ボックスで開く最初のページは、アドインのドメイン (つまり作業ウィンドウと同じドメイン) でホストされるページ (または他のリソース) です。</span><span class="sxs-lookup"><span data-stu-id="5efa4-125">The first page that opens in the dialog box is a page (or other resource) that is hosted in the add-in's domain; that is, the same domain as the task pane window.</span></span> <span data-ttu-id="5efa4-126">このページには、"*NAME-OF-PROVIDER* にサインインが可能なページにリダイレクトしていますので、お待ちください。" という簡単な UI を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-126">This page can have a simple UI that says "Please wait, we are redirecting you to the page where you can sign in to *NAME-OF-PROVIDER*."</span></span> <span data-ttu-id="5efa4-127">「[情報をダイアログ ボックスに渡す](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box)」に記載されているように、このページのコードは、ダイアログ ボックスに渡される情報、または web.config ファイルのようなアドインの構成ファイルにハードコーディングされている情報を使用して、ID プロバイダーのサインイン ページの URL を構築します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-127">The code in this page constructs the URL of the identity provider's sign-in page with information that is either passed to the dialog box as described in [Pass information to the dialog box](dialog-api-in-office-add-ins.md#pass-information-to-the-dialog-box) or is hardcoded into a configuration file of the add-in, such as a web.config file.</span></span>
2. <span data-ttu-id="5efa4-128">次に、ダイアログ ウィンドウがサインイン ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-128">The dialog window then redirects to the sign-in page.</span></span> <span data-ttu-id="5efa4-129">URL には、ユーザーがサインインしたらダイアログ ウィンドウを特定のページにリダイレクトするように ID プロバイダーに指示するクエリ パラメーターが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-129">The URL includes a query parameter that tells the identity provider to redirect the dialog window to a specific page after the user signs in.</span></span> <span data-ttu-id="5efa4-130">この記事では、このページを **redirectPage.html** と呼びます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-130">In this article we'll call this page "video.dialogbox.html".</span></span> <span data-ttu-id="5efa4-131">*ホスト ウィンドウと同じドメイン内のページにする必要があるため*、サインインを試行した結果を、`messageParent`を呼び出した作業ウィンドウに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-131">*This must be a page in the same domain as the host window*, so that the results of the sign-in attempt can be passed to the task pane with a call of `messageParent`.</span></span>
3. <span data-ttu-id="5efa4-132">ID プロバイダーのサービスは、ダイアログ ウィンドウの着信 GET 要求を処理します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-132">The identity provider's service processes the incoming GET request from the dialog window.</span></span> <span data-ttu-id="5efa4-133">ユーザーが既にサインインしている場合は、直ちにウィンドウを **redirectPage.html** にリダイレクトして、ユーザー データをクエリ パラメーターとして含めます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-133">If the user is already logged on, it immediately redirects the window to redirectPage.html and includes user data as a query parameter.</span></span> <span data-ttu-id="5efa4-134">ユーザーがまだサインインしていない場合は、プロバイダーのサインイン ページがウィンドウに表示され、ユーザーがサインインします。</span><span class="sxs-lookup"><span data-stu-id="5efa4-134">If the user is not already signed in, the provider's sign-in page appears in the window, and the user signs in.</span></span> <span data-ttu-id="5efa4-135">ほとんどのプロバイダーでは、ユーザーが正常にサインインできない場合、プロバイダーはダイアログ ウィンドウにエラー ページを表示して、**redirectPage.html** にはリダイレクトしません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-135">For most providers, if the user cannot sign in successfully, the provider shows an error page in the dialog window and does not redirect to redirectPage.html.</span></span> <span data-ttu-id="5efa4-136">ユーザーは隅にある **X** を選択して、ウィンドウを閉じる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-136">The user must close the window by selecting the **X** in the corner.</span></span> <span data-ttu-id="5efa4-137">ユーザーが正常にサインインした場合は、ダイアログ ウィンドウが **redirectPage.html** にリダイレクトされ、ユーザー データがクエリ パラメーターとして含まれます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-137">If the user successfully signs in, the dialog window is redirected to redirectPage.html and user data is included as a query parameter.</span></span>
4. <span data-ttu-id="5efa4-138">**redirectPage.html** ページが開くと、`messageParent` を呼び出して、成功または失敗を作業ウィンドウ ページに報告し、また必要に応じて、ユーザー データまたはエラー データも報告します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-138">When the redirectPage.html page opens, it calls `messageParent` to report the success or failure to the host page and optionally also report user data or error data.</span></span> <span data-ttu-id="5efa4-139">その他のメッセージには、アクセス トークンの受け渡しや、トークンがストレージにあるという作業ウィンドウへの伝達が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-139">Other possible messages include passing an access token or telling the task pane that the token is in storage.</span></span>
5. <span data-ttu-id="5efa4-140">`DialogMessageReceived` イベントが作業ウィンドウ ページで発生し、そのハンドラーはダイアログ ウィンドウを閉じ、メッセージをさらに処理できます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-140">The `DialogMessageReceived` event fires in the host page and its handler closes the dialog window and optionally does other processing of the message.</span></span>

#### <a name="support-multiple-identity-providers"></a><span data-ttu-id="5efa4-141">複数の ID プロバイダーのサポート</span><span class="sxs-lookup"><span data-stu-id="5efa4-141">Support multiple identity providers</span></span>

<span data-ttu-id="5efa4-p109">アドインによってユーザーが Microsoft アカウント、Google、Facebook などのプロバイダーを選択できる場合は、ユーザーがプロバイダーを選択するための UI を提供するローカルの最初のページ (前述のセクションを参照) が必要です。選択すると、サインイン URL とその URL へのリダイレクトの構築がトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-p109">If your add-in gives the user a choice of providers, such as Microsoft Account, Google, or Facebook, you need a local first page (see preceding section) that provides a UI for the user to select a provider. Selection triggers the construction of the sign-in URL and redirection to it.</span></span>

#### <a name="authorization-of-the-add-in-to-an-external-resource"></a><span data-ttu-id="5efa4-144">外部リソースへのアドインの承認</span><span class="sxs-lookup"><span data-stu-id="5efa4-144">Authorization of the add-in to an external resource</span></span>

<span data-ttu-id="5efa4-145">最新の Web において、ユーザーと Web アプリケーションはセキュリティ プリンシパルです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-145">In the modern web, users and web applications are security principals.</span></span> <span data-ttu-id="5efa4-146">アプリケーションには Office 365、Google+、Facebook、LinkedIn などのオンライン リソースに対する独自の ID とアクセス許可があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-146">In the modern web, web applications are security principals just as users are, and the application has its own identity and permissions to an online resource such as Office 365, Google Plus, Facebook, or LinkedIn.</span></span> <span data-ttu-id="5efa4-147">アプリケーションは、展開前にリソース プロバイダーに登録されます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-147">The application is registered with the resource provider before it is deployed.</span></span> <span data-ttu-id="5efa4-148">登録には以下が含まれています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-148">The registration includes:</span></span>

- <span data-ttu-id="5efa4-149">アプリケーションが必要とするアクセス許可の一覧。</span><span class="sxs-lookup"><span data-stu-id="5efa4-149">A list of the permissions that the application needs to a user's resources.</span></span>
- <span data-ttu-id="5efa4-150">アプリケーションがサービスにアクセスするときに、リソース サービスがアクセス トークンを返す宛先の URL。</span><span class="sxs-lookup"><span data-stu-id="5efa4-150">A URL to which the resource service should return an access token when the application accesses the service.</span></span>  

<span data-ttu-id="5efa4-p111">リソース サービスのユーザーのデータにアクセスするアプリケーションでユーザーが関数を呼び出すと、ユーザーはサービスにサインインするように求められ、アプリケーションが必要とするユーザーのリソースへのアクセス許可をアプリケーションに付与するように求められます。次に、サービスはサインイン ウィンドウを既に登録済みの URL にリダイレクトし、アクセス トークンを渡します。アプリケーションはアクセス トークンを使用して、ユーザーのリソースにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="5efa4-p111">When a user invokes a function in the application that accesses the user's data in the resource service, they are prompted to sign in to the service and then prompted to grant the application the permissions it needs to the user's resources. The service then redirects the sign-in window to the previously registered URL and passes the access token. The application uses the access token to access the user's resources.</span></span>

<span data-ttu-id="5efa4-154">ユーザーのサインイン用に示されているフローと類似したフローを使用すると、ダイアログ API を使用してこのプロセスを管理できます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-154">You can use the Dialog APIs to manage this process by using a flow that is similar to the one described for users to sign in.</span></span> <span data-ttu-id="5efa4-155">違いは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-155">The only differences are:</span></span>

- <span data-ttu-id="5efa4-156">アプリケーションが必要とするアクセス許可を、ユーザーがアプリケーションに付与したことがない場合は、サインインすると、ユーザーに対してこれを実行するよう求めるメッセージがダイアログ ボックスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-156">If the user hasn't previously granted the application the permissions it needs, she is prompted to do so in the dialog box after signing in.</span></span>
- <span data-ttu-id="5efa4-157">ダイアログ ウィンドウは、`messageParent` を使用して文字列に変換されたアクセス トークンを送信するか、またはホスト ウィンドウがアクセス トークンを取得できる場所にアクセス トークンを格納 (してトークンが使用可能であることをホスト ウィンドウに伝達する `messageParent` を使用)することで、アクセス トークンをホスト ウィンドウに送信します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-157">The dialog window sends the access token to the host window either by using `messageParent` to send the stringified access token or by storing the access token where the host window can retrieve it.</span></span> <span data-ttu-id="5efa4-158">トークンには制限時間がありますが、制限時間内であれば追加のメッセージを表示することなく、ホスト ウィンドウはトークンを使用して、ユーザーのリソースに直接アクセスできます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-158">The token has a time limit, but while it lasts, the host window can use it to directly access the user's resources without any further prompting.</span></span>

<span data-ttu-id="5efa4-159">この目的のためにダイアログ API を使う一部の認証サンプル アドインは、[サンプル](#samples)に記載されています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-159">Some authentication sample add-ins that use the Dialog API for this purpose are listed in [Samples](#samples).</span></span>

## <a name="using-authentication-libraries-with-the-dialog"></a><span data-ttu-id="5efa4-160">ダイアログでの認証ライブラリの使用</span><span class="sxs-lookup"><span data-stu-id="5efa4-160">Using authentication libraries with the dialog</span></span>

<span data-ttu-id="5efa4-161">Office ダイアログと作業ウィンドウが異なるブラウザーおよび JavaScript ランタイムで実行されるという事実は、認証と承認が同じウィンドウで行われる場合の使用方法とは異なる方法で、多くの認証または承認ライブラリを使用する必要があるということです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-161">The fact that the Office Dialog and the task pane run in different browser, and JavaScript runtime, instances means that you must use many authentication/authorization libraries in the way that is different from how they are used when authentication and authorization can take place in the same window.</span></span> <span data-ttu-id="5efa4-162">次のセクションでは、通常これらのライブラリを使用しない主な方法と、これらのライブラリを使用*する*方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-162">The following sections describe the main ways that you usually cannot use these libraries and the way that you *can* use them.</span></span>

### <a name="you-usually-cannot-use-the-librarys-internal-cache-to-store-tokens"></a><span data-ttu-id="5efa4-163">通常、トークンを格納するのにライブラリの内部キャッシュは使用できません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-163">You usually cannot use the library's internal cache to store tokens</span></span>

<span data-ttu-id="5efa4-164">通常、認証関連のライブラリには、アクセス トークンを格納するメモリ内のキャッシュが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-164">Typically, auth-related libraries provide an in-memory cache to store the access token.</span></span> <span data-ttu-id="5efa4-165">その後に、(Google、Microsoft Graph、Facebook などの) リソース プロバイダーを呼び出すと、ライブラリは最初にキャッシュ内のトークンの有効期限が切れているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-165">If subsequent calls to the resource provider (such as Google, Microsoft Graph, Facebook, etc.) are made, the library will first check to see if the token in its cache is expired.</span></span> <span data-ttu-id="5efa4-166">期限が切れている場合、ライブラリは新しいトークンの STS に別のラウンドトリップを行うのではなく、キャッシュされたトークンを返します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-166">If it is unexpired, the library returns the cached token rather than making another round-trip to the STS for a new token.</span></span> <span data-ttu-id="5efa4-167">ただし、このパターンは Office アドインでは使用できません。ログインは Office ダイアログのブラウザー インスタンスで発生するため、トークン キャッシュはそのインスタンスにあります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-167">But this pattern is not usable in Office add-ins. Since the login occurs in the Office Dialog's browser instance, the token cache is in that instance.</span></span>

<span data-ttu-id="5efa4-168">これに密接に関連するのは、ライブラリが通常、トークンを取得するための対話型のメソッドと "silent" メソッドの両方を用意しているという事実です。</span><span class="sxs-lookup"><span data-stu-id="5efa4-168">Closely related to this is the fact that a library will typically provide both interactive and "silent" methods for getting a token.</span></span> <span data-ttu-id="5efa4-169">同じブラウザー インスタンスのリソースに対して認証とデータの呼び出しの両方を行うことができる場合は、コードが silent メソッドを呼び出して、トークンをデータの呼び出しに追加する直前にトークンを取得します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-169">When you can do both the authentication and the data calls to the resource in the same browser instance, your code calls the silent method to obtain a token just before your code adds the token to the data call.</span></span> <span data-ttu-id="5efa4-170">silent メソッドがキャッシュの期限切れのトークンを確認し、期限切れのトークンがある場合は返します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-170">The silent method checks for an unexpired token in the cache and returns it, if there is one.</span></span> <span data-ttu-id="5efa4-171">それ以外の場合、silent メソッドは対話型のメソッドを呼び出して、STS のログインにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="5efa4-171">Otherwise, the silent method calls the interactive method which redirects to the STS's login.</span></span> <span data-ttu-id="5efa4-172">ログインが完了すると、対話型のメソッドはトークンを返しますが、メモリにもキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="5efa4-172">After login completes, the interactive method returns the token, but also caches it in memory.</span></span> <span data-ttu-id="5efa4-173">ただし、Office ダイアログ API を使用している場合は、リソースへのデータ呼び出し (silent メソッドの呼び出し) は、作業ウィンドウのブラウザー インスタンスにあります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-173">But when the Office Dialog API is being used, the data calls to the resource, which would call the silent method, are in the task pane's browser instance.</span></span> <span data-ttu-id="5efa4-174">ライブラリのトークン キャッシュはそのインスタンスに存在しません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-174">The library's token cache does not exist in that instance.</span></span>

<span data-ttu-id="5efa4-175">別の方法として、アドインのダイアログ ブラウザー インスタンスで、ライブラリの対話型のメソッドを直接呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="5efa4-175">As an alternative, your add-in's Dialog browser instance can directly call the library's interactive method.</span></span> <span data-ttu-id="5efa4-176">このメソッドがトークンを返す場合、作業ウィンドウのブラウザー インスタンスは、ローカル ストレージやサーバー側のデータベースなどトークンを取得できる場所に、コードでトークンを明示的に格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-176">When that method returns a token, your code must explicitly store the token someplace where the task pane's browser instance can retrieve it, such as Local Storage or a server-side database.</span></span> <span data-ttu-id="5efa4-177">別の方法としては、`messageParent` メソッドを使用してトークンを作業ウィンドウに渡すことです。</span><span class="sxs-lookup"><span data-stu-id="5efa4-177">Another option is to pass the token to the task pane with the `messageParent` method.</span></span> <span data-ttu-id="5efa4-178">この方法は、対話型のメソッドがコードで読み取ることができる場所にアクセス トークンを保存している場合にのみ可能です。</span><span class="sxs-lookup"><span data-stu-id="5efa4-178">This alternative is only possible if the interactive method stores the access token in a place where your code can read it.</span></span> <span data-ttu-id="5efa4-179">ライブラリの対話型メソッドは、コードにアクセスできないオブジェクトのプライベート プロパティのトークンを格納するように設計されている場合があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-179">Sometimes a library's interactive method is designed to store the token in a private property of an object that is inaccessible to your code.</span></span>

### <a name="you-usually-cannot-use-the-librarys-auth-context-object"></a><span data-ttu-id="5efa4-180">通常、ライブラリの "認証コンテキスト" オブジェクトは使用できません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-180">You usually cannot use the library's "auth context" object</span></span>

<span data-ttu-id="5efa4-181">多くの場合、認証関連のライブラリには、トークンを対話的に取得する方法と、メソッドが返す "認証コンテキスト" オブジェクトを作成する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-181">Often, an auth-related library has a method that both obtains a token interactively and also creates an "auth-context" object which the method returns.</span></span> <span data-ttu-id="5efa4-182">トークンはオブジェクトのプロパティです (プライベートであっても、コードから直接アクセスできない可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="5efa4-182">The token is a property of the object (possibly private and inaccessible directly from your code).</span></span> <span data-ttu-id="5efa4-183">そのオブジェクトには、リソースからデータを取得する方法があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-183">That object has the methods that get data from the resource.</span></span> <span data-ttu-id="5efa4-184">これには、(Google、Microsoft Graph、Facebook などの) リソースプロバイダーに対して行う HTTP 要求にトークンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-184">These methods include the token in the HTTP Requests that they make to the resource provider (such as Google, Microsoft Graph, Facebook, etc.).</span></span>

<span data-ttu-id="5efa4-185">この認証コンテキスト オブジェクトと、このオブジェクトの作成方法は、Office アドインでは使用できません。ログインは Office ダイアログのブラウザー インスタンスで発生するため、オブジェクトを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-185">These auth-context objects, and the methods that create them, are not usable in Office add-ins. Since the login occurs in the Office Dialog's browser instance, the object would have to be created there.</span></span> <span data-ttu-id="5efa4-186">ただし、リソースへのデータの呼び出しは、作業ウィンドウのブラウザー インスタンスにあり、あるインスタンスから別のインスタンスにオブジェクトを取得する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-186">But the data calls to the resource are in the task pane browser instance and there is no way to get the object from one instance to another.</span></span> <span data-ttu-id="5efa4-187">たとえば、`messageParent` は文字列またはブール値のみを渡すことができるため、`messageParent` ではオブジェクトを渡すことはできません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-187">For example, you cannot pass the object with `messageParent` because `messageParent` can only pass strings or boolean values.</span></span> <span data-ttu-id="5efa4-188">メソッドのある JavaScript オブジェクトを確実には変換できません。</span><span class="sxs-lookup"><span data-stu-id="5efa4-188">A JavaScript object with methods cannot be reliably stringified.</span></span>

### <a name="how-you-can-use-libraries-with-the-office-dialog-api"></a><span data-ttu-id="5efa4-189">Office ダイアログ API でライブラリを使用する方法</span><span class="sxs-lookup"><span data-stu-id="5efa4-189">How you can use libraries with the Office Dialog API</span></span>

<span data-ttu-id="5efa4-190">さらに、モノリシックの "認証コンテキスト" オブジェクトの代わりに、ほとんどのライブラリには、コードにより比較的モノリシックではないヘルパー オブジェクトを作成するできるようにする、抽象化レベルの低い API が用意されています。</span><span class="sxs-lookup"><span data-stu-id="5efa4-190">In addition to, or instead of, monolithic "auth context" objects, most libraries provide APIs at a lower level of abstraction that enable your code to create less monolithic helper objects.</span></span> <span data-ttu-id="5efa4-191">たとえば、[MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v があります。</span><span class="sxs-lookup"><span data-stu-id="5efa4-191">For example, [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v.</span></span> <span data-ttu-id="5efa4-192">3.x.x にはログイン URL を構築する API があり、コードにアクセス可能なプロパティにアクセス トークンがある AuthResult オブジェクトを構築する別の API を使用します。</span><span class="sxs-lookup"><span data-stu-id="5efa4-192">3.x.x has an API to construct a login URL, and another API that constructs an AuthResult object that contains an access token in a property that is accessible to your code.</span></span> <span data-ttu-id="5efa4-193">Office アドインの MSAL.NET の例については、「[Office アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET)」と「[Outlook アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5efa4-193">For examples of MSAL.NET in an Office add-in see: [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) and [Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET).</span></span>

<span data-ttu-id="5efa4-194">認証および承認ライブラリの詳細については、「[Microsoft Graph: 推奨されるライブラリ](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples)」と「[その他の外部サービス: ライブラリ](auth-external-add-ins.md#libraries)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5efa4-194">For more information about authentication and authorization libraries, see [Microsoft Graph: Recommended libraries](authorize-to-microsoft-graph-without-sso.md#recommended-libraries-and-samples) and [Other external services: Libraries](auth-external-add-ins.md#libraries).</span></span>

## <a name="samples"></a><span data-ttu-id="5efa4-195">サンプル</span><span class="sxs-lookup"><span data-stu-id="5efa4-195">Samples</span></span>

- <span data-ttu-id="5efa4-196">[Office アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): MSAL.NET ライブラリを使用して Microsoft Graph データのアクセス トークンを取得する ASP.NET ベースのアドイン (Excel、Word、PowerPoint)。</span><span class="sxs-lookup"><span data-stu-id="5efa4-196">[Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET): An ASP.NET based add-in (Excel, Word, or PowerPoint) that uses the MSAL.NET library to login and get an access token for Microsoft Graph data.</span></span>
- <span data-ttu-id="5efa4-197">[Outlook アドイン Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): 上記と同様に、Office アプリケーションは Outlook です。</span><span class="sxs-lookup"><span data-stu-id="5efa4-197">[Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/PnP-OfficeAddins/tree/master/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET): Just like the one above, but the Office application is Outlook.</span></span>

<span data-ttu-id="5efa4-198">詳細については、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5efa4-198">For more information, see:</span></span>
- [<span data-ttu-id="5efa4-199">Office アドインで外部サービスを承認する</span><span class="sxs-lookup"><span data-stu-id="5efa4-199">Authorize external services in your Office Add-in</span></span>](auth-external-add-ins.md)
- [<span data-ttu-id="5efa4-200">Office アドインでダイアログ API を使用する</span><span class="sxs-lookup"><span data-stu-id="5efa4-200">Use the Dialog API in your Office Add-ins</span></span>](dialog-api-in-office-add-ins.md)

