---
title: SSO を使用した Microsoft Graph への承認
description: アドインのユーザー Officeシングル サインオン (SSO) を使用して Microsoft Graph からデータを取得する方法について説明します。
ms.date: 07/30/2020
localization_priority: Normal
ms.openlocfilehash: d6d06b9d7ff42b72495f513ed2c6b8f6f36df1d0
ms.sourcegitcommit: d28392721958555d6edea48cea000470bd27fcf7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/13/2021
ms.locfileid: "49839972"
---
# <a name="authorize-to-microsoft-graph-with-sso"></a><span data-ttu-id="e2e37-103">SSO を使用した Microsoft Graph への承認</span><span class="sxs-lookup"><span data-stu-id="e2e37-103">Authorize to Microsoft Graph with SSO</span></span>

<span data-ttu-id="e2e37-104">ユーザーは個人用の Microsoft アカウントまたは Microsoft 365 Education または職場アカウントのいずれかを使用して、Office (オンライン、モバイル、およびデスクトップ プラットフォーム) にサインインします。</span><span class="sxs-lookup"><span data-stu-id="e2e37-104">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their Microsoft 365 Education or work account.</span></span> <span data-ttu-id="e2e37-105">Office アドインの [Microsoft Graph](https://developer.microsoft.com/graph/docs) へのアクセスの承認には、ユーザーの Office サインオン資格証明を使用するのが最良の方法です。</span><span class="sxs-lookup"><span data-stu-id="e2e37-105">The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="e2e37-106">これにより、2 回目はサインインする必要なく Microsoft Graph データにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-106">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span>

> [!NOTE]
> <span data-ttu-id="e2e37-107">現在、シングル サインオン API は Word、Excel、Outlook, および PowerPoint でサポートされています。</span><span class="sxs-lookup"><span data-stu-id="e2e37-107">The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="e2e37-108">シングル サインオン API の現在のサポート状態に関する詳細は、「[IdentityAPI の要件セット](../reference/requirement-sets/identity-api-requirement-sets.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-108">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](../reference/requirement-sets/identity-api-requirement-sets.md).</span></span>
> <span data-ttu-id="e2e37-109">Outlook アドインで作業している場合は、Office 365 テナントの先進認証が有効になっていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-109">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="e2e37-110">この方法の詳細については、「[Exchange Online: テナントの先進認証を有効にする方法](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-110">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="e2e37-111">SSO と Microsoft Graph のアドイン アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="e2e37-111">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="e2e37-112">Web アプリケーションのページと JavaScript をホスティングすることに加え、アドインでは、同一の[完全修飾ドメイン名](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly)で、Microsoft Graph へのアクセス トークンを取得して、要求を送信するための 1 つ以上の Web API をホストする必要もあります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-112">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="e2e37-113">アドイン マニフェストには、アドインを Azure Active Directory (Azure AD) v2.0 エンドポイントに登録する方法と、アドインが必要とする Microsoft Graph へのアクセス許可を指定するマークアップが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e2e37-113">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="e2e37-114">実行時の動作のしくみ</span><span class="sxs-lookup"><span data-stu-id="e2e37-114">How it works at runtime</span></span>

<span data-ttu-id="e2e37-115">次の図は、Microsoft Graph へのサインインおよびアクセスの処理がどのように行われるのかを示しています。</span><span class="sxs-lookup"><span data-stu-id="e2e37-115">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![SSO プロセスを示す図](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="e2e37-117">アドインで、JavaScript は新しい Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-117">In the add-in, JavaScript calls a new Office.js API [getAccessToken](/javascript/api/office-runtime/officeruntime.auth#getaccesstoken-options-).</span></span> <span data-ttu-id="e2e37-118">これにより、Office クライアント アプリケーションはアドインへのアクセス トークンを取得するように指示されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-118">This tells the Office client application to obtain an access token to the add-in.</span></span> <span data-ttu-id="e2e37-119">(これは処理の後半で 2 つ目のトークンと置換されるので、これ以降では **ブートストラップ アクセス トークン** と呼びます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-119">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="e2e37-120">デコードされたブートストラップ アクセス トークンの例については、[アクセス トークンの例](sso-in-office-add-ins.md#example-access-token)に関するページを参照してください)。</span><span class="sxs-lookup"><span data-stu-id="e2e37-120">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
2. <span data-ttu-id="e2e37-121">ユーザーがサインインしていない場合、Office クライアント アプリケーションはユーザーにサインインを求めるポップアップ ウィンドウを開きます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-121">If the user is not signed in, the Office client application opens a pop-up window for the user to sign in.</span></span>
3. <span data-ttu-id="e2e37-122">現在のユーザーが初めてアドインを使用する場合は、そのユーザーに同意を求めるダイアログを表示します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-122">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
4. <span data-ttu-id="e2e37-123">クライアント Officeは、現在のユーザーのAzure AD v2.0 エンドポイントからブートストラップ アクセス トークンを要求します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-123">The Office client application requests the **bootstrap access token** from the Azure AD v2.0 endpoint for the current user.</span></span>
5. <span data-ttu-id="e2e37-124">Azure ADクライアント アプリケーションにブートストラップ トークンOffice送信します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-124">Azure AD sends the bootstrap token to the Office client application.</span></span>
6. <span data-ttu-id="e2e37-125">クライアント Officeは、呼び出しによって返される結果オブジェクトの一部としてブートストラップ アクセス トークンをアドインに送信 `getAccessToken` します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-125">The Office client application sends the **bootstrap access token** to the add-in as part of the result object returned by the `getAccessToken` call.</span></span>
7. <span data-ttu-id="e2e37-126">アドインの JavaScript は、アドインと同じ完全修飾ドメイン名でホストされている Web API に HTTP 要求を送信して、その要求に承認の証拠として **ブートストラップ アクセス トークン** を含めます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-126">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **bootstrap access token** as authorization proof.</span></span>
8. <span data-ttu-id="e2e37-127">受け取った **ブートストラップ アクセス トークン** はサーバー側のコードで検証されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-127">Server-side code validates the incoming **bootstrap access token**.</span></span>
9. <span data-ttu-id="e2e37-128">サーバー側のコードは [、(OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) およびデーモンまたはサーバー アプリケーションから [Web API への Azure](/azure/active-directory/develop/active-directory-authentication-scenarios)シナリオで定義されている) "代理" フローを使用して、ブートストラップ アクセス トークンと引き換えに Microsoft Graph のアクセス トークンを取得します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-128">Server-side code uses the "on behalf of" flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](/azure/active-directory/develop/active-directory-authentication-scenarios)) to obtain an access token for Microsoft Graph in exchange for the bootstrap access token.</span></span>
10. <span data-ttu-id="e2e37-129">Azure AD は、アドインに Microsoft Graph へのアクセス トークンを返します (アドインが *offline_access* アクセス許可を要求した場合は、更新トークンも返します)。</span><span class="sxs-lookup"><span data-stu-id="e2e37-129">Azure AD returns the access token to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission) to the add-in.</span></span>
11. <span data-ttu-id="e2e37-130">サーバー側のコードが Microsoft Graph へのアクセス トークンをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="e2e37-130">Server-side code caches the access token to Microsoft Graph.</span></span>
12. <span data-ttu-id="e2e37-131">サーバー側のコードが Microsoft Graph に要求を送信します。そのコードには、Microsoft Graph へのアクセス トークンを含めます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-131">Server-side code makes requests to Microsoft Graph and includes the access token to Microsoft Graph.</span></span>
13. <span data-ttu-id="e2e37-132">Microsoft Graph はアドインにデータを返し、それをアドインの UI に渡します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-132">Microsoft Graph returns data to the add-in, which can pass it on to the add-in's UI.</span></span>
14. <span data-ttu-id="e2e37-133">Microsoft Graph へのアクセス トークンの期限が切れた場合、サーバー側のコードがその更新トークンを使用して、Microsoft Graph への新しいアクセス トークンを取得します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-133">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="e2e37-134">Microsoft Graph にアクセスする SSO を開発する</span><span class="sxs-lookup"><span data-stu-id="e2e37-134">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="e2e37-135">Microsoft Graph にアクセスするアドインは、SSO を使用する他のすべてのアドインと同様に開発できます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-135">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="e2e37-136">完全な説明については、「[Office アドインのシングル サインオンを有効化する](../develop/sso-in-office-add-ins.md)」を参照してください。違いは、アドインにサーバー側の Web API があることが必須であることと、この記事でアクセス トークンと呼ばれているものは “ブートストラップ アクセス トークン” と呼ばれているという点です。</span><span class="sxs-lookup"><span data-stu-id="e2e37-136">For a thorough description, see [Enable single sign-on for Office Add-ins](../develop/sso-in-office-add-ins.md). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span>

<span data-ttu-id="e2e37-137">使用する言語とフレームワークによっては、記述する必要のあるサーバー側コードが簡単になるライブラリが使用できることがあります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-137">Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write.</span></span> <span data-ttu-id="e2e37-138">コードでは、次に示す操作を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-138">Your code should do the following:</span></span>

* <span data-ttu-id="e2e37-139">ブートストラップ アクセス トークン、ユーザーに関するメタデータ、アドインの資格情報 (ID とシークレット) を含む Azure AD v2.0 エンドポイントを呼び出して、"代理" フローを開始します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-139">Initiate the "on behalf of" flow with a call to the Azure AD v2.0 endpoint that includes the bootstrap access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="e2e37-140">Microsoft Graph に (おそらくキャッシュされる) アクセス トークンを渡し、Microsoft Graph データを取得する 1 つ以上の Web API メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-140">Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token to Microsoft Graph.</span></span>
* <span data-ttu-id="e2e37-141">必要に応じて、フローを開始する前に、以前に作成したトークン ハンドラーから受け取ったアドイン ブートストラップ アクセス トークンを検証します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-141">Optionally, before initiating the flow, validate the add-in bootstrap access token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="e2e37-142">詳細については、[アクセス トークンの検証](sso-in-office-add-ins.md#validate-the-access-token)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-142">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="e2e37-143">必要に応じて、フローが完了した後に、Microsoft Graph のアクセス トークンをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="e2e37-143">Optionally, after the flow completes, cache the returned access token to Microsoft Graph.</span></span> <span data-ttu-id="e2e37-144">アドインで Microsoft Graph を複数回呼び出す場合に、これが行われます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-144">You'll want to do this if the add-in makes more than one call to Microsoft Graph.</span></span> <span data-ttu-id="e2e37-145">このフローの詳細については、「[Azure Active Directory v2.0 と OAuth 2.0 の On-Behalf-Of フロー](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-145">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

> [!NOTE]
> <span data-ttu-id="e2e37-146">“代理” フローで取得した Microsoft Graph のデコードされたアクセス トークンの例については、「[Azure Active Directory v2.0 と OAuth 2.0 の On-Behalf-Of フロー](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-146">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="e2e37-147">詳細なチュートリアルとシナリオについては、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2e37-147">For examples of detailed walkthroughs and scenarios, see:</span></span>

* [<span data-ttu-id="e2e37-148">シングル サインオンを使用する Node.js Office アドインを作成する</span><span class="sxs-lookup"><span data-stu-id="e2e37-148">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="e2e37-149">シングル サインオンを使用する ASP.NET Office アドインを作成する</span><span class="sxs-lookup"><span data-stu-id="e2e37-149">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="e2e37-150">シナリオ: Outlook アドインでサービスにシングル サインオンを実装する</span><span class="sxs-lookup"><span data-stu-id="e2e37-150">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](../outlook/implement-sso-in-outlook-add-in.md)

## <a name="distributing-sso-enabled-add-ins-in-microsoft-appsource"></a><span data-ttu-id="e2e37-151">Microsoft AppSource での SSO 対応アドインの配布</span><span class="sxs-lookup"><span data-stu-id="e2e37-151">Distributing SSO-enabled add-ins in Microsoft AppSource</span></span>

<span data-ttu-id="e2e37-152">Microsoft 365 管理者が[AppSource](https://appsource.microsoft.com)からアドインを取得すると、管理者は一元展開によって[](../publish/centralized-deployment.md)アドインを再配布し、Microsoft Graph スコープにアクセスするための管理者の同意をアドインに付与できます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-152">When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com), the admin can redistribute it by [centralized deployment](../publish/centralized-deployment.md) and grant admin consent to the add-in to access Microsoft Graph scopes.</span></span> <span data-ttu-id="e2e37-153">ただし、エンド ユーザーが AppSource から直接アドインを取得することもできます。その場合、ユーザーはアドインに同意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-153">It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in.</span></span> <span data-ttu-id="e2e37-154">これにより、ソリューションを提供した場合の潜在的なパフォーマンスの問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-154">This can create a potential performance problem for which we've provided a solution.</span></span>

<span data-ttu-id="e2e37-155">コードが "like" の呼び出しでオプションを渡した場合、Azure AD がアドインにまだ同意が付与されていないことを Office に報告した場合、Office はユーザーに同意を求めるメッセージを表示できます。 `allowConsentPrompt` `getAccessToken` `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`</span><span class="sxs-lookup"><span data-stu-id="e2e37-155">If your code passes the `allowConsentPrompt` option in the call of `getAccessToken`, like `OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } );`, then Office can prompt the user for consent if Azure AD reports to Office that consent has not yet been granted to the add-in.</span></span> <span data-ttu-id="e2e37-156">ただし、セキュリティ上の理由からOffice、Azure のスコープに同意するようユーザーにAD `profile` できます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-156">However, for security reasons, Office can only prompt the user to consent to the Azure AD `profile` scope.</span></span> <span data-ttu-id="e2e37-157">*Office Microsoft Graph のスコープに同意* を求め、それも `User.Read` できません。</span><span class="sxs-lookup"><span data-stu-id="e2e37-157">*Office cannot prompt for consent to any Microsoft Graph scopes*, not even `User.Read`.</span></span> <span data-ttu-id="e2e37-158">つまり、ユーザーがプロンプトに同意すると、Officeが返されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-158">This means that if the user grants consent on the prompt, Office will return a bootstrap token.</span></span> <span data-ttu-id="e2e37-159">ただし、Microsoft Graph へのアクセス トークンのブートストラップ トークンを交換しようとすると、エラー AADSTS65001 で失敗します。これは、(Microsoft Graph スコープに対する) 同意が付与されていないという意味です。</span><span class="sxs-lookup"><span data-stu-id="e2e37-159">But the attempt to exchange the bootstrap token for an access token to Microsoft Graph will fail with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.</span></span>

<span data-ttu-id="e2e37-160">コードでは、認証の代替システムに戻ってこのエラーを処理できます。また、このエラーを処理する必要があります。これにより、Microsoft Graph スコープへの同意を求めるメッセージがユーザーに表示されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-160">Your code can, and should, handle this error by falling back to an alternate system of authentication, which will prompt the user for consent to Microsoft Graph scopes.</span></span> <span data-ttu-id="e2e37-161">(コード例については、「シングル サインオンを使用する [Node.js Office](create-sso-office-add-ins-nodejs.md) アドインを作成する」および「シングル サインオンとリンク先のサンプルを使用する [ASP.NET Office](create-sso-office-add-ins-aspnet.md) アドインを作成する」を参照してください)。ただし、プロセス全体で Azure への複数回のラウンド トリップがAD。</span><span class="sxs-lookup"><span data-stu-id="e2e37-161">(For code examples, see [Create a Node.js Office Add-in that uses single sign-on](create-sso-office-add-ins-nodejs.md) and [Create an ASP.NET Office Add-in that uses single sign-on](create-sso-office-add-ins-aspnet.md) and the samples they link to.) But the entire process requires multiple round trips to Azure AD.</span></span> <span data-ttu-id="e2e37-162">このパフォーマンスの低下を回避するには、呼び出しに `forMSGraphAccess` `getAccessToken` オプションを含める必要があります `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )` 。</span><span class="sxs-lookup"><span data-stu-id="e2e37-162">You can avoid this performance penalty by including the `forMSGraphAccess` option in the call of `getAccessToken`; for example, `OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } )`.</span></span>  <span data-ttu-id="e2e37-163">これは、アドインOffice Microsoft Graph スコープが必要な場合に、そのスコープを示します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-163">This signals to Office that your add-in needs Microsoft Graph scopes.</span></span> <span data-ttu-id="e2e37-164">Officeは、Microsoft Graph ADに対する同意が既にアドインに付与されているのを確認するように Azure ADに求めるメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-164">Office will ask Azure AD to verify that consent to Microsoft Graph scopes has already been granted to the add-in.</span></span> <span data-ttu-id="e2e37-165">設定されている場合は、ブートストラップ トークンが返されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-165">If it has, the bootstrap token will be returned.</span></span> <span data-ttu-id="e2e37-166">呼び出しが失敗した場合は、 `getAccessToken` エラー 13012 が返されます。</span><span class="sxs-lookup"><span data-stu-id="e2e37-166">If it hasn't, then the call of `getAccessToken` will return error 13012.</span></span> <span data-ttu-id="e2e37-167">コードでこのエラーを処理するには、Azure AD とトークンをやり取りする不必要な試みを行わずに、認証の代替システムにすぐに戻AD。</span><span class="sxs-lookup"><span data-stu-id="e2e37-167">Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with Azure AD.</span></span>

<span data-ttu-id="e2e37-168">ベスト プラクティスとして、アドインが AppSource で配布され、Microsoft Graph スコープが必要になる場合に常に `forMSGraphAccess` `getAccessToken` 渡します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-168">As a best practice, always pass `forMSGraphAccess` to `getAccessToken` when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.</span></span>

> [!TIP]
> <span data-ttu-id="e2e37-169">SSO を使用する Outlook アドインを開発し、テスト用にサイドロードすると、管理者の同意が与えらた場合でも、Office は常にエラー 13012 を返します。 `forMSGraphAccess` `getAccessToken`</span><span class="sxs-lookup"><span data-stu-id="e2e37-169">If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when `forMSGraphAccess` is passed to `getAccessToken` even if administrator consent has been granted.</span></span> <span data-ttu-id="e2e37-170">このため、Outlook アドインを開発するときにオプション `forMSGraphAccess` をコメント アウトする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2e37-170">For this reason, you should comment out the `forMSGraphAccess` option **when developing** an Outlook add-in.</span></span> <span data-ttu-id="e2e37-171">実稼働環境に展開する場合は、必ずオプションの非コミットを行います。</span><span class="sxs-lookup"><span data-stu-id="e2e37-171">Be sure to uncomment the option when you deploy for production.</span></span> <span data-ttu-id="e2e37-172">偽の 13012 は、Outlook でサイドロードしている場合にのみ発生します。</span><span class="sxs-lookup"><span data-stu-id="e2e37-172">The bogus 13012 only happens when you are sideloading in Outlook.</span></span>