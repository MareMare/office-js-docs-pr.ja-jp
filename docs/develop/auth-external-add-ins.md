---
title: Office アドインで外部サービスを承認する
description: ''
ms.date: 02/12/2019
localization_priority: Priority
ms.openlocfilehash: 6420107f29fd285e52839cd737f19472194b835f
ms.sourcegitcommit: a59f4e322238efa187f388a75b7709462c71e668
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/13/2019
ms.locfileid: "29982000"
---
# <a name="authorize-external-services-in-your-office-add-in"></a><span data-ttu-id="46b25-102">Office アドインで外部サービスを承認する</span><span class="sxs-lookup"><span data-stu-id="46b25-102">Authorize external services in your Office Add-in</span></span>

<span data-ttu-id="46b25-p101">大手のオンライン サービス (Office 365、Google、Facebook、LinkedIn、SalesForce、GitHub など) では、開発者は、ユーザーが自分のアカウントに別のアプリケーションからアクセスできるようにすることが可能です。これにより、開発者は、これらのサービスを Office アドインに含めることができるようになります。</span><span class="sxs-lookup"><span data-stu-id="46b25-p101">Popular online services, including Office 365, Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications. This gives you the ability to include these services in your Office Add-in.</span></span>

<span data-ttu-id="46b25-p102">Web アプリケーションからオンライン サービスへのアクセスを可能にするための業界標準のフレームワークは **OAuth 2.0** です。ほとんどの場合、このフレームワークをアドインで使用するために、その動作のしくみを詳しく知る必要はありません。開発者は、この詳細を簡略化している多数のライブラリを使用できます。</span><span class="sxs-lookup"><span data-stu-id="46b25-p102">The industry standard framework for enabling web application access to an online service is **OAuth 2.0**. In most situations, you don't need to know the details of how the framework works to use it in your add-in. Many libraries are available that simplify the details for you.</span></span>

<span data-ttu-id="46b25-108">OAuth の基本的な考え方は、ユーザーやグループと同様に、アプリケーションは専用の ID とアクセス許可のセットによって、それ自体がセキュリティ プリンシパルになり得るということです。</span><span class="sxs-lookup"><span data-stu-id="46b25-108">A fundamental idea of OAuth is that an application can be a security principal unto itself, just like a user or a group, with its own identity and set of permissions.</span></span> <span data-ttu-id="46b25-109">通常のシナリオでは、ユーザーがオンライン サービスを必要とする Office アドインのアクションを実行すると、アドインは、ユーザーのアカウントへ特定のセットのアクセス許可を付与するよう求める要求をサービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="46b25-109">In the most typical scenarios, when the user takes an action in the Office Add-in that requires the online service, the add-in sends the service a request for a specific set of permissions to the user's account.</span></span> <span data-ttu-id="46b25-110">サービスは、該当するアクセス許可をアドインに付与するように求めるプロンプトをユーザーに表示します。</span><span class="sxs-lookup"><span data-stu-id="46b25-110">The service then prompts the user to grant the add-in those permissions.</span></span> <span data-ttu-id="46b25-111">アクセス許可が付与されると、サービスは小さなエンコードされた*アクセス トークン*をアドインに送信します。</span><span class="sxs-lookup"><span data-stu-id="46b25-111">After the permissions are granted, the service sends the add-in a small encoded *access token*.</span></span> <span data-ttu-id="46b25-112">アドインは、サービスの API へのすべての要求にトークンを含めることで、サービスを使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="46b25-112">The add-in can use the service by including the token in all its requests to the service's APIs.</span></span> <span data-ttu-id="46b25-113">ただし、そのアドインが実行できるアクションは、ユーザーが付与したアクセス許可の範囲内に限定されます。</span><span class="sxs-lookup"><span data-stu-id="46b25-113">But the add-in can act only within the permissions that the user granted it.</span></span> <span data-ttu-id="46b25-114">また、トークンは特定の時間が経過すると期限切れになります。</span><span class="sxs-lookup"><span data-stu-id="46b25-114">The token also expires after a specified time.</span></span>

<span data-ttu-id="46b25-115">さまざまなシナリオに向けて、*フロー*または*許可の種類*と呼ばれる、いくつかの OAuth パターンが設計されています。</span><span class="sxs-lookup"><span data-stu-id="46b25-115">Several OAuth patterns, called *flows* or *grant types*, are designed for different scenarios.</span></span> <span data-ttu-id="46b25-116">最も一般的な実装パターンは次の 2 つです。</span><span class="sxs-lookup"><span data-stu-id="46b25-116">The following two patterns are the most commonly implemented:</span></span>

- <span data-ttu-id="46b25-117">**暗黙的フロー**: アドインとオンライン サービスとの通信は、クライアント側の JavaScript で実装されます。</span><span class="sxs-lookup"><span data-stu-id="46b25-117">**Implicit flow**: Communication between the add-in and the online service is implemented with client-side JavaScript.</span></span>
- <span data-ttu-id="46b25-p105">**認証コード フロー**: アドインの Web アプリケーションとオンライン サービスとの通信は、*サーバー間*で行われます。そのため、これはサーバー側のコードで実装されます。</span><span class="sxs-lookup"><span data-stu-id="46b25-p105">**Authorization Code flow**: Communication is *server-to-server* between your add-in's web application and the online service. So, it is implemented with server-side code.</span></span>

<span data-ttu-id="46b25-p106">OAuth フローの目的は、アプリケーションの ID と承認の安全を確保することです。認証コード フローでは、*クライアント シークレット*が提供されます。これは、秘密にしておく必要があります。単一ページ アプリケーション (SPA) には、シークレットを保護する方法がありません。そのため、SPA には暗黙的フローを使用するようにお勧めします。</span><span class="sxs-lookup"><span data-stu-id="46b25-p106">The purpose of an OAuth flow is to secure the identity and authorization of the application. In the Authorization Code flow, you're provided a *client secret* that needs to be kept hidden. A Single Page Application (SPA) has no way to protect the secret, so we recommend that you use the Implicit flow in SPAs.</span></span>

<span data-ttu-id="46b25-123">暗黙的フローと認証コード フローのメリットとデメリットについて理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="46b25-123">You should be familiar with the pros and cons of the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="46b25-124">これら 2 つのフローの詳細については、「[認証コード フロー](https://tools.ietf.org/html/rfc6749#section-1.3.1)」と「[暗黙的フロー](https://tools.ietf.org/html/rfc6749#section-1.3.2)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-124">For more infomation about these two flows, see [Authorization Code](https://tools.ietf.org/html/rfc6749#section-1.3.1) and [Implicit](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span></span>

> [!NOTE]
> <span data-ttu-id="46b25-125">仲介者サービスを使用するというオプションもあります。このサービスは、自動的に承認を行い、アドインにアクセス トークンを渡します。</span><span class="sxs-lookup"><span data-stu-id="46b25-125">You also have the option of using a middleman service to perform authorization and pass the access token to your add-in.</span></span> <span data-ttu-id="46b25-126">このシナリオの詳細については、後述の「**仲介者サービス**」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-126">For details about this scenario, see the **Middleman services** section later in this article.</span></span>

## <a name="using-the-implicit-flow-in-office-add-ins"></a><span data-ttu-id="46b25-127">Office アドインに暗黙的フローを使用する</span><span class="sxs-lookup"><span data-stu-id="46b25-127">Using the Implicit flow in Office Add-ins</span></span>
<span data-ttu-id="46b25-128">オンライン サービスが暗黙的フローをサポートしているかどうかを判断する最良の方法は、サービスのドキュメントを調べることです。</span><span class="sxs-lookup"><span data-stu-id="46b25-128">The best way to find out if an online service supports the Implicit flow is to consult the service's documentation.</span></span> <span data-ttu-id="46b25-129">サービスが暗黙的フローをサポートしている場合、**Office-js-helpers** Javascript ライブラリを使って細かい作業を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="46b25-129">For services that support the Implicit flow, you can use the **Office-js-helpers** JavaScript library to do all the detailed work for you:</span></span>

- [<span data-ttu-id="46b25-130">Office-js-helpers</span><span class="sxs-lookup"><span data-stu-id="46b25-130">Office-js-helpers</span></span>](https://github.com/OfficeDev/office-js-helpers)

<span data-ttu-id="46b25-131">暗黙的フローをサポートするその他のライブラリの詳細については、後述の「**ライブラリ**」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-131">For information about other libraries that support the Implicit flow, see the **Libraries** section later in this article.</span></span>

## <a name="using-the-authorization-code-flow-in-office-add-ins"></a><span data-ttu-id="46b25-132">Office アドインに認証コード フローを使用する</span><span class="sxs-lookup"><span data-stu-id="46b25-132">Using the Authorization Code flow in Office Add-ins</span></span>

<span data-ttu-id="46b25-p110">各種の言語とフレームワークで認証コード フローを実装するために利用できるライブラリは多数あります。これらのライブラリの詳細については、後述の「**ライブラリ**」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-p110">Many libraries are available for implementing the Authorization Code flow in various languages and frameworks. For more information about some of these libraries, see the **Libraries** section later in this article.</span></span>

<span data-ttu-id="46b25-135">次のサンプルでは、認証コード フローを実装するアドインの例を示します。</span><span class="sxs-lookup"><span data-stu-id="46b25-135">The following samples provide examples of add-ins that implement the Authorization Code flow:</span></span>

- <span data-ttu-id="46b25-136">[Office-Add-in-Nodejs-ServerAuth](https://github.com/OfficeDev/Office-Add-in-Nodejs-ServerAuth) (NodeJS)</span><span class="sxs-lookup"><span data-stu-id="46b25-136">[Office-Add-in-Nodejs-ServerAuth](https://github.com/OfficeDev/Office-Add-in-Nodejs-ServerAuth) (NodeJS)</span></span>
- <span data-ttu-id="46b25-137">[PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) (ASP.NET MVC)</span><span class="sxs-lookup"><span data-stu-id="46b25-137">[PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) (ASP.NET MVC)</span></span>

### <a name="relayproxy-functions"></a><span data-ttu-id="46b25-138">Relay 関数と Proxy 関数</span><span class="sxs-lookup"><span data-stu-id="46b25-138">Relay/Proxy functions</span></span>

<span data-ttu-id="46b25-p111">サーバーなしの Web アプリケーションでも、サービスでホストされる簡単な関数 ([Azure Functions](https://azure.microsoft.com/services/functions) や [Amazon Lambda](https://aws.amazon.com/lambda) など) で**クライアント ID** と**クライアント シークレット**の値を使用すると、認証コード フローを使用できます。この関数は、特定のコードを**アクセス トークン**に交換して、それを中継してクライアントに戻します。このアプローチのセキュリティは、関数へのアクセスが、どの程度適切に保護されているかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="46b25-p111">You can use the Authorization Code flow even with a serverless web application by storing the **client ID** and **client secret** values in a simple function that is hosted in a service such as [Azure Functions](https://azure.microsoft.com/services/functions) or [Amazon Lambda](https://aws.amazon.com/lambda). The function exchanges a given code for an **access token** and relays it back to the client. The security of this approach depends on how well access to the function is guarded.</span></span>

<span data-ttu-id="46b25-p112">この技法を使用する場合は、アドインでオンライン サービス (Google や Facebook など) のログイン画面を示す UI やポップアップを表示します。ユーザーがオンライン サービスにサインインして、自分のリソースへのアクセス許可をアドインに付与すると、アドインはオンライン関数に送信できるコードを受信します。後述の「**仲介者サービス**」セクションで説明しているサービスでも同様のフローを使用します。</span><span class="sxs-lookup"><span data-stu-id="46b25-p112">To use this technique, your add-in displays a UI/popup to show the login screen for the online service (Google, Facebook, and so on). When the user signs in and grants the add-in permission to her resources in the online service, the add-in receives a code which can be then sent to the online function. The services described in the **Middleman services** section later in this article use a similar flow.</span></span>

## <a name="libraries"></a><span data-ttu-id="46b25-145">ライブラリ</span><span class="sxs-lookup"><span data-stu-id="46b25-145">Libraries</span></span>

<span data-ttu-id="46b25-146">各種の言語とプラットフォームで暗黙的フローと認証コード フローを実装するために利用できるライブラリが多数あります。</span><span class="sxs-lookup"><span data-stu-id="46b25-146">Libraries are available for many languages and platforms, for both the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="46b25-147">ライブラリには汎用のものや、特定のオンライン サービス向けのものがあります。</span><span class="sxs-lookup"><span data-stu-id="46b25-147">Some libraries are general purpose, while others are for specific online services.</span></span>

<span data-ttu-id="46b25-p114">**認証プロバイダーとして Azure Active Directory を使用する Office 365 などのサービス**:[Azure Active Directory 認証ライブラリ](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/)。[Microsoft 認証ライブラリ](https://www.nuget.org/packages/Microsoft.Identity.Client)のプレビュー版も利用できます。</span><span class="sxs-lookup"><span data-stu-id="46b25-p114">**Office 365 and other services that use Azure Active Directory as the authorization provider**: [Azure Active Directory Authentication Libraries](https://azure.microsoft.com/documentation/articles/active-directory-authentication-libraries/). A preview is also available for the [Microsoft Authentication Library](https://www.nuget.org/packages/Microsoft.Identity.Client).</span></span>

<span data-ttu-id="46b25-p115">**Google**:[GitHub.com/Google](https://github.com/google) で "auth" または目的の言語の名前を検索します。最も関連のあるリポジトリには、`google-auth-library-[name of language]` という名前が付いています。</span><span class="sxs-lookup"><span data-stu-id="46b25-p115">**Google**: Search [GitHub.com/Google](https://github.com/google) for "auth" or the name of your language. Most of the relevant repos are named `google-auth-library-[name of language]`.</span></span>

<span data-ttu-id="46b25-152">**Facebook**:[Facebook for Developers](https://developers.facebook.com) で "library" または "sdk" を検索します。</span><span class="sxs-lookup"><span data-stu-id="46b25-152">**Facebook**: Search [Facebook for Developers](https://developers.facebook.com) for "library" or "sdk".</span></span>

<span data-ttu-id="46b25-p116">**汎用の OAuth 2.0**:数十の言語に対応したライブラリへのリンクが、「[OAuth Code](https://oauth.net/code/)」のページに掲載されています。このページは、IETF OAuth 作業部会によって維持されています。これらのライブラリの一部は、OAuth 準拠のサービスを実装するためのものです。アドイン開発者にとって重要なライブラリは、このページに記載された*クライアント*と呼ばれるライブラリです。これは、目的の Web サーバーが OAuth 準拠のサービスのクライアントになるためです。</span><span class="sxs-lookup"><span data-stu-id="46b25-p116">**General OAuth 2.0**: A page of links to libraries for over a dozen languages is maintained by the IETF OAuth Working Group at: [OAuth Code](https://oauth.net/code/). Note that some of these libraries are for implementing an OAuth compliant service. The libraries of interest to you as a an add-in developer are called *client* libraries on this page because your web server is a client of the OAuth compliant service.</span></span>

## <a name="middleman-services"></a><span data-ttu-id="46b25-156">仲介者サービス</span><span class="sxs-lookup"><span data-stu-id="46b25-156">Middleman services</span></span>

<span data-ttu-id="46b25-p117">アドインでは、[OAuth.io](https://oauth.io) や [Auth0](https://auth0.com) などの仲介者サービスを使用して、承認を実行できます。このサービスは、大手オンライン サービスに対応したアクセス トークンを提供するものか、アドインでソーシャル ログインできるようにするプロセスを簡単にするもの (またはその両方) です。短いコードを使用することで、仲介者サービスに接続するクライアント側スクリプトやサーバー側コードをアドインで使用できるようになり、仲介者サービスがオンライン サービスに必要なトークンをアドインに送信します。すべての承認の実装コードは、仲介者サービスに含まれています。</span><span class="sxs-lookup"><span data-stu-id="46b25-p117">Your add-in can use a middleman service such as OAuth.io or Auth0 to perform authorization. A middleman service may either provide access tokens for popular online services or simplify the process of enabling social login for your add-in, or both. With very little code, your add-in can use either client-side script or server-side code to connect to the middleman service and it will send your add-in any required tokens for the online service. All of the authorization implementation code is in the middleman service.</span></span> 

<span data-ttu-id="46b25-161">アドインの認証/承認用 UI では、ダイアログ API を使用してログイン ページを開くようにしてください。</span><span class="sxs-lookup"><span data-stu-id="46b25-161">We recommend that the UI for authentication/authorization in your add-in use our Dialog APIs to open a login page.</span></span> <span data-ttu-id="46b25-162">詳細については、「[認証フローでダイアログ API を使用する](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-162">See [Use the Dialog APIs in an authentication flow](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow) for more information.</span></span> <span data-ttu-id="46b25-163">この方法で Office ダイアログを開くと、そのダイアログは、親ページのインスタンス (アドインの作業ウィンドウや FunctionFile など) とはまったく別の新しいブラウザーと JavaScript エンジンのインスタンスを持ちます。</span><span class="sxs-lookup"><span data-stu-id="46b25-163">When you open an Office dialog in this way, the dialog has a completely new and separate instance of the browser and JavaScript engine from the instance in the parent page (e.g., the add-in's task pane or FunctionFile).</span></span> <span data-ttu-id="46b25-164">文字列に変換できるトークンなどの情報は、`messageParent` という API を使用して親に戻されます。</span><span class="sxs-lookup"><span data-stu-id="46b25-164">A token, and any other information that can be converted to a string, is passed back to the parent using an API called `messageParent`.</span></span> <span data-ttu-id="46b25-165">そうすることで、親ページはトークンを使用してリソースへの権限のある呼び出しを実行できます。</span><span class="sxs-lookup"><span data-stu-id="46b25-165">The parent page can then use the token to make authorized calls to the resource.</span></span> <span data-ttu-id="46b25-166">こうしたアーキテクチャのため、仲介者サービスによって提供される API の使用方法には注意が必要になります。</span><span class="sxs-lookup"><span data-stu-id="46b25-166">Because of this architecture, you must be careful how you use the APIs provided by a middleman service.</span></span> <span data-ttu-id="46b25-167">多くの場合、このサービスはコードでトークンを取得し、そのトークンを使用して後続のリソースへの呼び出しを実行する、ある種のコンテキスト オブジェクトを作成する API セットを提供します。</span><span class="sxs-lookup"><span data-stu-id="46b25-167">Often the service will provide an API set in which your code creates some kind of context object which both gets a token and uses that token in making subsequent calls to the resource.</span></span> <span data-ttu-id="46b25-168">通常、このサービスには、そのコンテキスト オブジェクトの最初の呼び出し*および*作成を実行する単一の API メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="46b25-168">Often the service has a single API method that makes the initial call *and* creates the context object.</span></span> <span data-ttu-id="46b25-169">このようなオブジェクトは、完全に文字列化することができないため、Office ダイアログから親ページに渡せません。</span><span class="sxs-lookup"><span data-stu-id="46b25-169">An object like this cannot be completely stringified, so it cannot be passed from the Office dialog to the parent page.</span></span> <span data-ttu-id="46b25-170">一般に、仲介者サービスは抽象度の低い第 2 の API セット (REST API など) を提供しています。</span><span class="sxs-lookup"><span data-stu-id="46b25-170">Typically, the middleman service provides a second API set, at a lower level of abstraction, such as a REST API.</span></span> <span data-ttu-id="46b25-171">この第 2 のセットには、トークンを使用してリソースへの権限のあるアクセスを実行するために、サービスからトークンを取得する API と、そのトークンをサービスに渡す別の API があります。</span><span class="sxs-lookup"><span data-stu-id="46b25-171">This second set will have an API that gets a token from the service, and other APIs that pass the token to service when using it to get authorized access to the resource.</span></span> <span data-ttu-id="46b25-172">この抽象度の低い API は、Office ダイアログでトークンを取得し、そのトークンを親ページに `messageParent` を使用して渡すために操作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="46b25-172">You need to work with an API at this lower level of abstraction so that you can get the token in the Office dialog and then use `messageParent` to pass it to the parent page.</span></span> 

## <a name="what-is-cors"></a><span data-ttu-id="46b25-173">CORS とは</span><span class="sxs-lookup"><span data-stu-id="46b25-173">What is CORS?</span></span>

<span data-ttu-id="46b25-p119">CORS は [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS) の略です。アドイン内で CORS を使用する方法の詳細については、「[Office アドインにおける同一生成元ポリシーの制限への対処](addressing-same-origin-policy-limitations.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="46b25-p119">CORS stands for [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS). For information about how to use CORS inside add-ins, see [Addressing same-origin policy limitations in Office Add-ins](addressing-same-origin-policy-limitations.md).</span></span>
