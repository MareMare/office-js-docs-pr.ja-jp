---
title: Office アドインで外部サービスを承認する
description: OAuth 2.0 認証コード フローおよび暗黙的フローを使用して、Google、Facebook、LinkedIn、SalesForce、および GitHub などの Microsoft 以外のデータソースに対する承認を取得します。
ms.date: 08/07/2019
localization_priority: Normal
ms.openlocfilehash: fd180e11106e7e1e2f20f539746535c4310ad81e
ms.sourcegitcommit: 7ef14753dce598a5804dad8802df7aaafe046da7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/10/2020
ms.locfileid: "45093743"
---
# <a name="authorize-external-services-in-your-office-add-in"></a><span data-ttu-id="a7fd0-103">Office アドインで外部サービスを承認する</span><span class="sxs-lookup"><span data-stu-id="a7fd0-103">Authorize external services in your Office Add-in</span></span>

<span data-ttu-id="a7fd0-104">Popular online services, including Microsoft 365, Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-104">Popular online services, including Microsoft 365, Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications.</span></span> <span data-ttu-id="a7fd0-105">This gives you the ability to include these services in your Office Add-in.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-105">This gives you the ability to include these services in your Office Add-in.</span></span>

> [!NOTE]
> <span data-ttu-id="a7fd0-106">この記事の残りの部分では、Microsoft 以外のサービスへのアクセスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-106">The remainder of this article is about accessing non-Microsoft services.</span></span> <span data-ttu-id="a7fd0-107">Microsoft Graph (Microsoft 365 を含む) へのアクセスに関する詳細については、「 [sso を使用した Microsoft graph へのアクセス](overview-authn-authz.md#access-to-microsoft-graph-with-sso)」および「sso を使用し[ない microsoft Graph](overview-authn-authz.md#access-to-microsoft-graph-without-sso)へのアクセス」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-107">For information about accessing Microsoft Graph (including Microsoft 365), see [Access to Microsoft Graph with SSO](overview-authn-authz.md#access-to-microsoft-graph-with-sso) and [Access to Microsoft Graph without SSO](overview-authn-authz.md#access-to-microsoft-graph-without-sso).</span></span>

<span data-ttu-id="a7fd0-108">The industry standard framework for enabling web application access to an online service is **OAuth 2.0**.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-108">The industry standard framework for enabling web application access to an online service is **OAuth 2.0**.</span></span> <span data-ttu-id="a7fd0-109">In most situations, you don't need to know the details of how the framework works to use it in your add-in.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-109">In most situations, you don't need to know the details of how the framework works to use it in your add-in.</span></span> <span data-ttu-id="a7fd0-110">Many libraries are available that simplify the details for you.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-110">Many libraries are available that simplify the details for you.</span></span>

<span data-ttu-id="a7fd0-111">OAuth の基本的な考え方は、ユーザーやグループと同様に、アプリケーションは専用の ID とアクセス許可のセットによって、それ自体が[セキュリティ プリンシパル](/windows/security/identity-protection/access-control/security-principals)になり得るということです。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-111">A fundamental idea of OAuth is that an application can be a [security principal](/windows/security/identity-protection/access-control/security-principals) unto itself, just like a user or a group, with its own identity and set of permissions.</span></span> <span data-ttu-id="a7fd0-112">通常のシナリオでは、ユーザーがオンライン サービスを必要とする Office アドインのアクションを実行すると、アドインは、ユーザーのアカウントへ特定のセットのアクセス許可を付与するよう求める要求をサービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-112">In the most typical scenarios, when the user takes an action in the Office Add-in that requires the online service, the add-in sends the service a request for a specific set of permissions to the user's account.</span></span> <span data-ttu-id="a7fd0-113">サービスは、該当するアクセス許可をアドインに付与するように求めるプロンプトをユーザーに表示します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-113">The service then prompts the user to grant the add-in those permissions.</span></span> <span data-ttu-id="a7fd0-114">アクセス許可が付与されると、サービスは小さなエンコードされた*アクセス トークン*をアドインに送信します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-114">After the permissions are granted, the service sends the add-in a small encoded *access token*.</span></span> <span data-ttu-id="a7fd0-115">アドインは、サービスの API へのすべての要求にトークンを含めることで、サービスを使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-115">The add-in can use the service by including the token in all its requests to the service's APIs.</span></span> <span data-ttu-id="a7fd0-116">ただし、そのアドインが実行できるアクションは、ユーザーが付与したアクセス許可の範囲内に限定されます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-116">But the add-in can act only within the permissions that the user granted it.</span></span> <span data-ttu-id="a7fd0-117">また、トークンは特定の時間が経過すると期限切れになります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-117">The token also expires after a specified time.</span></span>

<span data-ttu-id="a7fd0-118">さまざまなシナリオに向けて、*フロー*または*許可の種類*と呼ばれる、いくつかの OAuth パターンが設計されています。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-118">Several OAuth patterns, called *flows* or *grant types*, are designed for different scenarios.</span></span> <span data-ttu-id="a7fd0-119">最も一般的な実装パターンは次の 2 つです。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-119">The following two patterns are the most commonly implemented:</span></span>

- <span data-ttu-id="a7fd0-120">**暗黙的フロー**: アドインとオンライン サービスとの通信は、クライアント側の JavaScript で実装されます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-120">**Implicit flow**: Communication between the add-in and the online service is implemented with client-side JavaScript.</span></span> <span data-ttu-id="a7fd0-121">このフローは、シングル ページ アプリケーション (SPA) で一般的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-121">This flow is commonly used in single-page applications (SPAs).</span></span>
- <span data-ttu-id="a7fd0-122">**認証コード フロー**:アドインの Web アプリケーションとオンライン サービスとの通信は、*サーバー間*で行われます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-122">**Authorization Code flow**: Communication is *server-to-server* between your add-in's web application and the online service.</span></span> <span data-ttu-id="a7fd0-123">そのため、これはサーバー側のコードで実装されます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-123">So, it is implemented with server-side code.</span></span>

<span data-ttu-id="a7fd0-124">OAuth フローの目的は、アプリケーションの ID と承認の安全を確保することです。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-124">The purpose of an OAuth flow is to secure the identity and authorization of the application.</span></span> <span data-ttu-id="a7fd0-125">認証コード フローでは、*クライアント シークレット*が提供されます。これは、秘密にしておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-125">In the Authorization Code flow, you're provided a *client secret* that needs to be kept hidden.</span></span> <span data-ttu-id="a7fd0-126">SPA など、サーバー側のバックエンドがないアプリケーションには、秘密を保護する方法がありませんので、SPA では暗黙的フローを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-126">An application that has no server-side backend, such as an SPA, has no way to protect the secret, so we recommend that you use the Implicit flow in SPAs.</span></span>

<span data-ttu-id="a7fd0-127">暗黙的フローと認証コード フローのメリットとデメリットについて理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-127">You should be familiar with the pros and cons of the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="a7fd0-128">これら 2 つのフローの詳細については、「[認証コード フロー](https://tools.ietf.org/html/rfc6749#section-1.3.1)」と「[暗黙的フロー](https://tools.ietf.org/html/rfc6749#section-1.3.2)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-128">For more information about these two flows, see [Authorization Code](https://tools.ietf.org/html/rfc6749#section-1.3.1) and [Implicit](https://tools.ietf.org/html/rfc6749#section-1.3.2).</span></span>

> [!NOTE]
> <span data-ttu-id="a7fd0-129">You also have the option of using a middleman service to perform authorization and pass the access token to your add-in.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-129">You also have the option of using a middleman service to perform authorization and pass the access token to your add-in.</span></span> <span data-ttu-id="a7fd0-130">For details about this scenario, see the **Middleman services** section later in this article.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-130">For details about this scenario, see the **Middleman services** section later in this article.</span></span>

## <a name="using-the-implicit-flow-in-office-add-ins"></a><span data-ttu-id="a7fd0-131">Office アドインに暗黙的フローを使用する</span><span class="sxs-lookup"><span data-stu-id="a7fd0-131">Using the Implicit flow in Office Add-ins</span></span>

<span data-ttu-id="a7fd0-132">オンライン サービスが暗黙的フローをサポートしているかどうかを判断する最良の方法は、サービスのドキュメントを調べることです。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-132">The best way to find out if an online service supports the Implicit flow is to consult the service's documentation.</span></span>

<span data-ttu-id="a7fd0-133">暗黙的フローをサポートするライブラリの詳細については、後述の「**ライブラリ**」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-133">For information about libraries that support the Implicit flow, see the **Libraries** section later in this article.</span></span>

## <a name="using-the-authorization-code-flow-in-office-add-ins"></a><span data-ttu-id="a7fd0-134">Office アドインに認証コード フローを使用する</span><span class="sxs-lookup"><span data-stu-id="a7fd0-134">Using the Authorization Code flow in Office Add-ins</span></span>

<span data-ttu-id="a7fd0-135">Many libraries are available for implementing the Authorization Code flow in various languages and frameworks.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-135">Many libraries are available for implementing the Authorization Code flow in various languages and frameworks.</span></span> <span data-ttu-id="a7fd0-136">For more information about some of these libraries, see the **Libraries** section later in this article.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-136">For more information about some of these libraries, see the **Libraries** section later in this article.</span></span>

## <a name="libraries"></a><span data-ttu-id="a7fd0-137">ライブラリ</span><span class="sxs-lookup"><span data-stu-id="a7fd0-137">Libraries</span></span>

<span data-ttu-id="a7fd0-138">Libraries are available for many languages and platforms, for both the Implicit flow and the Authorization Code flow.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-138">Libraries are available for many languages and platforms, for both the Implicit flow and the Authorization Code flow.</span></span> <span data-ttu-id="a7fd0-139">Some libraries are general purpose, while others are for specific online services.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-139">Some libraries are general purpose, while others are for specific online services.</span></span>

<span data-ttu-id="a7fd0-140">**Google**: Search [GitHub.com/Google](https://github.com/google) for "auth" or the name of your language.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-140">**Google**: Search [GitHub.com/Google](https://github.com/google) for "auth" or the name of your language.</span></span> <span data-ttu-id="a7fd0-141">Most of the relevant repos are named `google-auth-library-[name of language]`.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-141">Most of the relevant repos are named `google-auth-library-[name of language]`.</span></span>

<span data-ttu-id="a7fd0-142">**Facebook**:[Facebook for Developers](https://developers.facebook.com) で "library" または "sdk" を検索します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-142">**Facebook**: Search [Facebook for Developers](https://developers.facebook.com) for "library" or "sdk".</span></span>

<span data-ttu-id="a7fd0-143">**General OAuth 2.0**: A page of links to libraries for over a dozen languages is maintained by the IETF OAuth Working Group at: [OAuth Code](https://oauth.net/code/).</span><span class="sxs-lookup"><span data-stu-id="a7fd0-143">**General OAuth 2.0**: A page of links to libraries for over a dozen languages is maintained by the IETF OAuth Working Group at: [OAuth Code](https://oauth.net/code/).</span></span> <span data-ttu-id="a7fd0-144">Note that some of these libraries are for implementing an OAuth compliant service.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-144">Note that some of these libraries are for implementing an OAuth compliant service.</span></span> <span data-ttu-id="a7fd0-145">The libraries of interest to you as a an add-in developer are called *client* libraries on this page because your web server is a client of the OAuth compliant service.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-145">The libraries of interest to you as a an add-in developer are called *client* libraries on this page because your web server is a client of the OAuth compliant service.</span></span>

## <a name="middleman-services"></a><span data-ttu-id="a7fd0-146">仲介者サービス</span><span class="sxs-lookup"><span data-stu-id="a7fd0-146">Middleman services</span></span>

<span data-ttu-id="a7fd0-147">Your add-in can use a middleman service such as [OAuth.io](https://oauth.io) or [Auth0](https://auth0.com) to perform authorization.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-147">Your add-in can use a middleman service such as [OAuth.io](https://oauth.io) or [Auth0](https://auth0.com) to perform authorization.</span></span> <span data-ttu-id="a7fd0-148">A middleman service may either provide access tokens for popular online services or simplify the process of enabling social login for your add-in, or both.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-148">A middleman service may either provide access tokens for popular online services or simplify the process of enabling social login for your add-in, or both.</span></span> <span data-ttu-id="a7fd0-149">With very little code, your add-in can use either client-side script or server-side code to connect to the middleman service and it will send your add-in any required tokens for the online service.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-149">With very little code, your add-in can use either client-side script or server-side code to connect to the middleman service and it will send your add-in any required tokens for the online service.</span></span> <span data-ttu-id="a7fd0-150">All of the authorization implementation code is in the middleman service.</span><span class="sxs-lookup"><span data-stu-id="a7fd0-150">All of the authorization implementation code is in the middleman service.</span></span> 

<span data-ttu-id="a7fd0-151">アドインの認証/承認用 UI では、ダイアログ API を使用してログイン ページを開くようにしてください。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-151">We recommend that the UI for authentication/authorization in your add-in use our Dialog APIs to open a login page.</span></span> <span data-ttu-id="a7fd0-152">詳細については、「[認証フローでダイアログ API を使用する](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-152">See [Use the Dialog APIs in an authentication flow](dialog-api-in-office-add-ins.md#use-the-dialog-apis-in-an-authentication-flow) for more information.</span></span> <span data-ttu-id="a7fd0-153">この方法で Office ダイアログを開くと、そのダイアログは、親ページのインスタンス (アドインの作業ウィンドウや FunctionFile など) とはまったく別の新しいブラウザーと JavaScript エンジンのインスタンスを持ちます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-153">When you open an Office dialog in this way, the dialog has a completely new and separate instance of the browser and JavaScript engine from the instance in the parent page (e.g., the add-in's task pane or FunctionFile).</span></span> <span data-ttu-id="a7fd0-154">文字列に変換できるトークンなどの情報は、`messageParent` という API を使用して親に戻されます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-154">A token, and any other information that can be converted to a string, is passed back to the parent using an API called `messageParent`.</span></span> <span data-ttu-id="a7fd0-155">そうすることで、親ページはトークンを使用してリソースへの権限のある呼び出しを実行できます。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-155">The parent page can then use the token to make authorized calls to the resource.</span></span> <span data-ttu-id="a7fd0-156">こうしたアーキテクチャのため、仲介者サービスによって提供される API の使用方法には注意が必要になります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-156">Because of this architecture, you must be careful how you use the APIs provided by a middleman service.</span></span> <span data-ttu-id="a7fd0-157">多くの場合、このサービスはコードでトークンを取得し、そのトークンを使用して後続のリソースへの呼び出しを実行する、ある種のコンテキスト オブジェクトを作成する API セットを提供します。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-157">Often the service will provide an API set in which your code creates some kind of context object which both gets a token and uses that token in making subsequent calls to the resource.</span></span> <span data-ttu-id="a7fd0-158">通常、このサービスには、そのコンテキスト オブジェクトの最初の呼び出し*および*作成を実行する単一の API メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-158">Often the service has a single API method that makes the initial call *and* creates the context object.</span></span> <span data-ttu-id="a7fd0-159">このようなオブジェクトは、完全に文字列化することができないため、Office ダイアログから親ページに渡せません。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-159">An object like this cannot be completely stringified, so it cannot be passed from the Office dialog to the parent page.</span></span> <span data-ttu-id="a7fd0-160">一般に、仲介者サービスは抽象度の低い第 2 の API セット (REST API など) を提供しています。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-160">Typically, the middleman service provides a second API set, at a lower level of abstraction, such as a REST API.</span></span> <span data-ttu-id="a7fd0-161">この第 2 のセットには、トークンを使用してリソースへの権限のあるアクセスを実行するために、サービスからトークンを取得する API と、そのトークンをサービスに渡す別の API があります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-161">This second set will have an API that gets a token from the service, and other APIs that pass the token to service when using it to get authorized access to the resource.</span></span> <span data-ttu-id="a7fd0-162">この抽象度の低い API は、Office ダイアログでトークンを取得し、そのトークンを親ページに `messageParent` を使用して渡すために操作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7fd0-162">You need to work with an API at this lower level of abstraction so that you can get the token in the Office dialog and then use `messageParent` to pass it to the parent page.</span></span> 

## <a name="what-is-cors"></a><span data-ttu-id="a7fd0-163">CORS とは</span><span class="sxs-lookup"><span data-stu-id="a7fd0-163">What is CORS?</span></span>

<span data-ttu-id="a7fd0-164">CORS stands for [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS).</span><span class="sxs-lookup"><span data-stu-id="a7fd0-164">CORS stands for [Cross Origin Resource Sharing](https://developer.mozilla.org/docs/Web/HTTP/Access_control_CORS).</span></span> <span data-ttu-id="a7fd0-165">For information about how to use CORS inside add-ins, see [Addressing same-origin policy limitations in Office Add-ins](addressing-same-origin-policy-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="a7fd0-165">For information about how to use CORS inside add-ins, see [Addressing same-origin policy limitations in Office Add-ins](addressing-same-origin-policy-limitations.md).</span></span>
